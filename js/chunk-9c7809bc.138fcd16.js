(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9c7809bc"],{"0bda":function(e,t,n){"use strict";(function(e){var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudbaseCache=void 0;var s=n("f10f"),a=n("8a32"),u=n("56b0"),c=function(e){function t(t){var n=e.call(this)||this;return n._root=t,t["tcbCacheObject"]||(t["tcbCacheObject"]={}),n}return r(t,e),t.prototype.setItem=function(e,t){this._root["tcbCacheObject"][e]=t},t.prototype.getItem=function(e){return this._root["tcbCacheObject"][e]},t.prototype.removeItem=function(e){delete this._root["tcbCacheObject"][e]},t.prototype.clear=function(){delete this._root["tcbCacheObject"]},t}(s.AbstractStorage);function f(e,t){switch(e){case"local":return t.localStorage?t.localStorage:(a.printWarn(u.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new c(t.root));case"none":return new c(t.root);case"session":return t.sessionStorage?t.sessionStorage:(a.printWarn(u.ERRORS.INVALID_PARAMS,"sessionStorage is not supported on current platform"),new c(t.root));default:return t.localStorage?t.localStorage:(a.printWarn(u.ERRORS.INVALID_PARAMS,"localStorage is not supported on current platform"),new c(t.root))}}var l=function(){function t(e){this.keys={};var t=e.persistence,n=e.platformInfo,r=void 0===n?{}:n,o=e.keys,i=void 0===o?{}:o,s=e.alwaysLocalKeys,a=void 0===s?[]:s;this._platformInfo=r,this._alwaysLocalKeys=a,this._storage||(this._persistence=r.adapter.primaryStorage||t,this._storage=f(this._persistence,r.adapter),this.keys=i)}return Object.defineProperty(t.prototype,"mode",{get:function(){return this._storage.mode||"sync"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistence",{get:function(){return this._persistence},enumerable:!1,configurable:!0}),t.prototype.updatePersistence=function(e){if("async"!==this.mode){if(e!==this._persistence){var t="local"===this._persistence;this._persistence=e;var n=f(e,this._platformInfo.adapter);for(var r in this.keys){var o=this.keys[r];if(!t||!this._alwaysLocalKeys.includes(r)){var i=this._storage.getItem(o);a.isUndefined(i)||a.isNull(i)||(n.setItem(o,i),this._storage.removeItem(o))}}this._storage=n}}else a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use updatePersistenceAsync insteed")},t.prototype.updatePersistenceAsync=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o,s,u,c,l;return i(this,(function(i){switch(i.label){case 0:if(e===this._persistence)return[2];for(o in t="local"===this._persistence,this._persistence=e,n=f(e,this._platformInfo.adapter),r=[],this.keys)r.push(o);s=0,i.label=1;case 1:return s<r.length?(u=r[s],c=this.keys[u],t&&this._alwaysLocalKeys.includes(u)?[3,4]:[4,this._storage.getItem(c)]):[3,5];case 2:return l=i.sent(),a.isUndefined(l)||a.isNull(l)?[3,4]:(n.setItem(c,l),[4,this._storage.removeItem(c)]);case 3:i.sent(),i.label=4;case 4:return s++,[3,1];case 5:return this._storage=n,[2]}}))}))},t.prototype.setStore=function(e,t,n){if("async"!==this.mode){if(this._storage)try{var r={version:n||"localCachev1",content:t};this._storage.setItem(e,JSON.stringify(r))}catch(o){throw new Error(JSON.stringify({code:u.ERRORS.OPERATION_FAIL,msg:"["+u.getSdkName()+"]["+u.ERRORS.OPERATION_FAIL+"]setStore failed",info:o}))}}else a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use setStoreAsync insteed")},t.prototype.setStoreAsync=function(e,t,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:if(!this._storage)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),r={version:n||"localCachev1",content:t},[4,this._storage.setItem(e,JSON.stringify(r))];case 2:return o.sent(),[3,4];case 3:return o.sent(),[2];case 4:return[2]}}))}))},t.prototype.getStore=function(t,n){var r;if("async"!==this.mode){try{if("undefined"!==typeof e&&(null===(r=Object({NODE_ENV:"production",BASE_URL:"/"}))||void 0===r?void 0:r.tcb_token))return Object({NODE_ENV:"production",BASE_URL:"/"}).tcb_token;if(!this._storage)return""}catch(s){return""}n=n||"localCachev1";var o=this._storage.getItem(t);if(!o)return"";if(o.indexOf(n)>=0){var i=JSON.parse(o);return i.content}return""}a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use getStoreAsync insteed")},t.prototype.getStoreAsync=function(t,n){var r;return o(this,void 0,void 0,(function(){var o,s;return i(this,(function(i){switch(i.label){case 0:try{if("undefined"!==typeof e&&(null===(r=Object({NODE_ENV:"production",BASE_URL:"/"}))||void 0===r?void 0:r.tcb_token))return[2,Object({NODE_ENV:"production",BASE_URL:"/"}).tcb_token];if(!this._storage)return[2,""]}catch(a){return[2,""]}return n=n||"localCachev1",[4,this._storage.getItem(t)];case 1:return o=i.sent(),o&&o.indexOf(n)>=0?(s=JSON.parse(o),[2,s.content]):[2,""]}}))}))},t.prototype.removeStore=function(e){"async"!==this.mode?this._storage.removeItem(e):a.printWarn(u.ERRORS.INVALID_OPERATION,"current platform's storage is asynchronous, please use removeStoreAsync insteed")},t.prototype.removeStoreAsync=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._storage.removeItem(e)];case 1:return t.sent(),[2]}}))}))},t}();t.CloudbaseCache=l}).call(this,n("4362"))},1132:function(e,t,n){(function(t,r){e.exports=r(n("21bf"))})(0,(function(e){return function(){var t=e,n=t.lib,r=n.WordArray,o=t.enc;o.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var s=t[i>>>2]>>>24-i%4*8&255,a=t[i+1>>>2]>>>24-(i+1)%4*8&255,u=t[i+2>>>2]>>>24-(i+2)%4*8&255,c=s<<16|a<<8|u,f=0;f<4&&i+.75*f<n;f++)o.push(r.charAt(c>>>6*(3-f)&63));var l=r.charAt(64);if(l)while(o.length%4)o.push(l);return o.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var o=0;o<n.length;o++)r[n.charCodeAt(o)]=o}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return i(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function i(e,t,n){for(var o=[],i=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2,u=n[e.charCodeAt(s)]>>>6-s%4*2;o[i>>>2]|=(a|u)<<24-i%4*8,i++}return r.create(o,i)}}(),e.enc.Base64}))},"17b0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMUNITY_SITE_URL=t.IS_DEBUG_MODE=t.getProtocol=t.setProtocol=t.getSdkName=t.setSdkName=void 0;var r="@cloudbase/js-sdk";function o(e){r=e}function i(){return r}t.setSdkName=o,t.getSdkName=i;var s="undefined"!==typeof location&&"http:"===location.protocol?"http:":"https:";function a(e){s=e}function u(){return s}t.setProtocol=a,t.getProtocol=u,t.IS_DEBUG_MODE=!1,t.COMMUNITY_SITE_URL="https://support.qq.com/products/148793"},"19c6":function(e,t,n){"use strict";n.d(t,"e",(function(){return As})),n.d(t,"c",(function(){return Ts})),n.d(t,"d",(function(){return Ns})),n.d(t,"a",(function(){return Rs})),n.d(t,"b",(function(){return Ps}));var r={};n.r(r),n.d(r,"Point",(function(){return ei})),n.d(r,"LineString",(function(){return qo})),n.d(r,"Polygon",(function(){return Wo})),n.d(r,"MultiPoint",(function(){return $o})),n.d(r,"MultiLineString",(function(){return Go})),n.d(r,"MultiPolygon",(function(){return Ko}));var o=n("364b"),i=n("f10f"),s=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=function(){return a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},a.apply(this,arguments)},u=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};function f(){if("undefined"===typeof wx)return!1;if("undefined"===typeof Page)return!1;if(!wx.getSystemInfoSync)return!1;if(!wx.getStorageSync)return!1;if(!wx.setStorageSync)return!1;if(!wx.connectSocket)return!1;if(!wx.request)return!1;try{if(!wx.getSystemInfoSync())return!1;if("qq"===wx.getSystemInfoSync().AppPlatform)return!1}catch(e){return!1}return!0}function l(){return"undefined"===typeof App&&"undefined"===typeof getApp&&!wx.onAppHide&&!wx.offAppHide&&!wx.onAppShow&&!wx.offAppShow}var h=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this,r=t.timeout,o=t.timeoutMsg,i=t.restrictedMethods;return n._timeout=r||0,n._timeoutMsg=o||"请求超时",n._restrictedMethods=i||["get","post","upload","download"],n}return s(t,e),t.prototype.post=function(e){var t=this;return new Promise((function(n,r){var o=e.url,s=e.data,a=e.headers,u=wx.request({url:Object(i["formatUrl"])("https:",o),data:s,timeout:t._timeout,method:"POST",header:a,success:function(e){n(e)},fail:function(e){r(e)},complete:function(e){if(e&&e.errMsg&&t._timeout&&-1!==t._restrictedMethods.indexOf("post")){var n=e.errMsg;if("request:fail timeout"===n){console.warn(t._timeoutMsg);try{u.abort()}catch(r){}}}}})}))},t.prototype.upload=function(e){var t=this,n=this;return new Promise((function(r){return u(t,void 0,void 0,(function(){var t,o,i,s,u,f;return c(this,(function(c){return t=e.url,o=e.file,i=e.data,s=e.headers,u=e.onUploadProgress,f=wx.uploadFile({url:t,filePath:o,name:"file",formData:a({},i),header:s,timeout:this._timeout,success:function(e){var t={statusCode:e.statusCode,data:e.data||{}};200===e.statusCode&&i.success_action_status&&(t.statusCode=parseInt(i.success_action_status,10)),r(t)},fail:function(e){r(e)},complete:function(e){if(e&&e.errMsg&&n._timeout&&-1!==n._restrictedMethods.indexOf("upload")){var t=e.errMsg;if("request:fail timeout"===t){console.warn(n._timeoutMsg);try{f.abort()}catch(r){}}}}}),u&&f.onProgressUpdate((function(e){u(e)})),[2]}))}))}))},t.prototype.download=function(e){var t=this,n=this;return new Promise((function(r,o){var s=e.url,a=e.headers,u=wx.downloadFile({url:Object(i["formatUrl"])("https:",s),header:a,timeout:t._timeout,success:function(e){200===e.statusCode&&e.tempFilePath?r({statusCode:200,tempFilePath:e.tempFilePath}):r(e)},fail:function(e){o(e)},complete:function(e){if(e&&e.errMsg&&n._timeout&&-1!==n._restrictedMethods.indexOf("download")){var t=e.errMsg;if("request:fail timeout"===t){console.warn(n._timeoutMsg);try{u.abort()}catch(r){}}}}})}))},t}(i["AbstractSDKRequest"]),p={setItem:function(e,t){wx.setStorageSync(e,t)},getItem:function(e){return wx.getStorageSync(e)},removeItem:function(e){wx.removeStorageSync(e)},clear:function(){wx.clearStorageSync()}},d=function(){function e(e,t){void 0===t&&(t={});var n=wx.connectSocket(a({url:e},t)),r={set onopen(e){n.onOpen(e)},set onmessage(e){n.onMessage(e)},set onclose(e){n.onClose(e)},set onerror(e){n.onError(e)},send:function(e){return n.send({data:e})},close:function(e,t){return n.close({code:e,reason:t})},get readyState(){return n.readyState},CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3};return r}return e}();function y(){var e={root:{},reqClass:h,wsClass:d,localStorage:p,primaryStorage:i["StorageType"].local,getAppSign:function(){var e=wx.getAccountInfoSync();return l()?e&&e.plugin?e.plugin.appId:"":e&&e.miniProgram?e.miniProgram.appId:""}};return e}var g={genAdapter:y,isMatch:f,runtime:"wx_mp"},v=g,m=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r},_=o["constants"].ERRORS,b={};function w(e,t){var n=t.name,r=t.namespace,o=t.entity,i=t.injectEvents,s=t.IIFE,a=void 0!==s&&s;if(b[n]||r&&e[r])throw new Error(JSON.stringify({code:_.INVALID_OPERATION,msg:"Duplicate component "+n}));if(a){if(!o||"function"!==typeof o)throw new Error(JSON.stringify({code:_.INVALID_PARAMS,msg:"IIFE component's entity must be a function"}));o.call(e)}if(b[n]=t,r?e.prototype[r]=o:E(e.prototype,o),i){var u=i.bus,c=i.events;if(!u||!c||0===c.length)return;var f=e.prototype.fire||function(){};e.prototype.events||(e.prototype.events={});var l=e.prototype.events||{};l[n]?e.prototype.events[n].events=m(e.prototype.events[n].events,c):e.prototype.events[n]={bus:u,events:c},e.prototype.fire=function(e,t){for(var n in f(e,t),this.events){var r=this.events[n],o=r.bus,i=r.events;if(i.includes(e)){o.fire(e,t);break}}}}}function E(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)t.hasOwnProperty(r)&&(e[r]=E(e[r],t[r]));return e}function S(e,t){var n=t.entity,r=t.target;if(!e.prototype.hasOwnProperty(r))throw new Error(JSON.stringify({code:_.INVALID_OPERATION,msg:"target:"+r+" is not exist"}));var o=e.prototype[r];if("function"!==typeof o)throw new Error(JSON.stringify({code:_.INVALID_OPERATION,msg:"target:"+r+" is not a function which is the only type supports hook"}));e.prototype[r]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.call.apply(n,m([this],e)),o.call.apply(o,m([this],e))}}var I={},O=function(){return O=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},O.apply(this,arguments)},A="access_token",T="access_token_expire",N="refresh_token",R="anonymous_uuid",P="login_type",x="user_info",L=o["cache"].CloudbaseCache,C={},k={};function U(e){var t=e.env,n=e.persistence,r=e.platformInfo,o=A+"_"+t,i=T+"_"+t,s=N+"_"+t,a=R+"_"+t,u=P+"_"+t,c=x+"_"+t,f={accessTokenKey:o,accessTokenExpireKey:i,refreshTokenKey:s,anonymousUuidKey:a,loginTypeKey:u,userInfoKey:c};C[t]?C[t].updatePersistence(n):C[t]=new L(O(O({},e),{keys:f,platformInfo:r,alwaysLocalKeys:["anonymousUuidKey"]})),k[t]=k[t]||new L(O(O({},e),{keys:f,platformInfo:r,persistence:"local"}))}function D(e){return C[e]}function j(e){return k[e]}var M=n("f12e"),q={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},B=function(){return B=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},B.apply(this,arguments)},W=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},F=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},$=o["constants"].ERRORS,H=o["utils"].genSeqId,G=o["utils"].isFormData,V=o["utils"].formatUrl,K=o["utils"].createSign,J=o["adapters"].RUNTIME,Y=["auth.getJwt","auth.logout","auth.signInWithTicket","auth.signInAnonymously","auth.signIn","auth.fetchAccessTokenWithRefreshToken","auth.signUpWithEmailAndPassword","auth.activateEndUserMail","auth.sendPasswordResetEmail","auth.resetPasswordWithToken","auth.isUsernameRegistered"];function z(e,t,n){var r=e[t];e[t]=function(t){var o={},i={};n.forEach((function(n){var r=n.call(e,t),s=r.data,a=r.headers;Object.assign(o,s),Object.assign(i,a)}));var s=t.data;return s&&function(){if(G(s))for(var e in o)s.append(e,o[e]);else t.data=B(B({},s),o)}(),t.headers=B(B({},t.headers||{}),i),r.call(e,t)}}function X(){var e=H();return{data:{seqId:e},headers:{"X-SDK-Version":"@cloudbase/js-sdk/"+Object(M["e"])(),"x-seqid":e}}}var Z=function(){function e(e){this._throwWhenRequestFail=!1,this.config=e,this._reqClass=new I.adapter.reqClass({timeout:this.config.timeout,timeoutMsg:"[@cloudbase/js-sdk] 请求在"+this.config.timeout/1e3+"s内未完成，已中断",restrictedMethods:["post"]}),this._throwWhenRequestFail=e.throw||!1,this._cache=D(this.config.env),this._localCache=j(this.config.env),z(this._reqClass,"post",[X]),z(this._reqClass,"upload",[X]),z(this._reqClass,"download",[X])}return e.prototype.post=function(e){return W(this,void 0,void 0,(function(){var t;return F(this,(function(n){switch(n.label){case 0:return[4,this._reqClass.post(e)];case 1:return t=n.sent(),[2,t]}}))}))},e.prototype.upload=function(e){return W(this,void 0,void 0,(function(){var t;return F(this,(function(n){switch(n.label){case 0:return[4,this._reqClass.upload(e)];case 1:return t=n.sent(),[2,t]}}))}))},e.prototype.download=function(e){return W(this,void 0,void 0,(function(){var t;return F(this,(function(n){switch(n.label){case 0:return[4,this._reqClass.download(e)];case 1:return t=n.sent(),[2,t]}}))}))},e.prototype.refreshAccessToken=function(){return W(this,void 0,void 0,(function(){var e,t,n;return F(this,(function(r){switch(r.label){case 0:this._refreshAccessTokenPromise||(this._refreshAccessTokenPromise=this._refreshAccessToken()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._refreshAccessTokenPromise];case 2:return e=r.sent(),[3,4];case 3:return n=r.sent(),t=n,[3,4];case 4:if(this._refreshAccessTokenPromise=null,this._shouldRefreshAccessTokenHook=null,t)throw t;return[2,e]}}))}))},e.prototype.getAccessToken=function(){return W(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,a,u,c;return F(this,(function(f){switch(f.label){case 0:return e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,r=e.refreshTokenKey,[4,this._cache.getStoreAsync(r)];case 1:if(o=f.sent(),!o)throw new Error(JSON.stringify({code:$.OPERATION_FAIL,msg:"refresh token is not exist, your local data might be messed up, please retry after clear localStorage or sessionStorage"}));return[4,this._cache.getStoreAsync(t)];case 2:return i=f.sent(),a=Number,[4,this._cache.getStoreAsync(n)];case 3:return s=a.apply(void 0,[f.sent()]),u=!0,c=this._shouldRefreshAccessTokenHook,c?[4,this._shouldRefreshAccessTokenHook(i,s)]:[3,5];case 4:c=!f.sent(),f.label=5;case 5:return c&&(u=!1),i&&s&&!(s<Date.now())||!u?[3,7]:[4,this.refreshAccessToken()];case 6:return[2,f.sent()];case 7:return[2,{accessToken:i,accessTokenExpire:s}]}}))}))},e.prototype.request=function(e,t,n){return W(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,f,l,h,p,d,y,g,v,m,_,b,w,E,S,O,A,T,N,R,P;return F(this,(function(x){switch(x.label){case 0:return r="x-tcb-trace_"+this.config.env,o="application/x-www-form-urlencoded",i=B({action:e,dataVersion:M["a"],env:this.config.env},t),-1!==Y.indexOf(e)?[3,3]:(s=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(s)]);case 1:return a=x.sent(),a?(u=i,[4,this.getAccessToken()]):[3,3];case 2:u.access_token=x.sent().accessToken,x.label=3;case 3:if("storage.uploadFile"===e){for(f in c=new FormData,c)c.hasOwnProperty(f)&&void 0!==c[f]&&c.append(f,i[f]);o="multipart/form-data"}else for(f in o="application/json;charset=UTF-8",c={},i)void 0!==i[f]&&(c[f]=i[f]);return l={headers:{"content-type":o}},(null===n||void 0===n?void 0:n["onUploadProgress"])&&(l.onUploadProgress=n["onUploadProgress"]),this.config.region&&(l.headers["X-TCB-Region"]=this.config.region),h=this._localCache.getStore(r),h&&(l.headers["X-TCB-Trace"]=h),I.runtime!==J.WEB&&(p=this.config,d=p.appSign,y=p.appSecret,g=Date.now(),v=y.appAccessKey,m=y.appAccessKeyId,_=K({data:{},timestamp:g,appAccessKeyId:m,appSign:d},v),l.headers["X-TCB-App-Source"]="timestamp="+g+";appAccessKeyId="+m+";appSign="+d+";sign="+_),b=t.parse,w=t.inQuery,E=t.search,S={env:this.config.env},b&&(S.parse=!0),w&&(S=B(B({},w),S)),O=Object(M["c"])(),A=O.BASE_URL,T=O.PROTOCOL,N=V(T,A,S),E&&(N+=E),[4,this.post(B({url:N,data:c},l))];case 4:if(R=x.sent(),P=R.header&&R.header["x-tcb-trace"],P&&this._localCache.setStore(r,P),200!==Number(R.status)&&200!==Number(R.statusCode)||!R.data)throw new Error("network request error");return[2,R]}}))}))},e.prototype.send=function(e,t){return void 0===t&&(t={}),W(this,void 0,void 0,(function(){var n;return F(this,(function(r){switch(r.label){case 0:return[4,this.request(e,t,{onUploadProgress:t.onUploadProgress})];case 1:return n=r.sent(),"ACCESS_TOKEN_EXPIRED"!==n.data.code||-1!==Y.indexOf(e)?[3,4]:[4,this.refreshAccessToken()];case 2:return r.sent(),[4,this.request(e,t,{onUploadProgress:t.onUploadProgress})];case 3:n=r.sent(),r.label=4;case 4:if(n.data.code&&this._throwWhenRequestFail)throw new Error(JSON.stringify({code:$.OPERATION_FAIL,msg:"["+n.data.code+"] "+n.data.message}));return[2,n.data]}}))}))},e.prototype._refreshAccessToken=function(e){return void 0===e&&(e=1),W(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,f,l,h,p,d;return F(this,(function(y){switch(y.label){case 0:return t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,o=t.refreshTokenKey,i=t.loginTypeKey,s=t.anonymousUuidKey,[4,this._cache.removeStoreAsync(n)];case 1:return y.sent(),[4,this._cache.removeStoreAsync(r)];case 2:return y.sent(),[4,this._cache.getStoreAsync(o)];case 3:if(a=y.sent(),!a)throw new Error(JSON.stringify({code:$.INVALID_OPERATION,msg:"not login"}));return u={refresh_token:a},[4,this.request("auth.fetchAccessTokenWithRefreshToken",u)];case 4:return c=y.sent(),c.data.code?(f=c.data.code,"SIGN_PARAM_INVALID"!==f&&"REFRESH_TOKEN_EXPIRED"!==f&&"INVALID_REFRESH_TOKEN"!==f?[3,11]:[4,this._cache.getStoreAsync(i)]):[3,12];case 5:return l=y.sent()===M["b"].ANONYMOUS,l&&"INVALID_REFRESH_TOKEN"===f?[4,this._cache.getStoreAsync(s)]:[3,9];case 6:return h=y.sent(),[4,this._cache.getStoreAsync(o)];case 7:return p=y.sent(),[4,this.send("auth.signInAnonymously",{anonymous_uuid:h,refresh_token:p})];case 8:if(d=y.sent(),this._setRefreshToken(d.refresh_token),e>=1)return[2,this._refreshAccessToken(--e)];throw new Error(JSON.stringify({code:$.OPERATION_FAIL,message:"重试获取 refresh token 失败"}));case 9:return _e.fire(q.LOGIN_STATE_EXPIRED),[4,this._cache.removeStoreAsync(o)];case 10:y.sent(),y.label=11;case 11:throw new Error(JSON.stringify({code:$.NETWORK_ERROR,msg:"refresh access_token failed："+c.data.code}));case 12:return c.data.access_token?(_e.fire(q.ACCESS_TOKEN_REFRESHD),[4,this._cache.setStoreAsync(n,c.data.access_token)]):[3,15];case 13:return y.sent(),[4,this._cache.setStoreAsync(r,c.data.access_token_expire+Date.now())];case 14:return y.sent(),[2,{accessToken:c.data.access_token,accessTokenExpire:c.data.access_token_expire}];case 15:return c.data.refresh_token?[4,this._cache.removeStoreAsync(o)]:[3,19];case 16:return y.sent(),[4,this._cache.setStoreAsync(o,c.data.refresh_token)];case 17:return y.sent(),[4,this._refreshAccessToken()];case 18:y.sent(),y.label=19;case 19:return[2]}}))}))},e.prototype._setRefreshToken=function(e){return W(this,void 0,void 0,(function(){var t,n,r,o;return F(this,(function(i){switch(i.label){case 0:return t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,o=t.refreshTokenKey,[4,this._cache.removeStoreAsync(n)];case 1:return i.sent(),[4,this._cache.removeStoreAsync(r)];case 2:return i.sent(),[4,this._cache.setStoreAsync(o,e)];case 3:return i.sent(),[2]}}))}))},e}(),Q={};function ee(e){Q[e.env]=new Z(B(B({},e),{throw:!0}))}function te(e){return Q[e]}var ne=function(){return ne=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ne.apply(this,arguments)},re=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},oe=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},ie=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},se=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},ae=o["adapters"].useAdapters,ue=o["adapters"].useDefaultAdapter,ce=o["adapters"].RUNTIME,fe=o["constants"].ERRORS,le=o["constants"].COMMUNITY_SITE_URL,he=o["utils"].printWarn,pe=o["helpers"].catchErrorsDecorator,de={timeout:15e3,persistence:"local"},ye=6e5,ge=100,ve={},me=function(){function e(e){this._config=e||this._config,this.authInstance=null}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"platform",{get:function(){return I},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cache",{get:function(){return D(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localCache",{get:function(){return j(this._config.env)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"request",{get:function(){return te(this._config.env)},enumerable:!1,configurable:!0}),e.prototype.init=function(t){if(!t.env)throw new Error(JSON.stringify({code:fe.INVALID_PARAMS,msg:"env must not be specified"}));if(I.adapter||this._useDefaultAdapter(),this.requestClient=new I.adapter.reqClass({timeout:t.timeout||5e3,timeoutMsg:"["+Object(M["d"])()+"][REQUEST TIMEOUT] request had been abort since didn't finished within"+t.timeout/1e3+"s"}),I.runtime!==ce.WEB){if(!t.appSecret)throw new Error(JSON.stringify({code:fe.INVALID_PARAMS,msg:"invalid appSecret"}));var n=I.adapter.getAppSign?I.adapter.getAppSign():"";if(t.appSign&&n&&t.appSign!==n)throw new Error(JSON.stringify({code:fe.INVALID_PARAMS,msg:"invalid appSign"}));if(n&&(t.appSign=n),!t.appSign)throw new Error(JSON.stringify({code:fe.INVALID_PARAMS,msg:"invalid appSign"}))}this._config=ne(ne({},de),t),this._config.timeout=this._formatTimeout(this._config.timeout);var r=this._config,o=r.env,i=r.persistence,s=r.debug,a=r.timeout,u=r.appSecret,c=r.appSign;U({env:o,persistence:i,debug:s,platformInfo:this.platform}),ee({env:o,region:t.region||"",timeout:a,appSecret:u,appSign:c}),t.region&&Object(M["g"])(o,t.region||"");var f=new e(this._config);return f.requestClient=this.requestClient,f},e.prototype.updateConfig=function(e){var t=e.persistence,n=e.debug;this._config.persistence=t,this._config.debug=n,U({env:this._config.env,persistence:t,debug:n,platformInfo:this.platform})},e.prototype.registerExtension=function(e){ve[e.name]=e},e.prototype.invokeExtension=function(e,t){return ie(this,void 0,void 0,(function(){var n;return se(this,(function(r){switch(r.label){case 0:if(n=ve[e],!n)throw new Error(JSON.stringify({code:fe.INVALID_PARAMS,msg:"extension:"+e+" must be registered before invoke"}));return[4,n.invoke(t,this)];case 1:return[2,r.sent()]}}))}))},e.prototype.useAdapters=function(e){var t=ae(e)||{},n=t.adapter,r=t.runtime;n&&(I.adapter=n),r&&(I.runtime=r)},e.prototype.registerHook=function(t){S(e,t)},e.prototype.registerComponent=function(t){w(e,t)},e.prototype.registerVersion=function(e){Object(M["i"])(e)},e.prototype.registerSdkName=function(e){Object(M["h"])(e)},e.prototype.registerEndPoint=function(e,t){Object(M["f"])(e,t)},e.prototype._useDefaultAdapter=function(){var e=ue(),t=e.adapter,n=e.runtime;I.adapter=t,I.runtime=n},e.prototype._formatTimeout=function(e){switch(!0){case e>ye:return he(fe.INVALID_PARAMS,"timeout is greater than maximum value[10min]"),ye;case e<ge:return he(fe.INVALID_PARAMS,"timeout is less than maximum value[100ms]"),ge;default:return e}},re([pe({mode:"sync",title:"Cloudbase 初始化失败",messages:["请确认以下各项：","  1 - 调用 cloudbase.init() 的语法或参数是否正确","  2 - 如果是非浏览器环境，是否配置了安全应用来源（https://docs.cloudbase.net/api-reference/webv2/adapter.html#jie-ru-liu-cheng）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+le]}),oe("design:type",Function),oe("design:paramtypes",[Object]),oe("design:returntype",e)],e.prototype,"init",null),re([pe({title:"调用扩展能力失败",messages:["请确认以下各项：","  1 - 调用 invokeExtension() 的语法或参数是否正确","  2 - 被调用的扩展能力是否已经安装并通过 registerExtension() 注册","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+le]}),oe("design:type",Function),oe("design:paramtypes",[String,Object]),oe("design:returntype",Promise)],e.prototype,"invokeExtension",null),e}(),_e=new me;_e.useAdapters(v);var be,we=_e,Ee=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Se=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Ie=function(){function e(e){this._config=e,this._cache=e.cache,this._request=e.request}return e.prototype.checkLocalLoginState=function(){return Ee(this,void 0,void 0,(function(){var e,t,n,r,o,i;return Se(this,(function(s){switch(s.label){case 0:return e=this._cache.keys,t=e.accessTokenKey,n=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(t)];case 1:return r=s.sent(),[4,this._cache.getStoreAsync(n)];case 2:return o=s.sent(),r?o&&o>Date.now()?(i=new sn({envId:this._config.env,cache:this._cache,request:this._request}),[4,i.checkLocalStateAsync()]):[3,4]:[3,7];case 3:return s.sent(),[2,i];case 4:return[4,this._cache.removeStoreAsync(t)];case 5:return s.sent(),[4,this._cache.removeStoreAsync(n)];case 6:s.sent(),s.label=7;case 7:return[2]}}))}))},e.prototype.setRefreshToken=function(e){return Ee(this,void 0,void 0,(function(){var t,n,r,o;return Se(this,(function(i){switch(i.label){case 0:return t=this._cache.keys,n=t.accessTokenKey,r=t.accessTokenExpireKey,o=t.refreshTokenKey,[4,this._cache.removeStoreAsync(n)];case 1:return i.sent(),[4,this._cache.removeStoreAsync(r)];case 2:return i.sent(),[4,this._cache.setStoreAsync(o,e)];case 3:return i.sent(),[2]}}))}))},e.prototype.setAccessToken=function(e,t){return Ee(this,void 0,void 0,(function(){var n,r,o;return Se(this,(function(i){switch(i.label){case 0:return n=this._cache.keys,r=n.accessTokenKey,o=n.accessTokenExpireKey,[4,this._cache.setStoreAsync(r,e)];case 1:return i.sent(),[4,this._cache.setStoreAsync(o,t)];case 2:return i.sent(),[2]}}))}))},e.prototype.refreshUserInfo=function(){return Ee(this,void 0,void 0,(function(){var e,t;return Se(this,(function(n){switch(n.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return t=n.sent().data,[4,this.setLocalUserInfo(t)];case 2:return n.sent(),[2,t]}}))}))},e.prototype.setLocalUserInfo=function(e){return Ee(this,void 0,void 0,(function(){var t;return Se(this,(function(n){switch(n.label){case 0:return t=this._cache.keys.userInfoKey,[4,this._cache.setStoreAsync(t,e)];case 1:return n.sent(),[2]}}))}))},e}();(function(e){e["ANONYMOUS"]="ANONYMOUS",e["WECHAT"]="WECHAT",e["WECHAT_PUBLIC"]="WECHAT-PUBLIC",e["WECHAT_OPEN"]="WECHAT-OPEN",e["CUSTOM"]="CUSTOM",e["EMAIL"]="EMAIL",e["USERNAME"]="USERNAME",e["NULL"]="NULL",e["PHONE"]="PHONE"})(be||(be={}));var Oe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ae=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Te=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Ne=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Re=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Pe=o["constants"].getSdkName,xe=o["constants"].ERRORS,Le=o["constants"].COMMUNITY_SITE_URL,Ce=o["adapters"].RUNTIME,ke=o["utils"].getQuery,Ue=o["utils"].getHash,De=o["utils"].removeParam,je=o["utils"].printWarn,Me=o["helpers"].catchErrorsDecorator,qe=function(e){function t(t,n,r,o){var i=e.call(this,t)||this;return i._runtime=t.runtime,i._appid=n,i._scope=r,i._state=o||"weixin",i}return Oe(t,e),t.prototype.signIn=function(){return Ne(this,void 0,void 0,(function(){return Re(this,(function(e){return[2,je(xe.OPERATION_FAIL,"API signIn has been deprecated, please use signInWithRedirect insteed")]}))}))},t.prototype.signInWithRedirect=function(){return Ne(this,void 0,void 0,(function(){return Re(this,(function(e){return[2,this._redirect()]}))}))},t.prototype.getRedirectResult=function(e){return Ne(this,void 0,void 0,(function(){var t;return Re(this,(function(n){return t=Be(),t?[2,this._signInWithCode(t,e)]:[2,null]}))}))},t.prototype.getLinkRedirectResult=function(e){return void 0===e&&(e={}),Ne(this,void 0,void 0,(function(){var t,n,r,o,i,s;return Re(this,(function(a){return t=e.withUnionId,n=void 0!==t&&t,r=Be(),r?(o=this._appid,i=function(e){switch(e){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),s=this._runtime===Ce.WX_MP?"1":"0",[2,this._request.send("auth.linkWithWeixinCode",{payload:{appid:o,loginType:i,code:r,hybridMiniapp:s,withUnionId:n}})]):[2,null]}))}))},t.prototype._redirect=function(){var e=De("code",location.href);e=De("state",e),e=encodeURIComponent(e);var t="//open.weixin.qq.com/connect/oauth2/authorize";"snsapi_login"===this._scope&&(t="//open.weixin.qq.com/connect/qrconnect");try{location.href=t+"?appid="+this._appid+"&redirect_uri="+e+"&response_type=code&scope="+this._scope+"&state="+this._state+"#wechat_redirect"}catch(n){throw new Error("["+Pe()+"]["+xe.UNKOWN_ERROR+"]"+n)}},t.prototype._signInWithCode=function(e,t){return Ne(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c;return Re(this,(function(f){switch(f.label){case 0:return n=this._cache.keys,r=n.accessTokenKey,o=n.accessTokenExpireKey,i=n.refreshTokenKey,s=function(e){switch(e){case"snsapi_login":return"WECHAT-OPEN";default:return"WECHAT-PUBLIC"}}(this._scope),[4,this._getRefreshTokenByWXCode(this._appid,s,e,t)];case 1:return a=f.sent(),u=a.refreshToken,[4,this._cache.setStoreAsync(i,u)];case 2:return f.sent(),a.accessToken?[4,this._cache.setStoreAsync(r,a.accessToken)]:[3,4];case 3:f.sent(),f.label=4;case 4:return a.accessTokenExpire?[4,this._cache.setStoreAsync(o,String(a.accessTokenExpire+Date.now()))]:[3,6];case 5:f.sent(),f.label=6;case 6:return rn.fire(un.LOGIN_STATE_CHANGED),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.WECHAT,persistence:this._config.persistence}),[4,this.refreshUserInfo()];case 7:return f.sent(),c=new sn({envId:this._config.env,cache:this._cache,request:this._request}),[4,c.checkLocalStateAsync()];case 8:return f.sent(),[2,c]}}))}))},t.prototype._getRefreshTokenByWXCode=function(e,t,n,r){return void 0===r&&(r={}),Ne(this,void 0,void 0,(function(){var o,i,s,a,u,c,f;return Re(this,(function(l){return o=r.withUnionId,i=void 0!==o&&o,s=r.createUser,a=void 0===s||s,u="snsapi_base"!==this._scope&&(r.syncUserInfo||!1),c="auth.signIn",f=this._runtime===Ce.WX_MP?"1":"0",[2,this._request.send(c,{appid:e,loginType:t,hybridMiniapp:f,syncUserInfo:u,loginCredential:n,withUnionId:i,createUser:a}).then((function(e){if(e.code)throw new Error("["+Pe()+"]["+xe.OPERATION_FAIL+"] failed login via wechat: "+e.code);if(e.refresh_token)return{refreshToken:e.refresh_token,accessToken:e.access_token,accessTokenExpire:e.access_token_expire};throw new Error("["+Pe()+"]["+xe.OPERATION_FAIL+"] action:getJwt not return refreshToken")}))]}))}))},Ae([Me({title:"跳转微信公众号授权失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().signInWithRedirect() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Le]}),Te("design:type",Function),Te("design:paramtypes",[]),Te("design:returntype",Promise)],t.prototype,"signInWithRedirect",null),Ae([Me({title:"微信公众号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Le]}),Te("design:type",Function),Te("design:paramtypes",[Object]),Te("design:returntype",Promise)],t.prototype,"getRedirectResult",null),Ae([Me({title:"获取微信重定向绑定结果",messages:["请确认以下各项：","  1 - 调用 auth().weixinAuthProvider().getLinkRedirectResult() 的语法或参数是否正确","  2 - 当前环境是否开通了微信公众号登录授权","  3 - 微信公众号的 AppId 与 AppSecret 配置是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Le]}),Te("design:type",Function),Te("design:paramtypes",[Object]),Te("design:returntype",Promise)],t.prototype,"getLinkRedirectResult",null),t}(Ie);function Be(){return ke("code")||Ue("code")}var We=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fe=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},$e=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},He=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Ge=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Ve=o["constants"].ERRORS,Ke=o["constants"].COMMUNITY_SITE_URL,Je=o["utils"].throwError,Ye=o["utils"].isString,ze=o["events"].addEventListener,Xe=o["helpers"].catchErrorsDecorator,Ze=function(e){function t(t){var n=e.call(this,t)||this;return n._onConverted=n._onConverted.bind(n),ze(un.ANONYMOUS_CONVERTED,n._onConverted),n}return We(t,e),t.prototype.signIn=function(){return He(this,void 0,void 0,(function(){var e,t,n,r,o,i,s;return Ge(this,(function(a){switch(a.label){case 0:return[4,this._cache.updatePersistenceAsync("local")];case 1:return a.sent(),e=this._cache.keys,t=e.anonymousUuidKey,n=e.refreshTokenKey,[4,this._cache.getStoreAsync(t)];case 2:return r=a.sent(),[4,this._cache.getStoreAsync(n)];case 3:return o=a.sent(),[4,this._request.send("auth.signInAnonymously",{anonymous_uuid:r,refresh_token:o})];case 4:return i=a.sent(),i.uuid&&i.refresh_token?[4,this._setAnonymousUUID(i.uuid)]:[3,10];case 5:return a.sent(),[4,this.setRefreshToken(i.refresh_token)];case 6:return a.sent(),[4,this._request.refreshAccessToken()];case 7:return a.sent(),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.ANONYMOUS,persistence:"local"}),rn.fire(un.LOGIN_STATE_CHANGED),s=new sn({envId:this._config.env,cache:this._cache,request:this._request}),[4,s.checkLocalStateAsync()];case 8:return a.sent(),[4,s.user.refresh()];case 9:return a.sent(),[2,s];case 10:throw new Error(JSON.stringify({code:Ve.OPERATION_FAIL,msg:JSON.stringify(i)||"anonymous signIn failed"}))}}))}))},t.prototype.linkAndRetrieveDataWithTicket=function(e){return He(this,void 0,void 0,(function(){var t,n,r,o,i,s,a;return Ge(this,(function(u){switch(u.label){case 0:return Ye(e)||Je(Ve.INVALID_PARAMS,"ticket must be a string"),t=this._cache.keys,n=t.anonymousUuidKey,r=t.refreshTokenKey,[4,this._cache.getStoreAsync(n)];case 1:return o=u.sent(),[4,this._cache.getStoreAsync(r)];case 2:return i=u.sent(),[4,this._request.send("auth.linkAndRetrieveDataWithTicket",{anonymous_uuid:o,refresh_token:i,ticket:e})];case 3:return s=u.sent(),s.refresh_token?[4,this._clearAnonymousUUID()]:[3,8];case 4:return u.sent(),[4,this.setRefreshToken(s.refresh_token)];case 5:return u.sent(),[4,this._request.refreshAccessToken()];case 6:return u.sent(),rn.fire(un.ANONYMOUS_CONVERTED,{env:this._config.env}),rn.fire(un.LOGIN_TYPE_CHANGED,{loginType:be.CUSTOM,persistence:"local"}),a=new sn({envId:this._config.env,cache:this._cache,request:this._request}),[4,a.checkLocalStateAsync()];case 7:return u.sent(),[2,a];case 8:Je(Ve.OPERATION_FAIL,JSON.stringify(s)||"linkAndRetrieveDataWithTicket failed"),u.label=9;case 9:return[2]}}))}))},t.prototype._setAnonymousUUID=function(e){return He(this,void 0,void 0,(function(){var t,n,r;return Ge(this,(function(o){switch(o.label){case 0:return t=this._cache.keys,n=t.anonymousUuidKey,r=t.loginTypeKey,[4,this._cache.removeStoreAsync(n)];case 1:return o.sent(),[4,this._cache.setStoreAsync(n,e)];case 2:return o.sent(),[4,this._cache.setStoreAsync(r,be.ANONYMOUS)];case 3:return o.sent(),[2]}}))}))},t.prototype._clearAnonymousUUID=function(){return He(this,void 0,void 0,(function(){return Ge(this,(function(e){switch(e.label){case 0:return[4,this._cache.removeStoreAsync(this._cache.keys.anonymousUuidKey)];case 1:return e.sent(),[2]}}))}))},t.prototype._onConverted=function(e){return He(this,void 0,void 0,(function(){var t;return Ge(this,(function(n){switch(n.label){case 0:return t=e.data.env,t!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(this._config.persistence)];case 1:return n.sent(),[2]}}))}))},Fe([Xe({title:"匿名登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了匿名登录","  2 - 调用 auth().anonymouseProvider().signIn() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Ke]}),$e("design:type",Function),$e("design:paramtypes",[]),$e("design:returntype",Promise)],t.prototype,"signIn",null),t}(Ie),Qe=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),et=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},tt=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},nt=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},rt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},ot=o["constants"].ERRORS,it=o["constants"].COMMUNITY_SITE_URL,st=o["utils"].isString,at=o["helpers"].catchErrorsDecorator,ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qe(t,e),t.prototype.signIn=function(e){return nt(this,void 0,void 0,(function(){var t,n,r,o,i,s,a;return rt(this,(function(u){switch(u.label){case 0:if(!st(e))throw new Error(JSON.stringify({code:ot.INVALID_PARAMS,msg:"ticket must be a string"}));return t=this._cache.keys.refreshTokenKey,o=(r=this._request).send,i=["auth.signInWithTicket"],s={ticket:e},[4,this._cache.getStoreAsync(t)];case 1:return[4,o.apply(r,i.concat([(s.refresh_token=u.sent()||"",s)]))];case 2:return n=u.sent(),n.refresh_token?[4,this.setRefreshToken(n.refresh_token)]:[3,7];case 3:return u.sent(),[4,this._request.refreshAccessToken()];case 4:return u.sent(),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.CUSTOM,persistence:this._config.persistence}),rn.fire(un.LOGIN_STATE_CHANGED),[4,this.refreshUserInfo()];case 5:return u.sent(),a=new sn({envId:this._config.env,cache:this._cache,request:this._request}),[4,a.checkLocalStateAsync()];case 6:return u.sent(),[2,a];case 7:throw new Error(JSON.stringify({code:ot.OPERATION_FAIL,msg:"custom signIn failed"}))}}))}))},et([at({title:"自定义登录失败",messages:["请确认以下各项：","  1 - 当前环境是否开启了自定义登录","  2 - 调用 auth().customAuthProvider().signIn() 的语法或参数是否正确","  3 - ticket 是否归属于当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+it]}),tt("design:type",Function),tt("design:paramtypes",[String]),tt("design:returntype",Promise)],t.prototype,"signIn",null),t}(Ie),ct=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ft=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},lt=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},ht=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},pt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},dt=o["utils"].throwError,yt=o["utils"].isString,gt=o["constants"].ERRORS,vt=o["constants"].COMMUNITY_SITE_URL,mt=o["helpers"].catchErrorsDecorator,_t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ct(t,e),t.prototype.signIn=function(e,t){return ht(this,void 0,void 0,(function(){var n,r,o,i,s;return pt(this,(function(a){switch(a.label){case 0:return yt(e)||dt(gt.INVALID_PARAMS,"email must be a string"),n=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:"EMAIL",email:e,password:t,refresh_token:this._cache.getStore(n)||""})];case 1:return r=a.sent(),o=r.refresh_token,i=r.access_token,s=r.access_token_expire,o?[4,this.setRefreshToken(o)]:[3,8];case 2:return a.sent(),i&&s?[4,this.setAccessToken(i,s)]:[3,4];case 3:return a.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:a.sent(),a.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return a.sent(),rn.fire(un.LOGIN_STATE_CHANGED),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.EMAIL,persistence:this._config.persistence}),[2,new sn({envId:this._config.env,cache:this._cache,request:this._request})];case 8:r.code?dt(gt.OPERATION_FAIL,"Email login fail["+r.code+"] "+r.message):dt(gt.OPERATION_FAIL,"Email login fail"),a.label=9;case 9:return[2]}}))}))},t.prototype.signUp=function(e,t){return ht(this,void 0,void 0,(function(){return pt(this,(function(n){return[2,this._request.send("auth.signUpWithEmailAndPassword",{email:e,password:t})]}))}))},t.prototype.resetPassword=function(e){return ht(this,void 0,void 0,(function(){return pt(this,(function(t){return[2,this._request.send("auth.sendPasswordResetEmail",{email:e})]}))}))},t.prototype.resetPasswordWithToken=function(e,t){return ht(this,void 0,void 0,(function(){return pt(this,(function(n){return[2,this._request.send("auth.resetPasswordWithToken",{token:e,newPassword:t})]}))}))},t.prototype.activate=function(e){return ht(this,void 0,void 0,(function(){return pt(this,(function(t){return[2,this._request.send("auth.activateEndUserMail",{token:e})]}))}))},ft([mt({title:"邮箱密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().emailAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 邮箱地址与密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+vt]}),lt("design:type",Function),lt("design:paramtypes",[String,String]),lt("design:returntype",Promise)],t.prototype,"signIn",null),ft([mt({title:"邮箱注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithEmailAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+vt]}),lt("design:type",Function),lt("design:paramtypes",[String,String]),lt("design:returntype",Promise)],t.prototype,"signUp",null),ft([mt({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用 auth().sendPasswordResetEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","  3 - 此邮箱地址是否已经与当前用户绑定","  4 - 此邮箱地址是否已经被其他用户占用","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+vt]}),lt("design:type",Function),lt("design:paramtypes",[String]),lt("design:returntype",Promise)],t.prototype,"resetPassword",null),ft([mt({title:"重置密码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+vt]}),lt("design:type",Function),lt("design:paramtypes",[String,String]),lt("design:returntype",Promise)],t.prototype,"resetPasswordWithToken",null),ft([mt({title:"邮箱激活失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了邮箱登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+vt]}),lt("design:type",Function),lt("design:paramtypes",[String]),lt("design:returntype",Promise)],t.prototype,"activate",null),t}(Ie),bt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),wt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Et=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},St=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},It=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Ot=o["utils"].printWarn,At=o["constants"].ERRORS,Tt=o["constants"].COMMUNITY_SITE_URL,Nt=o["helpers"].catchErrorsDecorator,Rt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return bt(t,e),t.prototype.signIn=function(e,t){return St(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,f;return It(this,(function(l){switch(l.label){case 0:if("string"!==typeof e)throw new Error(JSON.stringify({code:At.INVALID_PARAMS,msg:"username must be a string"}));return"string"!==typeof t&&(t="",Ot(At.INVALID_PARAMS,"password is empty")),n=this._cache.keys.refreshTokenKey,i=(o=this._request).send,s=["auth.signIn"],a={loginType:be.USERNAME,username:e,password:t},[4,this._cache.getStoreAsync(n)];case 1:return[4,i.apply(o,s.concat([(a.refresh_token=l.sent()||"",a)]))];case 2:return r=l.sent(),u=r.refresh_token,c=r.access_token_expire,f=r.access_token,u?[4,this.setRefreshToken(u)]:[3,9];case 3:return l.sent(),f&&c?[4,this.setAccessToken(f,c)]:[3,5];case 4:return l.sent(),[3,7];case 5:return[4,this._request.refreshAccessToken()];case 6:l.sent(),l.label=7;case 7:return[4,this.refreshUserInfo()];case 8:return l.sent(),rn.fire(un.LOGIN_STATE_CHANGED),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.USERNAME,persistence:this._config.persistence}),[2,new sn({envId:this._config.env,cache:this._cache,request:this._request})];case 9:throw r.code?new Error(JSON.stringify({code:At.OPERATION_FAIL,msg:"login by username failed:["+r.code+"] "+r.message})):new Error(JSON.stringify({code:At.OPERATION_FAIL,msg:"login by username failed"}));case 10:return[2]}}))}))},wt([Nt({title:"用户名密码登录失败",messages:["请确认以下各项：","  1 - 调用 auth().signInWithUsernameAndPassword() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","  3 - 用户名密码是否匹配","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Tt]}),Et("design:type",Function),Et("design:paramtypes",[String,String]),Et("design:returntype",Promise)],t.prototype,"signIn",null),t}(Ie),Pt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),xt=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Lt=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Ct=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},kt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Ut=o["utils"].throwError,Dt=o["utils"].isString,jt=o["utils"].transformPhone,Mt=o["constants"].ERRORS,qt=o["constants"].COMMUNITY_SITE_URL,Bt=o["helpers"].catchErrorsDecorator,Wt={SIGNIN:"SIGNIN",SIGNUP:"SIGNUP",FORCERESETPWD:"FORCERESETPWD"},Ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Pt(t,e),t.prototype.signIn=function(e){return Ct(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c;return kt(this,(function(f){switch(f.label){case 0:return t=e.phoneNumber,n=e.phoneCode,r=e.password,o=e.signMethod,Dt(t)||Ut(Mt.INVALID_PARAMS,"phoneNumber must be a string"),Dt(n)||Dt(r)||Ut(Mt.INVALID_PARAMS,"phoneCode or password must be a string"),o||(o=Wt.SIGNIN),i=this._cache.keys.refreshTokenKey,[4,this._request.send("auth.signIn",{loginType:be.PHONE,phoneNumber:jt(t),phoneCode:n,password:r,refresh_token:this._cache.getStore(i)||"",signMethod:o})];case 1:return s=f.sent(),a=s.refresh_token,u=s.access_token,c=s.access_token_expire,a?[4,this.setRefreshToken(a)]:[3,8];case 2:return f.sent(),u&&c?[4,this.setAccessToken(u,c)]:[3,4];case 3:return f.sent(),[3,6];case 4:return[4,this._request.refreshAccessToken()];case 5:f.sent(),f.label=6;case 6:return[4,this.refreshUserInfo()];case 7:return f.sent(),rn.fire(un.LOGIN_STATE_CHANGED),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.PHONE,persistence:this._config.persistence}),[2,new sn({envId:this._config.env,cache:this._cache,request:this._request})];case 8:s.code?Ut(Mt.OPERATION_FAIL,"Phone login fail["+s.code+"] "+s.message):Ut(Mt.OPERATION_FAIL,"Phone login fail"),f.label=9;case 9:return[2]}}))}))},t.prototype.signUp=function(e,t,n){return Ct(this,void 0,void 0,(function(){return kt(this,(function(r){return[2,this.signIn({phoneNumber:e,phoneCode:t,password:n,signMethod:Wt.SIGNUP})]}))}))},t.prototype.forceResetPwd=function(e,t,n){return Ct(this,void 0,void 0,(function(){return kt(this,(function(r){return[2,this.signIn({phoneNumber:e,phoneCode:t,password:n,signMethod:Wt.FORCERESETPWD})]}))}))},xt([Bt({title:"手机号登录失败",messages:["请确认以下各项：","  1 - 调用 auth().SmsAuthProvider() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","  3 - 短信验证码/密码是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+qt]}),Lt("design:type",Function),Lt("design:paramtypes",[Object]),Lt("design:returntype",Promise)],t.prototype,"signIn",null),xt([Bt({title:"手机短信注册失败",messages:["请确认以下各项：","  1 - 调用 auth().signUpWithPhoneCode() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+qt]}),Lt("design:type",Function),Lt("design:paramtypes",[String,String,String]),Lt("design:returntype",Promise)],t.prototype,"signUp",null),xt([Bt({title:"手机密码重置失败",messages:["请确认以下各项：","  1 - 调用 auth().forceResetPwd() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+qt]}),Lt("design:type",Function),Lt("design:paramtypes",[String,String,String]),Lt("design:returntype",Promise)],t.prototype,"forceResetPwd",null),t}(Ie),$t=function(){return $t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},$t.apply(this,arguments)},Ht=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Gt=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Vt=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Kt=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Jt=o["events"].CloudbaseEventEmitter,Yt=o["adapters"].RUNTIME,zt=o["utils"].printWarn,Xt=o["utils"].throwError,Zt=o["utils"].transformPhone,Qt=o["constants"].ERRORS,en=o["constants"].COMMUNITY_SITE_URL,tn=o["helpers"].catchErrorsDecorator,nn="auth",rn=new Jt,on=function(){function e(e){var t=e.cache,n=e.request;this._cache=t,this._request=n,this._setUserInfo()}return e.prototype.checkLocalInfo=function(){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(e){return this.uid=this._getLocalUserInfo("uid"),this.loginType=this._getLocalUserInfo("loginType"),this.openid=this._getLocalUserInfo("wxOpenId"),this.wxOpenId=this._getLocalUserInfo("wxOpenId"),this.wxPublicId=this._getLocalUserInfo("wxPublicId"),this.unionId=this._getLocalUserInfo("wxUnionId"),this.qqMiniOpenId=this._getLocalUserInfo("qqMiniOpenId"),this.customUserId=this._getLocalUserInfo("customUserId"),this.nickName=this._getLocalUserInfo("nickName"),this.gender=this._getLocalUserInfo("gender"),this.avatarUrl=this._getLocalUserInfo("avatarUrl"),this.email=this._getLocalUserInfo("email"),this.hasPassword=Boolean(this._getLocalUserInfo("hasPassword")),this.phone=this._getLocalUserInfo("phone"),this.username=this._getLocalUserInfo("username"),this.location={country:this._getLocalUserInfo("country"),province:this._getLocalUserInfo("province"),city:this._getLocalUserInfo("city")},[2]}))}))},e.prototype.checkLocalInfoAsync=function(){return Vt(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,a,u,c,f,l,h,p,d,y,g,v;return Kt(this,(function(m){switch(m.label){case 0:return e=this,[4,this._getLocalUserInfoAsync("uid")];case 1:return e.uid=m.sent(),t=this,[4,this._getLocalUserInfoAsync("loginType")];case 2:return t.loginType=m.sent(),n=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 3:return n.openid=m.sent(),r=this,[4,this._getLocalUserInfoAsync("wxOpenId")];case 4:return r.wxOpenId=m.sent(),o=this,[4,this._getLocalUserInfoAsync("wxPublicId")];case 5:return o.wxPublicId=m.sent(),i=this,[4,this._getLocalUserInfoAsync("wxUnionId")];case 6:return i.unionId=m.sent(),s=this,[4,this._getLocalUserInfoAsync("qqMiniOpenId")];case 7:return s.qqMiniOpenId=m.sent(),a=this,[4,this._getLocalUserInfoAsync("customUserId")];case 8:return a.customUserId=m.sent(),u=this,[4,this._getLocalUserInfoAsync("nickName")];case 9:return u.nickName=m.sent(),c=this,[4,this._getLocalUserInfoAsync("gender")];case 10:return c.gender=m.sent(),f=this,[4,this._getLocalUserInfoAsync("avatarUrl")];case 11:return f.avatarUrl=m.sent(),l=this,[4,this._getLocalUserInfoAsync("email")];case 12:return l.email=m.sent(),h=this,p=Boolean,[4,this._getLocalUserInfoAsync("hasPassword")];case 13:return h.hasPassword=p.apply(void 0,[m.sent()]),d=this,[4,this._getLocalUserInfoAsync("phone")];case 14:return d.phone=m.sent(),y=this,[4,this._getLocalUserInfoAsync("username")];case 15:return y.username=m.sent(),g=this,v={},[4,this._getLocalUserInfoAsync("country")];case 16:return v.country=m.sent(),[4,this._getLocalUserInfoAsync("province")];case 17:return v.province=m.sent(),[4,this._getLocalUserInfoAsync("city")];case 18:return g.location=(v.city=m.sent(),v),[2]}}))}))},e.prototype.linkWithTicket=function(e){if("string"!==typeof e)throw new Error("ticket must be string");return this._request.send("auth.linkWithTicket",{ticket:e})},e.prototype.linkWithRedirect=function(e){e.signInWithRedirect()},e.prototype.getLinkedUidList=function(){return Vt(this,void 0,void 0,(function(){var e,t,n,r,o,i;return Kt(this,(function(s){switch(s.label){case 0:return[4,this._request.send("auth.getLinkedUidList",{})];case 1:for(e=s.sent().data,t=!1,n=e.users,r=0,o=n;r<o.length;r++)if(i=o[r],i.wxOpenId&&i.wxPublicId){t=!0;break}return[2,{users:n,hasPrimaryUid:t}]}}))}))},e.prototype.setPrimaryUid=function(e){return this._request.send("auth.setPrimaryUid",{uid:e})},e.prototype.unlink=function(e){return this._request.send("auth.unlink",{platform:e})},e.prototype.update=function(e){return Vt(this,void 0,void 0,(function(){var t,n,r,o,i,s,a;return Kt(this,(function(u){switch(u.label){case 0:return t=e.nickName,n=e.gender,r=e.avatarUrl,o=e.province,i=e.country,s=e.city,[4,this._request.send("auth.updateUserInfo",{nickName:t,gender:n,avatarUrl:r,province:o,country:i,city:s})];case 1:return a=u.sent().data,this._setLocalUserInfo(a),[2]}}))}))},e.prototype.updatePassword=function(e,t){return this._request.send("auth.updatePassword",{oldPassword:t,newPassword:e})},e.prototype.updateEmail=function(e,t){return this._request.send("auth.updateEmail",{newEmail:e,password:t})},e.prototype.updateUsername=function(e){return"string"!==typeof e&&Xt(Qt.INVALID_PARAMS,"username must be a string"),this._request.send("auth.updateUsername",{username:e})},e.prototype.refresh=function(){return Vt(this,void 0,void 0,(function(){var e,t;return Kt(this,(function(n){switch(n.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return t=n.sent().data,this._setLocalUserInfo(t),[2,t]}}))}))},e.prototype.linkWithPhoneNumber=function(e,t){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(n){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:Zt(e),phoneCode:t})]}))}))},e.prototype.updatePhoneNumber=function(e,t){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(n){return[2,this._request.send("auth.linkOrUpdatePhoneNumber",{phoneNumber:Zt(e),phoneCode:t})]}))}))},e.prototype._getLocalUserInfo=function(e){var t=this._cache.keys.userInfoKey,n=this._cache.getStore(t);return n[e]},e.prototype._getLocalUserInfoAsync=function(e){return Vt(this,void 0,void 0,(function(){var t,n;return Kt(this,(function(r){switch(r.label){case 0:return t=this._cache.keys.userInfoKey,[4,this._cache.getStoreAsync(t)];case 1:return n=r.sent(),[2,n[e]]}}))}))},e.prototype._setUserInfo=function(){var e=this,t=this._cache.keys.userInfoKey,n=this._cache.getStore(t);["uid","loginType","openid","wxOpenId","wxPublicId","unionId","qqMiniOpenId","email","hasPassword","customUserId","nickName","gender","avatarUrl","phone","username"].forEach((function(t){e[t]=n[t]})),this.location={country:n["country"],province:n["province"],city:n["city"]}},e.prototype._setLocalUserInfo=function(e){var t=this._cache.keys.userInfoKey;this._cache.setStore(t,e),this._setUserInfo()},Ht([tn({title:"绑定自定义登录失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithTicket() 的语法或参数是否正确","  2 - 此账户是否已经绑定自定义登录","  3 - ticket 参数是否归属当前环境","  4 - 创建 ticket 的自定义登录私钥是否过期","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String]),Gt("design:returntype",Promise)],e.prototype,"linkWithTicket",null),Ht([tn({title:"绑定第三方登录方式失败",messages:["请确认以下各项：","  1 - 调用 User.linkWithRedirect() 的语法或参数是否正确","  2 - 此账户是否已经绑定此第三方","  3 - 此第三方是否已经授权","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[Object]),Gt("design:returntype",void 0)],e.prototype,"linkWithRedirect",null),Ht([tn({title:"获取账户列表失败",messages:["请确认以下各项：","  1 - 调用 User.getLinkedUidList() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[]),Gt("design:returntype",Promise)],e.prototype,"getLinkedUidList",null),Ht([tn({title:"设置微信主账号失败",messages:["请确认以下各项：","  1 - 调用 User.setPrimaryUid() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String]),Gt("design:returntype",void 0)],e.prototype,"setPrimaryUid",null),Ht([tn({title:"接触绑定失败",messages:["请确认以下各项：","  1 - 调用 User.unlink() 的语法或参数是否正确","  2 - 当前账户是否已经与此登录方式解绑","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String]),Gt("design:returntype",void 0)],e.prototype,"unlink",null),Ht([tn({title:"更新用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.update() 的语法或参数是否正确","  2 - 用户信息中是否包含非法值","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[Object]),Gt("design:returntype",Promise)],e.prototype,"update",null),Ht([tn({title:"更新密码失败",messages:["请确认以下各项：","  1 - 调用 User.updatePassword() 的语法或参数是否正确","  3 - 新密码中是否包含非法字符","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String,String]),Gt("design:returntype",void 0)],e.prototype,"updatePassword",null),Ht([tn({title:"更新邮箱地址失败",messages:["请确认以下各项：","  1 - 调用 User.updateEmail() 的语法或参数是否正确","  2 - 当前环境是否开通了邮箱密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String,String]),Gt("design:returntype",void 0)],e.prototype,"updateEmail",null),Ht([tn({title:"更新用户名失败",messages:["请确认以下各项：","  1 - 调用 User.updateUsername() 的语法或参数是否正确","  2 - 当前环境是否开通了用户名密码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String]),Gt("design:returntype",void 0)],e.prototype,"updateUsername",null),Ht([tn({title:"刷新本地用户信息失败",messages:["请确认以下各项：","  1 - 调用 User.refresh() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[]),Gt("design:returntype",Promise)],e.prototype,"refresh",null),Ht([tn({title:"绑定手机号失败",messages:["请确认以下各项：","  1 - 调用 auth().linkWithPhoneNumber() 的语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String,String]),Gt("design:returntype",Promise)],e.prototype,"linkWithPhoneNumber",null),Ht([tn({title:"更新手机号失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String,String]),Gt("design:returntype",Promise)],e.prototype,"updatePhoneNumber",null),e}(),sn=function(){function e(e){var t=e.envId,n=e.cache,r=e.request;t||Xt(Qt.INVALID_PARAMS,"envId is not defined"),this._cache=n,this.user=new on({cache:n,request:r})}return e.prototype.checkLocalState=function(){return Vt(this,void 0,void 0,(function(){var e,t,n,r,o,i,s;return Kt(this,(function(a){return e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=e.accessTokenExpireKey,o=this._cache.getStore(t),i=this._cache.getStore(n),s=this._cache.getStore(r),this.credential={refreshToken:o,accessToken:i,accessTokenExpire:s},this._loginType=this._cache.getStore(this._cache.keys.loginTypeKey),this.user.checkLocalInfo(),[2]}))}))},e.prototype.checkLocalStateAsync=function(){return Vt(this,void 0,void 0,(function(){var e,t,n,r,o,i,s,a;return Kt(this,(function(u){switch(u.label){case 0:return e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=e.accessTokenExpireKey,[4,this._cache.getStoreAsync(t)];case 1:return o=u.sent(),[4,this._cache.getStoreAsync(n)];case 2:return i=u.sent(),[4,this._cache.getStoreAsync(r)];case 3:return s=u.sent(),this.credential={refreshToken:o,accessToken:i,accessTokenExpire:s},a=this,[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 4:return a._loginType=u.sent(),[4,this.user.checkLocalInfoAsync()];case 5:return u.sent(),[2]}}))}))},Object.defineProperty(e.prototype,"isAnonymousAuth",{get:function(){return this.loginType===be.ANONYMOUS},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCustomAuth",{get:function(){return this.loginType===be.CUSTOM},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWeixinAuth",{get:function(){return this.loginType===be.WECHAT||this.loginType===be.WECHAT_OPEN||this.loginType===be.WECHAT_PUBLIC},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUsernameAuth",{get:function(){return this.loginType===be.USERNAME},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loginType",{get:function(){return this._loginType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPhoneAuth",{get:function(){return this.loginType===be.PHONE},enumerable:!1,configurable:!0}),e}(),an=function(){function e(e){this._config=e,this._cache=e.cache,this._request=e.request,this._runtime=e.runtime||Yt.WEB,rn.on(un.LOGIN_TYPE_CHANGED,this._onLoginTypeChanged.bind(this))}return Object.defineProperty(e.prototype,"currentUser",{get:function(){if("async"!==this._cache.mode){var e=this.hasLoginState();return e&&e.user||null}zt(Qt.INVALID_OPERATION,"current platform's storage is asynchronous, please use getCurrenUser insteed")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loginType",{get:function(){return this._cache.getStore(this._cache.keys.loginTypeKey)},enumerable:!1,configurable:!0}),e.prototype.getCurrenUser=function(){return Vt(this,void 0,void 0,(function(){var e;return Kt(this,(function(t){switch(t.label){case 0:return[4,this.getLoginState()];case 1:return e=t.sent(),e?[4,e.user.checkLocalInfoAsync()]:[3,3];case 2:return t.sent(),[2,e.user||null];case 3:return[2,null]}}))}))},e.prototype.getLoginType=function(){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(e){switch(e.label){case 0:return[4,this._cache.getStoreAsync(this._cache.keys.loginTypeKey)];case 1:return[2,e.sent()]}}))}))},e.prototype.getAccessToken=function(){return Vt(this,void 0,void 0,(function(){var e;return Kt(this,(function(t){switch(t.label){case 0:return e={},[4,this._request.getAccessToken()];case 1:return[2,(e.accessToken=t.sent().accessToken,e.env=this._config.env,e)]}}))}))},e.prototype.weixinAuthProvider=function(e){var t=e.appid,n=e.scope,r=e.state;return this._weixinAuthProvider||(this._weixinAuthProvider=new qe($t($t({},this._config),{cache:this._cache,request:this._request,runtime:this._runtime}),t,n,r)),this._weixinAuthProvider},e.prototype.anonymousAuthProvider=function(){return this._anonymousAuthProvider||(this._anonymousAuthProvider=new Ze($t($t({},this._config),{cache:this._cache,request:this._request}))),this._anonymousAuthProvider},e.prototype.customAuthProvider=function(){return this._customAuthProvider||(this._customAuthProvider=new ut($t($t({},this._config),{cache:this._cache,request:this._request}))),this._customAuthProvider},e.prototype.emailAuthProvider=function(){return this._emailAuthProvider||(this._emailAuthProvider=new _t($t($t({},this._config),{cache:this._cache,request:this._request}))),this._emailAuthProvider},e.prototype.usernameAuthProvider=function(){return this._usernameAuthProvider||(this._usernameAuthProvider=new Rt($t($t({},this._config),{cache:this._cache,request:this._request}))),this._usernameAuthProvider},e.prototype.phoneAuthProvider=function(){return this._phoneAuthProvider||(this._phoneAuthProvider=new Ft($t($t({},this._config),{cache:this._cache,request:this._request}))),this._phoneAuthProvider},e.prototype.signInWithUsernameAndPassword=function(e,t){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(n){return[2,this.usernameAuthProvider().signIn(e,t)]}))}))},e.prototype.isUsernameRegistered=function(e){return Vt(this,void 0,void 0,(function(){var t;return Kt(this,(function(n){switch(n.label){case 0:return"string"!==typeof e&&Xt(Qt.INVALID_PARAMS,"username must be a string"),[4,this._request.send("auth.isUsernameRegistered",{username:e})];case 1:return t=n.sent().data,[2,null===t||void 0===t?void 0:t.isRegistered]}}))}))},e.prototype.signInWithEmailAndPassword=function(e,t){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(n){return[2,this.emailAuthProvider().signIn(e,t)]}))}))},e.prototype.signUpWithEmailAndPassword=function(e,t){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(n){return[2,this.emailAuthProvider().signUp(e,t)]}))}))},e.prototype.sendPasswordResetEmail=function(e){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(t){return[2,this.emailAuthProvider().resetPassword(e)]}))}))},e.prototype.signOut=function(){return Vt(this,void 0,void 0,(function(){var e,t,n,r,o,i,s;return Kt(this,(function(a){switch(a.label){case 0:return e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=e.accessTokenExpireKey,o="auth.logout",[4,this._cache.getStoreAsync(t)];case 1:return i=a.sent(),i?[4,this._request.send(o,{refresh_token:i})]:[2];case 2:return s=a.sent(),this._cache.removeStoreAsync(t),this._cache.removeStoreAsync(n),this._cache.removeStoreAsync(r),rn.fire(un.LOGIN_STATE_CHANGED),rn.fire(un.LOGIN_TYPE_CHANGED,{env:this._config.env,loginType:be.NULL,persistence:this._config.persistence}),[2,s]}}))}))},e.prototype.onLoginStateChanged=function(e){return Vt(this,void 0,void 0,(function(){var t,n=this;return Kt(this,(function(r){switch(r.label){case 0:return rn.on(un.LOGIN_STATE_CHANGED,(function(){return Vt(n,void 0,void 0,(function(){var t;return Kt(this,(function(n){switch(n.label){case 0:return[4,this.getLoginState()];case 1:return t=n.sent(),e.call(this,t),[2]}}))}))})),[4,this.getLoginState()];case 1:return t=r.sent(),e.call(this,t),[2]}}))}))},e.prototype.onLoginStateExpired=function(e){rn.on(un.LOGIN_STATE_EXPIRED,e.bind(this))},e.prototype.onAccessTokenRefreshed=function(e){rn.on(un.ACCESS_TOKEN_REFRESHD,e.bind(this))},e.prototype.onAnonymousConverted=function(e){rn.on(un.ANONYMOUS_CONVERTED,e.bind(this))},e.prototype.onLoginTypeChanged=function(e){var t=this;rn.on(un.LOGIN_TYPE_CHANGED,(function(){return Vt(t,void 0,void 0,(function(){var t;return Kt(this,(function(n){switch(n.label){case 0:return[4,this.getLoginState()];case 1:return t=n.sent(),e.call(this,t),[2]}}))}))}))},e.prototype.hasLoginState=function(){if("async"!==this._cache.mode){var e=this._cache.keys.refreshTokenKey,t=this._cache.getStore(e);if(t){var n=new sn({envId:this._config.env,cache:this._cache,request:this._request});return n.checkLocalState(),n}return null}zt(Qt.INVALID_OPERATION,"current platform's storage is asynchronous, please use getLoginState insteed")},e.prototype.getLoginState=function(){return Vt(this,void 0,void 0,(function(){var e,t,n;return Kt(this,(function(r){switch(r.label){case 0:return e=this._cache.keys.refreshTokenKey,[4,this._cache.getStoreAsync(e)];case 1:return t=r.sent(),t?(n=new sn({envId:this._config.env,cache:this._cache,request:this._request}),[4,n.checkLocalStateAsync()]):[3,3];case 2:return r.sent(),[2,n];case 3:return[2,null]}}))}))},e.prototype.shouldRefreshAccessToken=function(e){this._request._shouldRefreshAccessTokenHook=e.bind(this)},e.prototype.getUserInfo=function(){return Vt(this,void 0,void 0,(function(){var e,t;return Kt(this,(function(n){switch(n.label){case 0:return e="auth.getUserInfo",[4,this._request.send(e,{})];case 1:return t=n.sent(),t.code?[2,t]:[2,$t($t({},t.data),{requestId:t.seqId})]}}))}))},e.prototype.getAuthHeader=function(){var e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,r=this._cache.getStore(t),o=this._cache.getStore(n);return{"x-cloudbase-credentials":o+"/@@/"+r}},e.prototype.getAuthHeaderAsync=function(){return Vt(this,void 0,void 0,(function(){var e,t,n,r,o;return Kt(this,(function(i){switch(i.label){case 0:return[4,this._request.refreshAccessToken()];case 1:return i.sent(),e=this._cache.keys,t=e.refreshTokenKey,n=e.accessTokenKey,[4,this._cache.getStoreAsync(t)];case 2:return r=i.sent(),[4,this._cache.getStoreAsync(n)];case 3:return o=i.sent(),[2,{"x-cloudbase-credentials":o+"/@@/"+r}]}}))}))},e.prototype.sendPhoneCode=function(e){return Vt(this,void 0,void 0,(function(){var t;return Kt(this,(function(n){switch(n.label){case 0:return[4,this._request.send("auth.sendPhoneCode",{phoneNumber:Zt(e)})];case 1:return t=n.sent().data,[2,"Ok"===t.SendStatus]}}))}))},e.prototype.signUpWithPhoneCode=function(e,t,n){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(r){return[2,this.phoneAuthProvider().signUp(e,t,n)]}))}))},e.prototype.signInWithPhoneCodeOrPassword=function(e){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(t){return[2,this.phoneAuthProvider().signIn(e)]}))}))},e.prototype.forceResetPwdByPhoneCode=function(e){return Vt(this,void 0,void 0,(function(){return Kt(this,(function(t){return[2,this.phoneAuthProvider().signIn($t($t({},e),{signMethod:Wt.FORCERESETPWD}))]}))}))},e.prototype._onLoginTypeChanged=function(e){return Vt(this,void 0,void 0,(function(){var t,n,r,o;return Kt(this,(function(i){switch(i.label){case 0:return t=e.data,n=t.loginType,r=t.persistence,o=t.env,o!==this._config.env?[2]:[4,this._cache.updatePersistenceAsync(r)];case 1:return i.sent(),[4,this._cache.setStoreAsync(this._cache.keys.loginTypeKey,n)];case 2:return i.sent(),[2]}}))}))},Ht([tn({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 调用 auth().getCurrenUser() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[]),Gt("design:returntype",Promise)],e.prototype,"getCurrenUser",null),Ht([tn({title:"获取用户是否被占用失败",messages:["请确认以下各项：","  1 - 调用 auth().isUsernameRegistered() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String]),Gt("design:returntype",Promise)],e.prototype,"isUsernameRegistered",null),Ht([tn({title:"用户登出失败",messages:["请确认以下各项：","  1 - 调用 auth().signOut() 的语法或参数是否正确","  2 - 当前用户是否为匿名登录（匿名登录不支持signOut）","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[]),Gt("design:returntype",Promise)],e.prototype,"signOut",null),Ht([tn({title:"获取本地登录态失败",messages:["请确认以下各项：","  1 - 调用 auth().getLoginState() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[]),Gt("design:returntype",Promise)],e.prototype,"getLoginState",null),Ht([tn({title:"获取用户信息失败",messages:["请确认以下各项：","  1 - 是否已登录","  2 - 调用 auth().getUserInfo() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[]),Gt("design:returntype",Promise)],e.prototype,"getUserInfo",null),Ht([tn({title:"发送短信验证码失败",messages:["请确认以下各项：","  1 - 调用语法或参数是否正确","  2 - 当前环境是否开通了短信验证码登录","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+en]}),Gt("design:type",Function),Gt("design:paramtypes",[String]),Gt("design:returntype",Promise)],e.prototype,"sendPhoneCode",null),e}(),un={LOGIN_STATE_CHANGED:"loginStateChanged",LOGIN_STATE_EXPIRED:"loginStateExpire",LOGIN_TYPE_CHANGED:"loginTypeChanged",ANONYMOUS_CONVERTED:"anonymousConverted",ACCESS_TOKEN_REFRESHD:"refreshAccessToken"},cn={name:nn,namespace:"auth",injectEvents:{bus:rn,events:[un.LOGIN_TYPE_CHANGED,un.LOGIN_STATE_EXPIRED,un.LOGIN_STATE_CHANGED,un.ACCESS_TOKEN_REFRESHD,un.ANONYMOUS_CONVERTED]},entity:function(e){if(void 0===e&&(e={region:"",persistence:"local"}),this.authInstance)return zt(Qt.INVALID_OPERATION,"every cloudbase instance should has only one auth object"),this.authInstance;var t=this.platform,n=t.adapter,r=t.runtime,o=e.persistence||n.primaryStorage;o&&o!==this.config.persistence&&this.updateConfig({persistence:o});var i=this.config,s=i.env,a=i.persistence,u=i.debug;return this.authInstance=new an({env:s,region:e.region,persistence:a,debug:u,cache:this.cache,request:this.request,runtime:r}),this.authInstance}};try{cloudbase.registerComponent(cn)}catch(xs){}function fn(e){try{e.registerComponent(cn)}catch(xs){console.warn(xs)}}var ln=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},hn=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},pn=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},dn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},yn=o["constants"].getSdkName,gn=o["constants"].ERRORS,vn=o["constants"].COMMUNITY_SITE_URL,mn=o["utils"].execCallback,_n=o["helpers"].catchErrorsDecorator,bn="functions",wn=function(){function e(){}return e.prototype.callFunction=function(e,t){return pn(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,f,l,h,p;return dn(this,(function(d){switch(d.label){case 0:if(n=e.name,r=e.data,o=e.query,i=e.parse,s=e.search,!n)throw new Error(JSON.stringify({code:gn.INVALID_PARAMS,msg:"["+bn+".callFunction] invalid function name"}));try{a=r?JSON.stringify(r):""}catch(xs){throw new Error(JSON.stringify({code:gn.INVALID_PARAMS,msg:"["+bn+".callFunction] invalid data"}))}u="functions.invokeFunction",c={inQuery:o,parse:i,search:s,function_name:n,request_data:a},f=this.request,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,f.send(u,c)];case 2:if(l=d.sent(),l.code)return[2,mn(t,null,l)];if(h=l.data.response_data,i)return[2,mn(t,null,{result:h,requestId:l.requestId})];try{return h=JSON.parse(l.data.response_data),[2,mn(t,null,{result:h,requestId:l.requestId})]}catch(xs){mn(t,new Error("["+yn()+"]["+gn.INVALID_PARAMS+"]["+bn+".callFunction] response data must be json"))}return[3,4];case 3:return p=d.sent(),mn(t,p),[3,4];case 4:return[2]}}))}))},ln([_n({customInfo:{className:"Cloudbase",methodName:"callFunction"},title:"函数调用失败",messages:["请确认以下各项：","  1 - 调用 callFunction() 的语法或参数是否正确","  2 - 当前环境下是否存在此函数","  3 - 函数安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+vn]}),hn("design:type",Function),hn("design:paramtypes",[Object,Function]),hn("design:returntype",Promise)],e.prototype,"callFunction",null),e}(),En=new wn,Sn={name:bn,entity:{callFunction:En.callFunction}};try{cloudbase.registerComponent(Sn)}catch(xs){}function In(e){try{e.registerComponent(Sn)}catch(xs){console.warn(xs)}}var On=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},An=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Tn=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Nn=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Rn=o["constants"].getSdkName,Pn=o["constants"].ERRORS,xn=o["constants"].COMMUNITY_SITE_URL,Ln=o["utils"].isArray,Cn=o["utils"].isString,kn=o["utils"].isPalinObject,Un=o["utils"].execCallback,Dn=o["helpers"].catchErrorsDecorator,jn="storage",Mn=function(){function e(){}return e.prototype.uploadFile=function(e,t){return Tn(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,f,l,h,p,d,y,g,v;return Nn(this,(function(m){switch(m.label){case 0:if(n=e.cloudPath,r=e.filePath,o=e.onUploadProgress,!Cn(n)||!r)throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".uploadFile] invalid params"}));return i="storage.getUploadMetadata",s=this.request,[4,s.send(i,{path:n})];case 1:return a=m.sent(),u=a.data,c=u.url,f=u.authorization,l=u.token,h=u.fileId,p=u.cosFileId,d=u.download_url,y=a.requestId,g={key:n,signature:f,"x-cos-meta-fileid":p,success_action_status:"201","x-cos-security-token":l},[4,s.upload({url:c,data:g,file:r,name:n,onUploadProgress:o})];case 2:return v=m.sent(),201===v.statusCode?[2,Un(t,null,{fileID:h,download_url:d,requestId:y})]:[2,Un(t,new Error("["+Rn()+"]["+Pn.OPERATION_FAIL+"]["+jn+"]:"+v.data))]}}))}))},e.prototype.getUploadMetadata=function(e,t){return Tn(this,void 0,void 0,(function(){var n,r,o,i,s;return Nn(this,(function(a){switch(a.label){case 0:if(n=e.cloudPath,!Cn(n))throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".getUploadMetadata] invalid cloudPath"}));r=this.request,o="storage.getUploadMetadata",a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r.send(o,{path:n})];case 2:return i=a.sent(),[2,Un(t,null,i)];case 3:return s=a.sent(),[2,Un(t,s)];case 4:return[2]}}))}))},e.prototype.deleteFile=function(e,t){return Tn(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c;return Nn(this,(function(f){switch(f.label){case 0:if(n=e.fileList,!n||!Ln(n)||0===n.length)throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".deleteFile] fileList must not be empty"}));for(r=0,o=n;r<o.length;r++)if(i=o[r],!i||!Cn(i))throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".deleteFile] fileID must be string"}));return s="storage.batchDeleteFile",a=this.request,[4,a.send(s,{fileid_list:n})];case 1:return u=f.sent(),u.code?[2,Un(t,null,u)]:(c={fileList:u.data.delete_list,requestId:u.requestId},[2,Un(t,null,c)])}}))}))},e.prototype.getTempFileURL=function(e,t){return Tn(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c;return Nn(this,(function(f){switch(f.label){case 0:if(n=e.fileList,!n||!Ln(n)||0===n.length)throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".getTempFileURL] fileList must not be empty"}));for(r=[],o=0,i=n;o<i.length;o++)if(s=i[o],kn(s)){if(!s.hasOwnProperty("fileID")||!s.hasOwnProperty("maxAge"))throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".getTempFileURL] file info must include fileID and maxAge"}));r.push({fileid:s.fileID,max_age:s.maxAge})}else{if(!Cn(s))throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".getTempFileURL] invalid fileList"}));r.push({fileid:s})}return a="storage.batchGetDownloadUrl",u=this.request,[4,u.send(a,{file_list:r})];case 1:return c=f.sent(),c.code?[2,Un(t,null,c)]:[2,Un(t,null,{fileList:c.data.download_list,requestId:c.requestId})]}}))}))},e.prototype.downloadFile=function(e,t){return Tn(this,void 0,void 0,(function(){var n,r,o,i,s,a;return Nn(this,(function(u){switch(u.label){case 0:if(n=e.fileID,!Cn(n))throw new Error(JSON.stringify({code:Pn.INVALID_PARAMS,msg:"["+jn+".getTempFileURL] fileID must be string"}));return[4,this.getTempFileURL.call(this,{fileList:[{fileID:n,maxAge:600}]})];case 1:return r=u.sent(),o=r.fileList[0],"SUCCESS"!==o.code?[2,Un(t,o)]:(i=this.request,s=encodeURI(o.download_url),[4,i.download({url:s})]);case 2:return a=u.sent(),[2,Un(t,null,a)]}}))}))},On([Dn({customInfo:{className:"Cloudbase",methodName:"uploadFile"},title:"上传文件失败",messages:["请确认以下各项：","  1 - 调用 uploadFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xn]}),An("design:type",Function),An("design:paramtypes",[Object,Function]),An("design:returntype",Promise)],e.prototype,"uploadFile",null),On([Dn({customInfo:{className:"Cloudbase",methodName:"getUploadMetadata"},title:"获取上传元信息失败",messages:["请确认以下各项：","  1 - 调用 getUploadMetadata() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xn]}),An("design:type",Function),An("design:paramtypes",[Object,Function]),An("design:returntype",Promise)],e.prototype,"getUploadMetadata",null),On([Dn({customInfo:{className:"Cloudbase",methodName:"deleteFile"},title:"删除文件失败",messages:["请确认以下各项：","  1 - 调用 deleteFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xn]}),An("design:type",Function),An("design:paramtypes",[Object,Function]),An("design:returntype",Promise)],e.prototype,"deleteFile",null),On([Dn({customInfo:{className:"Cloudbase",methodName:"getTempFileURL"},title:"获取文件下载链接",messages:["请确认以下各项：","  1 - 调用 getTempFileURL() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xn]}),An("design:type",Function),An("design:paramtypes",[Object,Function]),An("design:returntype",Promise)],e.prototype,"getTempFileURL",null),On([Dn({customInfo:{className:"Cloudbase",methodName:"downloadFile"},title:"下载文件失败",messages:["请确认以下各项：","  1 - 调用 downloadFile() 的语法或参数是否正确","  2 - 当前域名是否在安全域名列表中：https://console.cloud.tencent.com/tcb/env/safety","  3 - 云存储安全规则是否限制了当前登录状态访问","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+xn]}),An("design:type",Function),An("design:paramtypes",[Object,Function]),An("design:returntype",Promise)],e.prototype,"downloadFile",null),e}(),qn=new Mn,Bn={name:jn,entity:{uploadFile:qn.uploadFile,deleteFile:qn.deleteFile,getTempFileURL:qn.getTempFileURL,downloadFile:qn.downloadFile,getUploadMetadata:qn.getUploadMetadata}};try{cloudbase.registerComponent(Bn)}catch(xs){}function Wn(e){try{e.registerComponent(Bn)}catch(xs){console.warn(xs)}}var Fn=n("f4c4"),$n=n.n(Fn),Hn=n("abc7"),Gn=n.n(Hn),Vn=n("cd3f"),Kn=n.n(Vn);function Jn(e){return void 0===e&&(e=""),(e?e+"_":"")+ +new Date+"_"+Math.random()}var Yn,zn=function(){function e(e){this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:function(){return e.virtualClient}})}return e}(),Xn=function(){function e(e){var t,n,r=e.id,o=e.docChanges,i=e.docs,s=e.msgType,a=e.type;Object.defineProperties(this,{id:{get:function(){return r},enumerable:!0},docChanges:{get:function(){return t||(t=JSON.parse(JSON.stringify(o))),t},enumerable:!0},docs:{get:function(){return n||(n=JSON.parse(JSON.stringify(i))),n},enumerable:!0},msgType:{get:function(){return s},enumerable:!0},type:{get:function(){return a},enumerable:!0}})}return e}(),Zn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qn=function(e){function t(t){var n=e.call(this,"Watch Error "+JSON.stringify(t.msgData)+" (requestid: "+t.requestId+")")||this;return n.isRealtimeErrorMessageError=!0,n.payload=t,n}return Zn(t,e),t}(Error),er=function(e){return null===e||void 0===e?void 0:e.isRealtimeErrorMessageError},tr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="timeout",t.payload=null,t.generic=!0,t}return Zn(t,e),t}(Error),nr=function(e){return"timeout"===e.type},rr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="cancelled",t.payload=null,t.generic=!0,t}return Zn(t,e),t}(Error),or=function(e){return"cancelled"===e.type},ir=function(e){function t(t){var n=e.call(this,t.errMsg)||this;return n.errCode="UNKNOWN_ERROR",Object.defineProperties(n,{message:{get:function(){return"errCode: "+this.errCode+" "+(sr[this.errCode]||"")+" | errMsg: "+this.errMsg},set:function(e){this.errMsg=e}}}),n.errCode=t.errCode||"UNKNOWN_ERROR",n.errMsg=t.errMsg,n}return Zn(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"errCode: "+this.errCode+" | errMsg: "+this.errMsg},set:function(e){this.errMsg=e},enumerable:!1,configurable:!0}),t}(Error),sr={UNKNOWN_ERROR:"UNKNOWN_ERROR",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:"SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:"SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:"SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:"SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:"SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR"},ar=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))},ur=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},cr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},fr=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r};(function(e){e["LOGGINGIN"]="LOGGINGIN",e["INITING"]="INITING",e["REBUILDING"]="REBUILDING",e["ACTIVE"]="ACTIVE",e["ERRORED"]="ERRORED",e["CLOSING"]="CLOSING",e["CLOSED"]="CLOSED",e["PAUSED"]="PAUSED",e["RESUMING"]="RESUMING"})(Yn||(Yn={}));var lr=100,hr=2,pr=2,dr=1e4,yr=1e4,gr=1e4,vr=function(){function e(e){var t=this;this.watchStatus=Yn.INITING,this._login=function(e,n){return ur(t,void 0,void 0,(function(){var t;return cr(this,(function(r){switch(r.label){case 0:return this.watchStatus=Yn.LOGGINGIN,[4,this.login(e,n)];case 1:return t=r.sent(),this.envId||(this.envId=t.envId),[2,t]}}))}))},this.initWatch=function(e){return ur(t,void 0,void 0,(function(){var t,n=this;return cr(this,(function(r){switch(r.label){case 0:if(this._initWatchPromise)return[2,this._initWatchPromise];this._initWatchPromise=new Promise((function(t,r){return ur(n,void 0,void 0,(function(){var n,o,i,s,a,u,c,f,l,h,p;return cr(this,(function(d){switch(d.label){case 0:return d.trys.push([0,3,,4]),this.watchStatus===Yn.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,t()]):[4,this._login(this.envId,e)];case 1:return n=d.sent().envId,this.watchStatus===Yn.PAUSED?(console.log("[realtime] initWatch cancelled on pause"),[2,t()]):(this.watchStatus=Yn.INITING,o={watchId:this.watchId,requestId:Jn(),msgType:"INIT_WATCH",msgData:{envId:n,collName:this.collectionName,query:this.query,limit:this.limit,orderBy:this.orderBy}},[4,this.send({msg:o,waitResponse:!0,skipOnMessage:!0,timeout:yr})]);case 2:if(i=d.sent(),s=i.msgData,a=s.events,u=s.currEvent,this.sessionInfo={queryID:i.msgData.queryID,currentEventId:u-1,currentDocs:[]},a.length>0){for(c=0,f=a;c<f.length;c++)l=f[c],l.ID=u;this.handleServerEvents(i)}else this.sessionInfo.currentEventId=u,h=new Xn({id:u,docChanges:[],docs:[],type:"init"}),this.listener.onChange(h),this.scheduleSendACK();return this.onWatchStart(this,this.sessionInfo.queryID),this.watchStatus=Yn.ACTIVE,this._availableRetries.INIT_WATCH=hr,t(),[3,4];case 3:return p=d.sent(),this.handleWatchEstablishmentError(p,{operationName:"INIT_WATCH",resolve:t,reject:r}),[3,4];case 4:return[2]}}))}))})),t=!1,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this._initWatchPromise];case 2:return r.sent(),t=!0,[3,4];case 3:return this._initWatchPromise=void 0,[7];case 4:return console.log("[realtime] initWatch "+(t?"success":"fail")),[2]}}))}))},this.rebuildWatch=function(e){return ur(t,void 0,void 0,(function(){var t,n=this;return cr(this,(function(r){switch(r.label){case 0:if(this._rebuildWatchPromise)return[2,this._rebuildWatchPromise];this._rebuildWatchPromise=new Promise((function(t,r){return ur(n,void 0,void 0,(function(){var n,o,i,s;return cr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),this.watchStatus===Yn.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,t()]):[4,this._login(this.envId,e)];case 1:if(n=a.sent().envId,!this.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");return this.watchStatus===Yn.PAUSED?(console.log("[realtime] rebuildWatch cancelled on pause"),[2,t()]):(this.watchStatus=Yn.REBUILDING,o={watchId:this.watchId,requestId:Jn(),msgType:"REBUILD_WATCH",msgData:{envId:n,collName:this.collectionName,queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:o,waitResponse:!0,skipOnMessage:!1,timeout:gr})]);case 2:return i=a.sent(),this.handleServerEvents(i),this.watchStatus=Yn.ACTIVE,this._availableRetries.REBUILD_WATCH=hr,t(),[3,4];case 3:return s=a.sent(),this.handleWatchEstablishmentError(s,{operationName:"REBUILD_WATCH",resolve:t,reject:r}),[3,4];case 4:return[2]}}))}))})),t=!1,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,this._rebuildWatchPromise];case 2:return r.sent(),t=!0,[3,4];case 3:return this._rebuildWatchPromise=void 0,[7];case 4:return console.log("[realtime] rebuildWatch "+(t?"success":"fail")),[2]}}))}))},this.handleWatchEstablishmentError=function(e,n){return ur(t,void 0,void 0,(function(){var t,r,o,i=this;return cr(this,(function(s){return t="INIT_WATCH"===n.operationName,r=function(){i.closeWithError(new ir({errCode:t?sr.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:sr.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:e})),n.reject(e)},o=function(e){i.useRetryTicket(n.operationName)?t?(i._initWatchPromise=void 0,n.resolve(i.initWatch(e))):(i._rebuildWatchPromise=void 0,n.resolve(i.rebuildWatch(e))):r()},this.handleCommonError(e,{onSignError:function(){return o(!0)},onTimeoutError:function(){return o(!1)},onNotRetryableError:r,onCancelledError:n.reject,onUnknownError:function(){return ur(i,void 0,void 0,(function(){var e,t=this;return cr(this,(function(r){switch(r.label){case 0:return r.trys.push([0,8,,9]),e=function(){return ur(t,void 0,void 0,(function(){return cr(this,(function(e){switch(e.label){case 0:return this.pause(),[4,this.onceWSConnected()];case 1:return e.sent(),o(!0),[2]}}))}))},this.isWSConnected()?[3,2]:[4,e()];case 1:return r.sent(),[3,7];case 2:return[4,ar(lr)];case 3:return r.sent(),this.watchStatus!==Yn.PAUSED?[3,4]:(n.reject(new rr(n.operationName+" cancelled due to pause after unknownError")),[3,7]);case 4:return this.isWSConnected()?[3,6]:[4,e()];case 5:return r.sent(),[3,7];case 6:o(!1),r.label=7;case 7:return[3,9];case 8:return r.sent(),o(!0),[3,9];case 9:return[2]}}))}))}}),[2]}))}))},this.closeWatch=function(){return ur(t,void 0,void 0,(function(){var e,t,n;return cr(this,(function(r){switch(r.label){case 0:if(e=this.sessionInfo?this.sessionInfo.queryID:"",this.watchStatus!==Yn.ACTIVE)return this.watchStatus=Yn.CLOSED,this.onWatchClose(this,e),[2];r.label=1;case 1:return r.trys.push([1,3,4,5]),this.watchStatus=Yn.CLOSING,t={watchId:this.watchId,requestId:Jn(),msgType:"CLOSE_WATCH",msgData:null},[4,this.send({msg:t})];case 2:return r.sent(),this.sessionInfo=void 0,this.watchStatus=Yn.CLOSED,[3,5];case 3:return n=r.sent(),this.closeWithError(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL,errMsg:n})),[3,5];case 4:return this.onWatchClose(this,e),[7];case 5:return[2]}}))}))},this.scheduleSendACK=function(){t.clearACKSchedule(),t._ackTimeoutId=setTimeout((function(){t._waitExpectedTimeoutId?t.scheduleSendACK():t.sendACK()}),dr)},this.clearACKSchedule=function(){t._ackTimeoutId&&clearTimeout(t._ackTimeoutId)},this.sendACK=function(){return ur(t,void 0,void 0,(function(){var e,t,n;return cr(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.watchStatus!==Yn.ACTIVE?(this.scheduleSendACK(),[2]):this.sessionInfo?(e={watchId:this.watchId,requestId:Jn(),msgType:"CHECK_LAST",msgData:{queryID:this.sessionInfo.queryID,eventID:this.sessionInfo.currentEventId}},[4,this.send({msg:e})]):(console.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)"),[2]);case 1:return r.sent(),this.scheduleSendACK(),[3,3];case 2:if(t=r.sent(),er(t))switch(n=t.payload,n.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return this.rebuildWatch(),[2];case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return this.closeWithError(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:n.msgData.code})),[2];default:break}return this._availableRetries.CHECK_LAST&&this._availableRetries.CHECK_LAST>0?(this._availableRetries.CHECK_LAST--,this.scheduleSendACK()):this.closeWithError(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:t})),[3,3];case 3:return[2]}}))}))},this.handleCommonError=function(e,t){if(er(e)){var n=e.payload;switch(n.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void t.onSignError(e);case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return void t.onNotRetryableError(e);default:return void t.onNotRetryableError(e)}}else{if(nr(e))return void t.onTimeoutError(e);if(or(e))return void t.onCancelledError(e)}t.onUnknownError(e)},this.watchId="watchid_"+ +new Date+"_"+Math.random(),this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.onceWSConnected=e.onceWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.debug=e.debug,this._availableRetries={INIT_WATCH:hr,REBUILD_WATCH:hr,CHECK_LAST:pr},this.listener=new zn({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this.initWatch()}return e.prototype.onMessage=function(e){var t=this;switch(this.watchStatus){case Yn.PAUSED:if("ERROR"!==e.msgType)return;break;case Yn.LOGGINGIN:case Yn.INITING:case Yn.REBUILDING:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received while "+this.watchStatus);case Yn.CLOSED:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has closed");case Yn.ERRORED:return void console.warn("[realtime listener] internal non-fatal error: unexpected message received when the watch has ended with error")}if(this.sessionInfo)switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":console.warn("nextevent "+e.msgData.currEvent+" ignored",e),this.handleServerEvents(e);break;case"CHECK_EVENT":this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout((function(){t.rebuildWatch()}),this.getWaitExpectedTimeoutLength()),console.log("[realtime] waitExpectedTimeoutLength "+this.getWaitExpectedTimeoutLength()));break;case"ERROR":this.closeWithError(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:e.msgData.code+" - "+e.msgData.message}));break;default:console.warn("[realtime listener] virtual client receive unexpected msg "+e.msgType+": ",e);break}else console.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.")},e.prototype.closeWithError=function(e){this.watchStatus=Yn.ERRORED,this.clearACKSchedule(),this.listener.onError(e),this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),console.log("[realtime] client closed ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},e.prototype.pause=function(){this.watchStatus=Yn.PAUSED,console.log("[realtime] client paused ("+this.collectionName+" "+this.query+") (watchId "+this.watchId+")")},e.prototype.resume=function(){return ur(this,void 0,void 0,(function(){var e;return cr(this,(function(t){switch(t.label){case 0:this.watchStatus=Yn.RESUMING,console.log("[realtime] client resuming with "+(this.sessionInfo?"REBUILD_WATCH":"INIT_WATCH")+" ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sessionInfo?this.rebuildWatch():this.initWatch()];case 2:return t.sent(),console.log("[realtime] client successfully resumed ("+this.collectionName+" "+this.query+") ("+this.watchId+")"),[3,4];case 3:return e=t.sent(),console.error("[realtime] client resume failed ("+this.collectionName+" "+this.query+") ("+this.watchId+")",e),[3,4];case 4:return[2]}}))}))},e.prototype.useRetryTicket=function(e){return!!(this._availableRetries[e]&&this._availableRetries[e]>0)&&(this._availableRetries[e]--,console.log("[realtime] "+e+" use a retry ticket, now only "+this._availableRetries[e]+" retry left"),!0)},e.prototype.handleServerEvents=function(e){return ur(this,void 0,void 0,(function(){var t;return cr(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this.scheduleSendACK(),[4,this._handleServerEvents(e)];case 1:return n.sent(),this._postHandleServerEventsValidityCheck(e),[3,3];case 2:throw t=n.sent(),console.error("[realtime listener] internal non-fatal error: handle server events failed with error: ",t),t;case 3:return[2]}}))}))},e.prototype._handleServerEvents=function(e){return ur(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,f,l,h;return cr(this,(function(p){switch(p.label){case 0:if(t=e.requestId,n=e.msgData.events,r=e.msgType,!n.length||!this.sessionInfo)return[2];o=this.sessionInfo;try{i=n.map(mr)}catch(xs){return this.closeWithError(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:xs})),[2]}s=fr(o.currentDocs),a=!1,u=function(n,u){var f,l,h,p,d,y,g,v,m,_,b;return cr(this,(function(w){switch(w.label){case 0:return f=i[n],o.currentEventId>=f.id?(!i[n-1]||f.id>i[n-1].id?console.warn("[realtime] duplicate event received, cur "+o.currentEventId+" but got "+f.id):console.error("[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId "+t+")"),[2,"continue"]):[3,1];case 1:if(o.currentEventId!==f.id-1)return[3,2];switch(f.dataType){case"update":if(!f.doc)switch(f.queueType){case"update":case"dequeue":if(l=s.find((function(e){return e._id===f.docId})),l){if(y=Kn()(l),f.updatedFields)for(d in f.updatedFields)$n()(y,d,f.updatedFields[d]);if(f.removedFields)for(h=0,p=f.removedFields;h<p.length;h++)d=p[h],Gn()(y,d);f.doc=y}else console.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated.");break;case"enqueue":throw g=new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId '+e.requestId+")"}),c.closeWithError(g),g;default:break}break;case"replace":if(!f.doc)throw g=new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="replace" (requestId '+e.requestId+")"}),c.closeWithError(g),g;break;case"remove":y=s.find((function(e){return e._id===f.docId})),y?f.doc=y:console.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated.");break;case"limit":if(!f.doc)switch(f.queueType){case"dequeue":y=s.find((function(e){return e._id===f.docId})),y?f.doc=y:console.error("[realtime listener] internal non-fatal server error: unexpected limit dataType event where no doc is associated.");break;case"enqueue":throw g=new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:'HandleServerEvents: full doc is not provided with dataType="limit" and queueType="enqueue" (requestId '+e.requestId+")"}),c.closeWithError(g),g;default:break}break}switch(f.queueType){case"init":a?s.push(f.doc):(a=!0,s=[f.doc]);break;case"enqueue":s.push(f.doc);break;case"dequeue":v=s.findIndex((function(e){return e._id===f.docId})),v>-1?s.splice(v,1):console.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated.");break;case"update":v=s.findIndex((function(e){return e._id===f.docId})),v>-1?s[v]=f.doc:console.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated.");break}return(n===u-1||i[n+1]&&i[n+1].id!==f.id)&&(m=fr(s),_=i.slice(0,n+1).filter((function(e){return e.id===f.id})),c.sessionInfo.currentEventId=f.id,c.sessionInfo.currentDocs=s,b=new Xn({id:f.id,docChanges:_,docs:m,msgType:r}),c.listener.onChange(b)),[3,4];case 2:return console.warn("[realtime listener] event received is out of order, cur "+c.sessionInfo.currentEventId+" but got "+f.id),[4,c.rebuildWatch()];case 3:return w.sent(),[2,{value:void 0}];case 4:return[2]}}))},c=this,f=0,l=i.length,p.label=1;case 1:return f<l?[5,u(f,l)]:[3,4];case 2:if(h=p.sent(),"object"===typeof h)return[2,h.value];p.label=3;case 3:return f++,[3,1];case 4:return[2]}}))}))},e.prototype._postHandleServerEventsValidityCheck=function(e){this.sessionInfo?(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent&&console.warn("[realtime listener] internal non-fatal error: client eventId does not match with server event id after server event handling")):console.error("[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur")},e.prototype.clearWaitExpectedEvent=function(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)},e}();function mr(e){var t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&"{}"!==e.Doc?JSON.parse(e.Doc):void 0};return"update"===e.DataType&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=JSON.parse(e.removedFields))),t}var _r,br={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3050:{code:3050,name:"Server Close",description:"The client is terminating the connection because no heartbeat response is received from the server"}};(function(e){e[e["NormalClosure"]=1e3]="NormalClosure",e[e["GoingAway"]=1001]="GoingAway",e[e["ProtocolError"]=1002]="ProtocolError",e[e["UnsupportedData"]=1003]="UnsupportedData",e[e["NoStatusReceived"]=1005]="NoStatusReceived",e[e["AbnormalClosure"]=1006]="AbnormalClosure",e[e["InvalidFramePayloadData"]=1007]="InvalidFramePayloadData",e[e["PolicyViolation"]=1008]="PolicyViolation",e[e["MessageTooBig"]=1009]="MessageTooBig",e[e["MissingExtension"]=1010]="MissingExtension",e[e["InternalError"]=1011]="InternalError",e[e["ServiceRestart"]=1012]="ServiceRestart",e[e["TryAgainLater"]=1013]="TryAgainLater",e[e["BadGateway"]=1014]="BadGateway",e[e["TLSHandshake"]=1015]="TLSHandshake",e[e["ReconnectWebSocket"]=3e3]="ReconnectWebSocket",e[e["NoRealtimeListeners"]=3001]="NoRealtimeListeners",e[e["HeartbeatPingError"]=3002]="HeartbeatPingError",e[e["HeartbeatPongTimeoutError"]=3003]="HeartbeatPongTimeoutError",e[e["NoAuthentication"]=3050]="NoAuthentication"})(_r||(_r={}));var wr=function(e,t){var n=br[e],r=n?n.name+", code "+e+", reason "+(t||n.description):"code "+e;return new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:r})},Er=null,Sr="web";function Ir(){return Er}function Or(e){Er=e}function Ar(){return Sr}function Tr(e){Sr=e}var Nr=function(){return Nr=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Nr.apply(this,arguments)},Rr=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Pr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},xr={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},Lr=3,Cr=5e3,kr=1e4,Ur=5,Dr=1e4,jr=2,Mr=2,qr=5e3,Br=function(){function e(e){var t=this;this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._pingFailed=0,this._pongMissed=0,this._logins=new Map,this._wsReadySubsribers=[],this._wsResponseWait=new Map,this._rttObserved=[],this.send=function(e){return Rr(t,void 0,void 0,(function(){var t=this;return Pr(this,(function(n){return[2,new Promise((function(n,r){return Rr(t,void 0,void 0,(function(){var t,o,i,s,a,u,c,f=this;return Pr(this,(function(l){switch(l.label){case 0:o=!1,i=!1,s=function(e){o=!0,t&&clearTimeout(t),n(e)},a=function(e){i=!0,t&&clearTimeout(t),r(e)},e.timeout&&(t=setTimeout((function(){return Rr(f,void 0,void 0,(function(){return Pr(this,(function(e){switch(e.label){case 0:return o&&i?[3,2]:[4,ar(0)];case 1:e.sent(),o&&i||a(new tr("wsclient.send timedout")),e.label=2;case 2:return[2]}}))}))}),e.timeout)),l.label=1;case 1:return l.trys.push([1,8,,9]),this._wsInitPromise?[4,this._wsInitPromise]:[3,3];case 2:l.sent(),l.label=3;case 3:if(!this._ws)return a(new Error("invalid state: ws connection not exists, can not send message")),[2];if(this._ws.readyState!==xr.OPEN)return a(new Error("ws readyState invalid: "+this._ws.readyState+", can not send message")),[2];e.waitResponse&&this._wsResponseWait.set(e.msg.requestId,{resolve:s,reject:a,skipOnMessage:e.skipOnMessage}),l.label=4;case 4:return l.trys.push([4,6,,7]),[4,this._ws.send(JSON.stringify(e.msg))];case 5:return l.sent(),e.waitResponse||s(),[3,7];case 6:return u=l.sent(),u&&(a(u),e.waitResponse&&this._wsResponseWait.delete(e.msg.requestId)),[3,7];case 7:return[3,9];case 8:return c=l.sent(),a(c),[3,9];case 9:return[2]}}))}))}))]}))}))},this.closeAllClients=function(e){t._virtualWSClient.forEach((function(t){t.closeWithError(e)}))},this.pauseClients=function(e){(e||t._virtualWSClient).forEach((function(e){e.pause()}))},this.resumeClients=function(e){(e||t._virtualWSClient).forEach((function(e){e.resume()}))},this.initWebSocketConnection=function(e,n){return void 0===n&&(n=t._maxReconnect),Rr(t,void 0,void 0,(function(){var t=this;return Pr(this,(function(r){switch(r.label){case 0:if(e&&this._reconnectState)return[2];if(e&&(this._reconnectState=!0),this._wsInitPromise)return[2,this._wsInitPromise];e&&this.pauseClients(),this.close(_r.ReconnectWebSocket),this._wsInitPromise=new Promise((function(r,o){return Rr(t,void 0,void 0,(function(){var t,i,s,a=this;return Pr(this,(function(u){switch(u.label){case 0:return u.trys.push([0,6,,11]),[4,this.getWsSign()];case 1:return t=u.sent(),[4,new Promise((function(e){var n=t.wsUrl||"wss://tcb-ws.tencentcloudapi.com",r=Ir();a._ws=r?new r(n):new WebSocket(n),e()}))];case 2:return u.sent(),this._ws.connect?[4,this._ws.connect()]:[3,4];case 3:u.sent(),u.label=4;case 4:return[4,this.initWebSocketEvent()];case 5:return u.sent(),r(),e&&(this.resumeClients(),this._reconnectState=!1),[3,11];case 6:return i=u.sent(),console.error("[realtime] initWebSocketConnection connect fail",i),n>0?(s=!0,this._wsInitPromise=void 0,s?[4,ar(this._reconnectInterval)]:[3,8]):[3,9];case 7:u.sent(),e&&(this._reconnectState=!1),u.label=8;case 8:return r(this.initWebSocketConnection(e,n-1)),[3,10];case 9:o(i),e&&this.closeAllClients(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WATCH_FAIL,errMsg:i})),u.label=10;case 10:return[3,11];case 11:return[2]}}))}))})),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this._wsInitPromise];case 2:return r.sent(),this._wsReadySubsribers.forEach((function(e){var t=e.resolve;return t()})),[3,5];case 3:return r.sent(),this._wsReadySubsribers.forEach((function(e){var t=e.reject;return t()})),[3,5];case 4:return this._wsInitPromise=void 0,this._wsReadySubsribers=[],[7];case 5:return[2]}}))}))},this.initWebSocketEvent=function(){return new Promise((function(e,n){if(!t._ws)throw new Error("can not initWebSocketEvent, ws not exists");var r=!1;t._ws.onopen=function(t){console.warn("[realtime] ws event: open",t),r=!0,e()},t._ws.onerror=function(e){t._logins=new Map,r?(console.error("[realtime] ws event: error",e),t.clearHeartbeat(),t._virtualWSClient.forEach((function(t){return t.closeWithError(new ir({errCode:sr.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR,errMsg:e}))}))):(console.error("[realtime] ws open failed with ws event: error",e),n(e))},t._ws.onclose=function(e){switch(console.warn("[realtime] ws event: close",e),t._logins=new Map,t.clearHeartbeat(),e.code){case _r.ReconnectWebSocket:break;case _r.NoRealtimeListeners:break;case _r.HeartbeatPingError:case _r.HeartbeatPongTimeoutError:case _r.NormalClosure:case _r.AbnormalClosure:t._maxReconnect>0?t.initWebSocketConnection(!0,t._maxReconnect):t.closeAllClients(wr(e.code));break;case _r.NoAuthentication:t.closeAllClients(wr(e.code,e.reason));break;default:t._maxReconnect>0?t.initWebSocketConnection(!0,t._maxReconnect):t.closeAllClients(wr(e.code))}},t._ws.onmessage=function(e){var n,r=e.data;t.heartbeat();try{n=JSON.parse(r)}catch(xs){throw new Error("[realtime] onMessage parse res.data error: "+xs)}if("ERROR"===n.msgType){var o=null;t._virtualWSClient.forEach((function(e){e.watchId===n.watchId&&(o=e)})),o&&o.listener.onError(n)}var i=t._wsResponseWait.get(n.requestId);if(i){try{"ERROR"===n.msgType?i.reject(new Qn(n)):i.resolve(n)}catch(xs){console.error("ws onMessage responseWaitSpec.resolve(msg) errored:",xs)}finally{t._wsResponseWait.delete(n.requestId)}if(i.skipOnMessage)return}if("PONG"!==n.msgType){var s=n.watchId&&t._watchIdClientMap.get(n.watchId);if(s)s.onMessage(n);else switch(console.error("[realtime] no realtime listener found responsible for watchId "+n.watchId+": ",n),n.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":s=t._queryIdClientMap.get(n.msgData.queryID),s&&s.onMessage(n);break;default:for(var a=0,u=Array.from(t._watchIdClientMap.entries());a<u.length;a++){var c=u[a],f=c[1];f.onMessage(n);break}}}else if(t._lastPingSendTS){var l=Date.now()-t._lastPingSendTS;if(l>kr)return void console.warn("[realtime] untrusted rtt observed: "+l);t._rttObserved.length>=Lr&&t._rttObserved.splice(0,t._rttObserved.length-Lr+1),t._rttObserved.push(l)}},t.heartbeat()}))},this.isWSConnected=function(){return Boolean(t._ws&&t._ws.readyState===xr.OPEN)},this.onceWSConnected=function(){return Rr(t,void 0,void 0,(function(){var e=this;return Pr(this,(function(t){return this.isWSConnected()?[2]:this._wsInitPromise?[2,this._wsInitPromise]:[2,new Promise((function(t,n){e._wsReadySubsribers.push({resolve:t,reject:n})}))]}))}))},this.webLogin=function(e,n){return Rr(t,void 0,void 0,(function(){var t,r,o,i,s,a,u,c,f=this;return Pr(this,(function(l){switch(l.label){case 0:if(!n)if(e){if(t=this._logins.get(e),t){if(t.loggedIn&&t.loginResult)return[2,t.loginResult];if(t.loggingInPromise)return[2,t.loggingInPromise]}}else if(r=this._logins.get(""),null===r||void 0===r?void 0:r.loggingInPromise)return[2,r.loggingInPromise];o=new Promise((function(e,t){return Rr(f,void 0,void 0,(function(){var n,r,o,i,s;return Pr(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,this.getWsSign()];case 1:return n=a.sent(),r={envId:n.envId||"",accessToken:"",referrer:"web",sdkVersion:"",dataVersion:""},o={watchId:void 0,requestId:Jn(),msgType:"LOGIN",msgData:r,exMsgData:{runtime:Ar(),signStr:n.signStr,secretVersion:n.secretVersion}},[4,this.send({msg:o,waitResponse:!0,skipOnMessage:!0,timeout:qr})];case 2:return i=a.sent(),i.msgData.code?t(new Error(i.msgData.code+" "+i.msgData.message)):e({envId:n.envId}),[3,4];case 3:return s=a.sent(),t(s),[3,4];case 4:return[2]}}))}))})),i=e&&this._logins.get(e),s=Date.now(),i?(i.loggedIn=!1,i.loggingInPromise=o,i.loginStartTS=s):(i={loggedIn:!1,loggingInPromise:o,loginStartTS:s},this._logins.set(e||"",i)),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,o];case 2:if(a=l.sent(),u=e&&this._logins.get(e),u&&u===i&&u.loginStartTS===s)return i.loggedIn=!0,i.loggingInPromise=void 0,i.loginStartTS=void 0,i.loginResult=a,[2,a];if(u){if(u.loggedIn&&u.loginResult)return[2,u.loginResult];if(u.loggingInPromise)return[2,u.loggingInPromise];throw new Error("ws unexpected login info")}throw new Error("ws login info reset");case 3:throw c=l.sent(),i.loggedIn=!1,i.loggingInPromise=void 0,i.loginStartTS=void 0,i.loginResult=void 0,c;case 4:return[2]}}))}))},this.getWsSign=function(){return Rr(t,void 0,void 0,(function(){var e,t,n,r,o,i,s;return Pr(this,(function(a){switch(a.label){case 0:return this._wsSign&&this._wsSign.expiredTs>Date.now()?[2,this._wsSign]:(e=Date.now()+6e4,[4,this._context.appConfig.request.send("auth.wsWebSign",{runtime:Ar()})]);case 1:if(t=a.sent(),t.code)throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败: "+t.code);if(t.data)return n=t.data,r=n.signStr,o=n.wsUrl,i=n.secretVersion,s=n.envId,[2,{signStr:r,wsUrl:o,secretVersion:i,envId:s,expiredTs:e}];throw new Error("[tcb-js-sdk] 获取实时数据推送登录票据失败")}}))}))},this.getWaitExpectedTimeoutLength=function(){return t._rttObserved.length?t._rttObserved.reduce((function(e,t){return e+t}))/t._rttObserved.length*1.5:Cr},this.ping=function(){return Rr(t,void 0,void 0,(function(){var e;return Pr(this,(function(t){switch(t.label){case 0:return e={watchId:void 0,requestId:Jn(),msgType:"PING",msgData:null},[4,this.send({msg:e})];case 1:return t.sent(),[2]}}))}))},this.onWatchStart=function(e,n){t._queryIdClientMap.set(n,e)},this.onWatchClose=function(e,n){n&&t._queryIdClientMap.delete(n),t._watchIdClientMap.delete(e.watchId),t._virtualWSClient.delete(e),t._virtualWSClient.size||t.close(_r.NoRealtimeListeners)},this._maxReconnect=e.maxReconnect||Ur,this._reconnectInterval=e.reconnectInterval||Dr,this._context=e.context}return e.prototype.clearHeartbeat=function(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)},e.prototype.close=function(e){this.clearHeartbeat(),this._ws&&(this._ws.close(e,br[e].name),this._ws=void 0)},e.prototype.watch=function(e){this._ws||this._wsInitPromise||this.initWebSocketConnection(!1);var t=new vr(Nr(Nr({},e),{send:this.send,login:this.webLogin,isWSConnected:this.isWSConnected,onceWSConnected:this.onceWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,debug:!0}));return this._virtualWSClient.add(t),this._watchIdClientMap.set(t.watchId,t),t.listener},e.prototype.heartbeat=function(e){var t=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout((function(){return Rr(t,void 0,void 0,(function(){var e=this;return Pr(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this._ws&&this._ws.readyState===xr.OPEN?(this._lastPingSendTS=Date.now(),[4,this.ping()]):[2];case 1:return t.sent(),this._pingFailed=0,this._pongTimeoutId=setTimeout((function(){console.error("pong timed out"),e._pongMissed<Mr?(e._pongMissed++,e.heartbeat(!0)):e.initWebSocketConnection(!0)}),this._context.appConfig.realtimePongWaitTimeout),[3,3];case 2:return t.sent(),this._pingFailed<jr?(this._pingFailed++,this.heartbeat()):this.close(_r.HeartbeatPingError),[3,3];case 3:return[2]}}))}))}),e?0:this._context.appConfig.realtimePingInterval)},e}(),Wr={target:"database",entity:function(){var e=this.platform,t=e.adapter,n=e.runtime;Or(t.wsClass),Tr(n)}},Fr={name:"realtime",IIFE:!0,entity:function(){this.prototype.wsClientClass=Br}};try{cloudbase.registerComponent(Fr),cloudbase.registerHook(Wr)}catch(xs){}function $r(e){try{e.registerComponent(Fr),e.registerHook(Wr)}catch(xs){console.warn(xs)}}var Hr=function(e,t,n,r){var o,i=arguments.length,s=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,n,s):o(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Gr=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Vr=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Kr=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Jr=o["constants"].ERRORS,Yr=o["constants"].COMMUNITY_SITE_URL,zr=o["helpers"].catchErrorsDecorator,Xr="analytics",Zr=["mall"];function Qr(e){if("Object"!==Object.prototype.toString.call(e).slice(8,-1))return!1;var t=e.report_data,n=e.report_type;return!1!==Zr.includes(n)&&("Object"===Object.prototype.toString.call(t).slice(8,-1)&&(!(void 0!==t.action_time&&!Number.isInteger(t.action_time))&&"string"===typeof t.action_type))}var eo,to,no=function(){function e(){}return e.prototype.analytics=function(e){return Vr(this,void 0,void 0,(function(){var t,n,r,o,i;return Kr(this,(function(s){if(!Qr(e))throw new Error(JSON.stringify({code:Jr.INVALID_PARAMS,msg:"["+Xr+".analytics] invalid report data"}));return t="analytics.report",n=void 0===e.report_data.action_time?Math.floor(Date.now()/1e3):e.report_data.action_time,r={analytics_scene:e.report_type,analytics_data:Object.assign({},e.report_data,{action_time:n})},o={requestData:r},i=this.request,i.send(t,o),[2]}))}))},Hr([zr({customInfo:{className:"Cloudbase",methodName:"analytics"},title:"上报调用失败",messages:["请确认以下各项：","  1 - 调用 analytics() 的语法或参数是否正确","如果问题依然存在，建议到官方问答社区提问或寻找帮助："+Yr]}),Gr("design:type",Function),Gr("design:paramtypes",[Object]),Gr("design:returntype",Promise)],e.prototype,"analytics",null),e}(),ro=new no,oo={name:Xr,entity:{analytics:ro.analytics}};try{cloudbase.registerComponent(oo)}catch(xs){}function io(e){try{e.registerComponent(oo)}catch(xs){console.warn(xs)}}(function(e){e["DocIDError"]="文档ID不合法",e["CollNameError"]="集合名称不合法",e["OpStrError"]="操作符不合法",e["DirectionError"]="排序字符不合法",e["IntergerError"]="must be integer",e["QueryParamTypeError"]="查询参数必须为对象",e["QueryParamValueError"]="查询参数对象值不能均为undefined"})(to||(to={}));var so,ao={String:"String",Number:"Number",Object:"Object",Array:"Array",Boolean:"Boolean",Null:"Null",GeoPoint:"GeoPoint",GeoLineString:"GeoLineString",GeoPolygon:"GeoPolygon",GeoMultiPoint:"GeoMultiPoint",GeoMultiLineString:"GeoMultiLineString",GeoMultiPolygon:"GeoMultiPolygon",Timestamp:"Date",Command:"Command",ServerDate:"ServerDate",BsonDate:"BsonDate"},uo=["desc","asc"],co=["<","<=","==",">=",">"];(function(e){e["lt"]="<",e["gt"]=">",e["lte"]="<=",e["gte"]=">=",e["eq"]="=="})(so||(so={}));var fo;eo={},eo[so.eq]="$eq",eo[so.lt]="$lt",eo[so.lte]="$lte",eo[so.gt]="$gt",eo[so.gte]="$gte";(function(e){e["WHERE"]="WHERE",e["DOC"]="DOC"})(fo||(fo={}));var lo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ho=[],po={},yo=function(){function e(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}return e}(),go=function(e){function t(t,n){var r=this;if(n!==po)throw new TypeError("InternalSymbol cannot be constructed with new operator");return r=e.call(this,t)||this,r}return lo(t,e),t.for=function(e){for(var n=0,r=ho.length;n<r;n++)if(ho[n].target===e)return ho[n].instance;var o=new t(e,po);return ho.push({target:e,instance:o}),o},t}(yo),vo=go,mo=vo.for("UNSET_FIELD_NAME"),_o=vo.for("UPDATE_COMMAND"),bo=vo.for("QUERY_COMMAND"),wo=vo.for("LOGIC_COMMAND"),Eo=vo.for("GEO_POINT"),So=vo.for("SYMBOL_GEO_LINE_STRING"),Io=vo.for("SYMBOL_GEO_POLYGON"),Oo=vo.for("SYMBOL_GEO_MULTI_POINT"),Ao=vo.for("SYMBOL_GEO_MULTI_LINE_STRING"),To=vo.for("SYMBOL_GEO_MULTI_POLYGON"),No=vo.for("SERVER_DATE"),Ro=vo.for("REGEXP"),Po=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},xo=function(e){return"object"===Po(e)},Lo=function(e){return"string"===Po(e)},Co=function(e){return"number"===Po(e)},ko=function(e){return Array.isArray(e)},Uo=function(e){return"date"===Po(e)},Do=function(e){return"regexp"===Po(e)},jo=function(e){return e&&e._internalType instanceof go},Mo=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},qo=function(){function e(e){if(!ko(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(e.length<2)throw new Error('"points" must contain 2 points at least');e.forEach((function(e){if(!(e instanceof ei))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e+"[]")})),this.points=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"LineString",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))},t},e.prototype.toJSON=function(){return{type:"LineString",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))}},e.validate=function(e){var t,n;if("LineString"!==e.type||!ko(e.coordinates))return!1;try{for(var r=Mo(e.coordinates),o=r.next();!o.done;o=r.next()){var i=o.value;if(!Co(i[0])||!Co(i[1]))return!1}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.isClosed=function(e){var t=e.points[0],n=e.points[e.points.length-1];if(t.latitude===n.latitude&&t.longitude===n.longitude)return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return So},enumerable:!0,configurable:!0}),e}(),Bo=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Wo=function(){function e(e){if(!ko(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach((function(e){if(!(e instanceof qo))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e+"[]");if(!qo.isClosed(e))throw new Error("LineString "+e.points.map((function(e){return e.toReadableString()}))+" is not a closed cycle")})),this.lines=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"Polygon",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))},t},e.prototype.toJSON=function(){return{type:"Polygon",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}},e.validate=function(e){var t,n,r,o;if("Polygon"!==e.type||!ko(e.coordinates))return!1;try{for(var i=Bo(e.coordinates),s=i.next();!s.done;s=i.next()){var a=s.value;if(!this.isCloseLineString(a))return!1;try{for(var u=(r=void 0,Bo(a)),c=u.next();!c.done;c=u.next()){var f=c.value;if(!Co(f[0])||!Co(f[1]))return!1}}catch(l){r={error:l}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0},e.isCloseLineString=function(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]},Object.defineProperty(e.prototype,"_internalType",{get:function(){return To},enumerable:!0,configurable:!0}),e}(),Fo=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},$o=function(){function e(e){if(!ko(e))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e);if(0===e.length)throw new Error('"points" must contain 1 point at least');e.forEach((function(e){if(!(e instanceof ei))throw new TypeError('"points" must be of type Point[]. Received type '+typeof e+"[]")})),this.points=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"MultiPoint",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))},t},e.prototype.toJSON=function(){return{type:"MultiPoint",coordinates:this.points.map((function(e){return e.toJSON().coordinates}))}},e.validate=function(e){var t,n;if("MultiPoint"!==e.type||!ko(e.coordinates))return!1;try{for(var r=Fo(e.coordinates),o=r.next();!o.done;o=r.next()){var i=o.value;if(!Co(i[0])||!Co(i[1]))return!1}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Oo},enumerable:!0,configurable:!0}),e}(),Ho=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Go=function(){function e(e){if(!ko(e))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e);if(0===e.length)throw new Error("Polygon must contain 1 linestring at least");e.forEach((function(e){if(!(e instanceof qo))throw new TypeError('"lines" must be of type LineString[]. Received type '+typeof e+"[]")})),this.lines=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"MultiLineString",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))},t},e.prototype.toJSON=function(){return{type:"MultiLineString",coordinates:this.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}},e.validate=function(e){var t,n,r,o;if("MultiLineString"!==e.type||!ko(e.coordinates))return!1;try{for(var i=Ho(e.coordinates),s=i.next();!s.done;s=i.next()){var a=s.value;try{for(var u=(r=void 0,Ho(a)),c=u.next();!c.done;c=u.next()){var f=c.value;if(!Co(f[0])||!Co(f[1]))return!1}}catch(l){r={error:l}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}}}catch(h){t={error:h}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Ao},enumerable:!0,configurable:!0}),e}(),Vo=function(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ko=function(){function e(e){var t,n;if(!ko(e))throw new TypeError('"polygons" must be of type Polygon[]. Received type '+typeof e);if(0===e.length)throw new Error("MultiPolygon must contain 1 polygon at least");try{for(var r=Vo(e),o=r.next();!o.done;o=r.next()){var i=o.value;if(!(i instanceof Wo))throw new TypeError('"polygon" must be of type Polygon[]. Received type '+typeof i+"[]")}}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}this.polygons=e}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"MultiPolygon",coordinates:this.polygons.map((function(e){return e.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}))},t},e.prototype.toJSON=function(){return{type:"MultiPolygon",coordinates:this.polygons.map((function(e){return e.lines.map((function(e){return e.points.map((function(e){return[e.longitude,e.latitude]}))}))}))}},e.validate=function(e){var t,n,r,o,i,s;if("MultiPolygon"!==e.type||!ko(e.coordinates))return!1;try{for(var a=Vo(e.coordinates),u=a.next();!u.done;u=a.next()){var c=u.value;try{for(var f=(r=void 0,Vo(c)),l=f.next();!l.done;l=f.next()){var h=l.value;try{for(var p=(i=void 0,Vo(h)),d=p.next();!d.done;d=p.next()){var y=d.value;if(!Co(y[0])||!Co(y[1]))return!1}}catch(g){i={error:g}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}}}catch(v){r={error:v}}finally{try{l&&!l.done&&(o=f.return)&&o.call(f)}finally{if(r)throw r.error}}}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!0},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Io},enumerable:!0,configurable:!0}),e}(),Jo=function(){function e(e){var t=(void 0===e?{}:e).offset,n=void 0===t?0:t;this.offset=n}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return No},enumerable:!0,configurable:!0}),e.prototype.parse=function(){return{$date:{offset:this.offset}}},e}();function Yo(e){return new Jo(e)}var zo,Xo=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{while((void 0===t||t-- >0)&&!(r=i.next()).done)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return s},Zo=function(){function e(){}return e.formatResDocumentData=function(t){return t.map((function(t){return e.formatField(t)}))},e.formatField=function(t){var n=Object.keys(t),r={};return Array.isArray(t)&&(r=[]),n.forEach((function(n){var o,i=t[n],s=e.whichType(i);switch(s){case ao.GeoPoint:o=new ei(i.coordinates[0],i.coordinates[1]);break;case ao.GeoLineString:o=new qo(i.coordinates.map((function(e){return new ei(e[0],e[1])})));break;case ao.GeoPolygon:o=new Wo(i.coordinates.map((function(e){return new qo(e.map((function(e){var t=Xo(e,2),n=t[0],r=t[1];return new ei(n,r)})))})));break;case ao.GeoMultiPoint:o=new $o(i.coordinates.map((function(e){return new ei(e[0],e[1])})));break;case ao.GeoMultiLineString:o=new Go(i.coordinates.map((function(e){return new qo(e.map((function(e){var t=Xo(e,2),n=t[0],r=t[1];return new ei(n,r)})))})));break;case ao.GeoMultiPolygon:o=new Ko(i.coordinates.map((function(e){return new Wo(e.map((function(e){return new qo(e.map((function(e){var t=Xo(e,2),n=t[0],r=t[1];return new ei(n,r)})))})))})));break;case ao.Timestamp:o=new Date(1e3*i.$timestamp);break;case ao.Object:case ao.Array:o=e.formatField(i);break;case ao.ServerDate:o=new Date(i.$date);break;default:o=i}Array.isArray(r)?r.push(o):r[n]=o})),r},e.whichType=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);if(t===ao.Timestamp)return ao.BsonDate;if(t===ao.Object){if(e instanceof ei)return ao.GeoPoint;if(e instanceof Date)return ao.Timestamp;if(e instanceof Jo)return ao.ServerDate;e.$timestamp?t=ao.Timestamp:e.$date?t=ao.ServerDate:ei.validate(e)?t=ao.GeoPoint:qo.validate(e)?t=ao.GeoLineString:Wo.validate(e)?t=ao.GeoPolygon:$o.validate(e)?t=ao.GeoMultiPoint:Go.validate(e)?t=ao.GeoMultiLineString:Ko.validate(e)&&(t=ao.GeoMultiPolygon)}return t},e.generateDocId=function(){for(var e="ABCDEFabcdef0123456789",t="",n=0;n<24;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},e}(),Qo=function(){function e(){}return e.isGeopoint=function(e,t){if(Zo.whichType(t)!==ao.Number)throw new Error("Geo Point must be number type");var n=Math.abs(t);if("latitude"===e&&n>90)throw new Error("latitude should be a number ranges from -90 to 90");if("longitude"===e&&n>180)throw new Error("longitude should be a number ranges from -180 to 180");return!0},e.isInteger=function(e,t){if(!Number.isInteger(t))throw new Error(e+to.IntergerError);return!0},e.isFieldOrder=function(e){if(-1===uo.indexOf(e))throw new Error(to.DirectionError);return!0},e.isFieldPath=function(e){if(!/^[a-zA-Z0-9-_\.]/.test(e))throw new Error;return!0},e.isOperator=function(e){if(-1===co.indexOf(e))throw new Error(to.OpStrError);return!0},e.isCollName=function(e){if(!/^[a-zA-Z0-9]([a-zA-Z0-9-_]){1,32}$/.test(e))throw new Error(to.CollNameError);return!0},e.isDocID=function(e){if(!/^([a-fA-F0-9]){24}$/.test(e))throw new Error(to.DocIDError);return!0},e}(),ei=function(){function e(e,t){Qo.isGeopoint("longitude",e),Qo.isGeopoint("latitude",t),this.longitude=e,this.latitude=t}return e.prototype.parse=function(e){var t;return t={},t[e]={type:"Point",coordinates:[this.longitude,this.latitude]},t},e.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},e.prototype.toReadableString=function(){return"["+this.longitude+","+this.latitude+"]"},e.validate=function(e){return"Point"===e.type&&ko(e.coordinates)&&Qo.isGeopoint("longitude",e.coordinates[0])&&Qo.isGeopoint("latitude",e.coordinates[1])},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Eo},enumerable:!0,configurable:!0}),e}(),ti=function(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e};(function(e){e["SET"]="set",e["REMOVE"]="remove",e["INC"]="inc",e["MUL"]="mul",e["PUSH"]="push",e["PULL"]="pull",e["PULL_ALL"]="pullAll",e["POP"]="pop",e["SHIFT"]="shift",e["UNSHIFT"]="unshift",e["ADD_TO_SET"]="addToSet",e["BIT"]="bit",e["RENAME"]="rename",e["MAX"]="max",e["MIN"]="min"})(zo||(zo={}));var ni=function(){function e(e,t,n){this._internalType=_o,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||mo}return e.prototype._setFieldName=function(t){var n=new e(this.operator,this.operands,t);return n},e}();function ri(e){return e&&e instanceof ni&&e._internalType===_o}var oi;(function(e){e["AND"]="and",e["OR"]="or",e["NOT"]="not",e["NOR"]="nor"})(oi||(oi={}));var ii=function(){function e(e,t,n){if(this._internalType=wo,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=n||mo,this.fieldName!==mo)if(Array.isArray(t)){t=t.slice(),this.operands=t;for(var r=0,o=t.length;r<o;r++){var i=t[r];(si(i)||fi(i))&&(t[r]=i._setFieldName(this.fieldName))}}else{i=t;(si(i)||fi(i))&&(t=i._setFieldName(this.fieldName))}}return e.prototype._setFieldName=function(t){var n=this.operands.map((function(n){return n instanceof e?n._setFieldName(t):n})),r=new e(this.operator,n,t);return r},e.prototype.and=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return r.unshift(this),new e(oi.AND,r,this.fieldName)},e.prototype.or=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return r.unshift(this),new e(oi.OR,r,this.fieldName)},e}();function si(e){return e&&e instanceof ii&&e._internalType===wo}var ai,ui=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();(function(e){e["EQ"]="eq",e["NEQ"]="neq",e["GT"]="gt",e["GTE"]="gte",e["LT"]="lt",e["LTE"]="lte",e["IN"]="in",e["NIN"]="nin",e["ALL"]="all",e["ELEM_MATCH"]="elemMatch",e["EXISTS"]="exists",e["SIZE"]="size",e["MOD"]="mod",e["GEO_NEAR"]="geoNear",e["GEO_WITHIN"]="geoWithin",e["GEO_INTERSECTS"]="geoIntersects"})(ai||(ai={}));var ci=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.operator=t,o._internalType=bo,o}return ui(t,e),t.prototype.toJSON=function(){var e,t;switch(this.operator){case ai.IN:case ai.NIN:return e={},e["$"+this.operator]=this.operands,e;default:return t={},t["$"+this.operator]=this.operands[0],t}},t.prototype._setFieldName=function(e){var n=new t(this.operator,this.operands,e);return n},t.prototype.eq=function(e){var n=new t(ai.EQ,[e],this.fieldName);return this.and(n)},t.prototype.neq=function(e){var n=new t(ai.NEQ,[e],this.fieldName);return this.and(n)},t.prototype.gt=function(e){var n=new t(ai.GT,[e],this.fieldName);return this.and(n)},t.prototype.gte=function(e){var n=new t(ai.GTE,[e],this.fieldName);return this.and(n)},t.prototype.lt=function(e){var n=new t(ai.LT,[e],this.fieldName);return this.and(n)},t.prototype.lte=function(e){var n=new t(ai.LTE,[e],this.fieldName);return this.and(n)},t.prototype.in=function(e){var n=new t(ai.IN,e,this.fieldName);return this.and(n)},t.prototype.nin=function(e){var n=new t(ai.NIN,e,this.fieldName);return this.and(n)},t.prototype.geoNear=function(e){if(!(e.geometry instanceof ei))throw new TypeError('"geometry" must be of type Point. Received type '+typeof e.geometry);if(void 0!==e.maxDistance&&!Co(e.maxDistance))throw new TypeError('"maxDistance" must be of type Number. Received type '+typeof e.maxDistance);if(void 0!==e.minDistance&&!Co(e.minDistance))throw new TypeError('"minDistance" must be of type Number. Received type '+typeof e.minDistance);var n=new t(ai.GEO_NEAR,[e],this.fieldName);return this.and(n)},t.prototype.geoWithin=function(e){if(!(e.geometry instanceof Ko)&&!(e.geometry instanceof Wo))throw new TypeError('"geometry" must be of type Polygon or MultiPolygon. Received type '+typeof e.geometry);var n=new t(ai.GEO_WITHIN,[e],this.fieldName);return this.and(n)},t.prototype.geoIntersects=function(e){if(!(e.geometry instanceof ei)&&!(e.geometry instanceof qo)&&!(e.geometry instanceof Wo)&&!(e.geometry instanceof $o)&&!(e.geometry instanceof Go)&&!(e.geometry instanceof Ko))throw new TypeError('"geometry" must be of type Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon. Received type '+typeof e.geometry);var n=new t(ai.GEO_INTERSECTS,[e],this.fieldName);return this.and(n)},t}(ii);function fi(e){return e&&e instanceof ci&&e._internalType===bo}function li(e){return fi(e)}var hi={};for(var pi in ai)hi[pi]="$"+pi;for(var pi in oi)hi[pi]="$"+pi;for(var pi in zo)hi[pi]="$"+pi;function di(e){return hi[e]||"$"+e}hi[ai.NEQ]="$ne",hi[zo.REMOVE]="$unset",hi[zo.SHIFT]="$pop",hi[zo.UNSHIFT]="$push";var yi=function(){return yi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},yi.apply(this,arguments)},gi=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{while((void 0===t||t-- >0)&&!(r=i.next()).done)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return s},vi=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(gi(arguments[t]));return e};function mi(e){return _i(e,[e])}function _i(e,t){if(!jo(e)){if(Uo(e))return{$date:+e};if(Do(e))return{$regex:e.source,$options:e.flags};if(ko(e))return e.map((function(e){if(t.indexOf(e)>-1)throw new Error("Cannot convert circular structure to JSON");return _i(e,vi(t,[e]))}));if(xo(e)){var n=yi({},e);for(var r in n){if(t.indexOf(n[r])>-1)throw new Error("Cannot convert circular structure to JSON");n[r]=_i(n[r],vi(t,[n[r]]))}return n}return e}switch(e._internalType){case Eo:return e.toJSON();case No:return e.parse();case Ro:return e.parse();default:return e.toJSON?e.toJSON():e}}var bi=function(){return bi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},bi.apply(this,arguments)},wi=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{while((void 0===t||t-- >0)&&!(r=i.next()).done)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(o)throw o.error}}return s},Ei=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(wi(arguments[t]));return e};function Si(e,t,n,r){var o=bi({},e);for(var i in e)if(!/^\$/.test(i)){var s=e[i];if(s&&xo(s)&&!t(s)){if(r.indexOf(s)>-1)throw new Error("Cannot convert circular structure to JSON");var a=Ei(n,[i]),u=Ei(r,[s]),c=Si(s,t,a,u);o[i]=c;var f=!1;for(var l in c)/^\$/.test(l)?f=!0:(o[i+"."+l]=c[l],delete o[i][l]);f||delete o[i]}}return o}function Ii(e){return Si(e,Ai,[],[e])}function Oi(e,t,n){for(var r in t[n]||delete e[n],t)e[r]?ko(e[r])?e[r].push(t[r]):xo(e[r])?xo(t[r])?Object.assign(e[r],t[r]):(console.warn("unmergable condition, query is object but condition is "+Po(t)+", can only overwrite",t,n),e[r]=t[r]):(console.warn("to-merge query is of type "+Po(e)+", can only overwrite",e,t,n),e[r]=t[r]):e[r]=t[r]}function Ai(e){return jo(e)||Uo(e)||Do(e)}function Ti(e){return mi(e)}var Ni=function(){function e(){}return e.encode=function(t){var n=new e;return n.encodeUpdate(t)},e.prototype.encodeUpdate=function(e){return ri(e)?this.encodeUpdateCommand(e):"object"===Po(e)?this.encodeUpdateObject(e):e},e.prototype.encodeUpdateCommand=function(e){if(e.fieldName===mo)throw new Error("Cannot encode a comparison command with unset field name");switch(e.operator){case zo.PUSH:case zo.PULL:case zo.PULL_ALL:case zo.POP:case zo.SHIFT:case zo.UNSHIFT:case zo.ADD_TO_SET:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},e.prototype.encodeFieldUpdateCommand=function(e){var t,n,r,o,i=di(e.operator);switch(e.operator){case zo.REMOVE:return t={},t[i]=(n={},n[e.fieldName]="",n),t;default:return r={},r[i]=(o={},o[e.fieldName]=e.operands[0],o),r}},e.prototype.encodeArrayUpdateCommand=function(e){var t,n,r,o,i,s,a,u,c,f,l=di(e.operator);switch(e.operator){case zo.PUSH:var h=void 0;return h=ko(e.operands)?{$each:e.operands.map(Ti)}:e.operands,t={},t[l]=(n={},n[e.fieldName]=h,n),t;case zo.UNSHIFT:h={$each:e.operands.map(Ti),$position:0};return r={},r[l]=(o={},o[e.fieldName]=h,o),r;case zo.POP:return i={},i[l]=(s={},s[e.fieldName]=1,s),i;case zo.SHIFT:return a={},a[l]=(u={},u[e.fieldName]=-1,u),a;default:return c={},c[l]=(f={},f[e.fieldName]=Ti(e.operands),f),c}},e.prototype.encodeUpdateObject=function(e){var t=Ii(e);for(var n in t)if(!/^\$/.test(n)){var r=t[n];if(ri(r)){t[n]=r._setFieldName(n);var o=this.encodeUpdateCommand(t[n]);Oi(t,o,n)}else{t[n]=r=Ti(r);var i=new ni(zo.SET,[r],n);o=this.encodeUpdateCommand(i);Oi(t,o,n)}}return t},e}(),Ri={};function Pi(e){if(!ys.wsClientClass)throw new Error("to use realtime you must import realtime module first");var t=e.config.env;return Ri[t]||(Ri[t]=new ys.wsClientClass({context:{appConfig:{docSizeLimit:1e3,realtimePingInterval:1e4,realtimePongWaitTimeout:5e3,request:new ys.reqClass(e.config)}}})),Ri[t]}var xi=function(){return xi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},xi.apply(this,arguments)},Li=function(){function e(e,t,n,r){var o=this;void 0===r&&(r={}),this.watch=function(e){var t=Pi(o._db);return t.watch(xi(xi({},e),{envId:o._db.config.env,collectionName:o._coll,query:JSON.stringify({_id:o.id})}))},this._db=e,this._coll=t,this.id=n,this.request=new ys.reqClass(this._db.config),this.projection=r}return e.prototype.create=function(e,t){t=t||ti();var n={collectionName:this._coll,data:mi(e)};return this.id&&(n["_id"]=this.id),this.request.send("database.addDocument",n).then((function(e){e.code?t(0,e):t(0,{id:e.data._id,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},e.prototype.set=function(e,t){if(t=t||ti(),!this.id)return Promise.resolve({code:"INVALID_PARAM",message:"docId不能为空"});if(!e||"object"!==typeof e)return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n=!1,r=function(e){if("object"===typeof e)for(var t in e)e[t]instanceof ni?n=!0:"object"===typeof e[t]&&r(e[t])};if(r(e),n)return Promise.resolve({code:"DATABASE_REQUEST_FAILED",message:"update operator complicit"});var o=!1,i={collectionName:this._coll,queryType:fo.DOC,data:mi(e),multi:!1,merge:o,upsert:!0};return this.id&&(i["query"]={_id:this.id}),this.request.send("database.updateDocument",i).then((function(e){e.code?t(0,e):t(0,{updated:e.data.updated,upsertedId:e.data.upserted_id,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},e.prototype.update=function(e,t){if(t=t||ti(),!e||"object"!==typeof e)return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={_id:this.id},r=!0,o={collectionName:this._coll,data:Ni.encode(e),query:n,queryType:fo.DOC,multi:!1,merge:r,upsert:!1};return this.request.send("database.updateDocument",o).then((function(e){e.code?t(0,e):t(0,{updated:e.data.updated,upsertedId:e.data.upserted_id,requestId:e.requestId})})).catch((function(e){t(e)})),t.promise},e.prototype.remove=function(e){e=e||ti();var t={_id:this.id},n={collectionName:this._coll,query:t,queryType:fo.DOC,multi:!1};return this.request.send("database.deleteDocument",n).then((function(t){t.code?e(0,t):e(0,{deleted:t.data.deleted,requestId:t.requestId})})).catch((function(t){e(t)})),e.promise},e.prototype.get=function(e){e=e||ti();var t={_id:this.id},n={collectionName:this._coll,query:t,queryType:fo.DOC,multi:!1,projection:this.projection};return this.request.send("database.queryDocument",n).then((function(t){if(t.code)e(0,t);else{var n=Zo.formatResDocumentData(t.data.list);e(0,{data:n,requestId:t.requestId,total:t.TotalCount,limit:t.Limit,offset:t.Offset})}})).catch((function(t){e(t)})),e.promise},e.prototype.field=function(t){for(var n in t)t[n]?t[n]=1:t[n]=0;return new e(this._db,this._coll,this.id,t)},e}(),Ci=function(){function e(){}return e.encode=function(e){var t=new ki;return t.encodeQuery(e)},e}(),ki=function(){function e(){}return e.prototype.encodeQuery=function(e,t){var n;return Ai(e)?si(e)?this.encodeLogicCommand(e):fi(e)?this.encodeQueryCommand(e):(n={},n[t]=this.encodeQueryObject(e),n):xo(e)?this.encodeQueryObject(e):e},e.prototype.encodeRegExp=function(e){return{$regex:e.source,$options:e.flags}},e.prototype.encodeLogicCommand=function(e){var t,n,r,o,i,s,a,u=this;switch(e.operator){case oi.NOR:case oi.AND:case oi.OR:var c=di(e.operator),f=e.operands.map((function(t){return u.encodeQuery(t,e.fieldName)}));return t={},t[c]=f,t;case oi.NOT:c=di(e.operator);var l=e.operands[0];if(Do(l))return n={},n[e.fieldName]=(r={},r[c]=this.encodeRegExp(l),r),n;f=this.encodeQuery(l)[e.fieldName];return o={},o[e.fieldName]=(i={},i[c]=f,i),o;default:c=di(e.operator);if(1===e.operands.length){var h=this.encodeQuery(e.operands[0]);return s={},s[c]=h,s}f=e.operands.map(this.encodeQuery.bind(this));return a={},a[c]=f,a}},e.prototype.encodeQueryCommand=function(e){return li(e),this.encodeComparisonCommand(e)},e.prototype.encodeComparisonCommand=function(e){var t,n,r,o,i,s,a,u,c;if(e.fieldName===mo)throw new Error("Cannot encode a comparison command with unset field name");var f=di(e.operator);switch(e.operator){case ai.EQ:case ai.NEQ:case ai.LT:case ai.LTE:case ai.GT:case ai.GTE:case ai.ELEM_MATCH:case ai.EXISTS:case ai.SIZE:case ai.MOD:return t={},t[e.fieldName]=(n={},n[f]=Ti(e.operands[0]),n),t;case ai.IN:case ai.NIN:case ai.ALL:return r={},r[e.fieldName]=(o={},o[f]=Ti(e.operands),o),r;case ai.GEO_NEAR:var l=e.operands[0];return i={},i[e.fieldName]={$nearSphere:{$geometry:l.geometry.toJSON(),$maxDistance:l.maxDistance,$minDistance:l.minDistance}},i;case ai.GEO_WITHIN:l=e.operands[0];return s={},s[e.fieldName]={$geoWithin:{$geometry:l.geometry.toJSON()}},s;case ai.GEO_INTERSECTS:l=e.operands[0];return a={},a[e.fieldName]={$geoIntersects:{$geometry:l.geometry.toJSON()}},a;default:return u={},u[e.fieldName]=(c={},c[f]=Ti(e.operands[0]),c),u}},e.prototype.encodeQueryObject=function(e){var t=Ii(e);for(var n in t){var r=t[n];if(si(r)){t[n]=r._setFieldName(n);var o=this.encodeLogicCommand(t[n]);this.mergeConditionAfterEncode(t,o,n)}else if(li(r)){t[n]=r._setFieldName(n);o=this.encodeComparisonCommand(t[n]);this.mergeConditionAfterEncode(t,o,n)}else Ai(r)&&(t[n]=Ti(r))}return t},e.prototype.mergeConditionAfterEncode=function(e,t,n){for(var r in t[n]||delete e[n],t)e[r]?ko(e[r])?e[r]=e[r].concat(t[r]):xo(e[r])?xo(t[r])?Object.assign(e,t):(console.warn("unmergable condition, query is object but condition is "+Po(t)+", can only overwrite",t,n),e[r]=t[r]):(console.warn("to-merge query is of type "+Po(e)+", can only overwrite",e,t,n),e[r]=t[r]):e[r]=t[r]},e}(),Ui=function(){return Ui=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ui.apply(this,arguments)},Di=function(){function e(e,t,n,r,o){var i=this;this.watch=function(e){var t=Pi(i._db);return t.watch(Ui(Ui({},e),{envId:i._db.config.env,collectionName:i._coll,query:JSON.stringify(i._fieldFilters||{}),limit:i._queryOptions.limit,orderBy:i._fieldOrders?i._fieldOrders.reduce((function(e,t){return e[t.field]=t.direction,e}),{}):void 0}))},this._db=e,this._coll=t,this._fieldFilters=n,this._fieldOrders=r||[],this._queryOptions=o||{},this._request=new ys.reqClass(this._db.config)}return e.prototype.get=function(e){e=e||ti();var t=[];this._fieldOrders&&this._fieldOrders.forEach((function(e){t.push(e)}));var n={collectionName:this._coll,queryType:fo.WHERE};return this._fieldFilters&&(n.query=this._fieldFilters),t.length>0&&(n.order=t),this._queryOptions.offset&&(n.offset=this._queryOptions.offset),this._queryOptions.limit?n.limit=this._queryOptions.limit<1e3?this._queryOptions.limit:1e3:n.limit=100,this._queryOptions.projection&&(n.projection=this._queryOptions.projection),this._request.send("database.queryDocument",n).then((function(t){if(t.code)e(0,t);else{var n=Zo.formatResDocumentData(t.data.list),r={data:n,requestId:t.requestId};t.TotalCount&&(r.total=t.TotalCount),t.Limit&&(r.limit=t.Limit),t.Offset&&(r.offset=t.Offset),e(0,r)}})).catch((function(t){e(t)})),e.promise},e.prototype.count=function(e){e=e||ti();var t={collectionName:this._coll,queryType:fo.WHERE};return this._fieldFilters&&(t.query=this._fieldFilters),this._request.send("database.countDocument",t).then((function(t){t.code?e(0,t):e(0,{requestId:t.requestId,total:t.data.total})})).catch((function(t){e(t)})),e.promise},e.prototype.where=function(t){if("Object"!==Object.prototype.toString.call(t).slice(8,-1))throw Error(to.QueryParamTypeError);var n=Object.keys(t),r=n.some((function(e){return void 0!==t[e]}));if(n.length&&!r)throw Error(to.QueryParamValueError);return new e(this._db,this._coll,Ci.encode(t),this._fieldOrders,this._queryOptions)},e.prototype.orderBy=function(t,n){Qo.isFieldPath(t),Qo.isFieldOrder(n);var r={field:t,direction:n},o=this._fieldOrders.concat(r);return new e(this._db,this._coll,this._fieldFilters,o,this._queryOptions)},e.prototype.limit=function(t){Qo.isInteger("limit",t);var n=Ui({},this._queryOptions);return n.limit=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},e.prototype.skip=function(t){Qo.isInteger("offset",t);var n=Ui({},this._queryOptions);return n.offset=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,n)},e.prototype.update=function(e,t){if(t=t||ti(),!e||"object"!==typeof e)return Promise.resolve({code:"INVALID_PARAM",message:"参数必需是非空对象"});if(e.hasOwnProperty("_id"))return Promise.resolve({code:"INVALID_PARAM",message:"不能更新_id的值"});var n={collectionName:this._coll,query:this._fieldFilters,queryType:fo.WHERE,multi:!0,merge:!0,upsert:!1,data:Ni.encode(e)};return this._request.send("database.updateDocument",n).then((function(e){e.code?t(0,e):t(0,{requestId:e.requestId,updated:e.data.updated,upsertId:e.data.upsert_id})})).catch((function(e){t(e)})),t.promise},e.prototype.field=function(t){for(var n in t)t[n]?"object"!==typeof t[n]&&(t[n]=1):t[n]=0;var r=Ui({},this._queryOptions);return r.projection=t,new e(this._db,this._coll,this._fieldFilters,this._fieldOrders,r)},e.prototype.remove=function(e){e=e||ti(),Object.keys(this._queryOptions).length>0&&console.warn("`offset`, `limit` and `projection` are not supported in remove() operation"),this._fieldOrders.length>0&&console.warn("`orderBy` is not supported in remove() operation");var t={collectionName:this._coll,query:Ci.encode(this._fieldFilters),queryType:fo.WHERE,multi:!0};return this._request.send("database.deleteDocument",t).then((function(t){t.code?e(0,t):e(0,{requestId:t.requestId,deleted:t.data.deleted})})).catch((function(t){e(t)})),e.promise},e}(),ji=n("9e8e"),Mi=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},qi=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Bi=function(){function e(e,t){this._stages=[],e&&t&&(this._db=e,this._request=new ys.reqClass(this._db.config),this._collectionName=t)}return e.prototype.end=function(){return Mi(this,void 0,void 0,(function(){var e;return qi(this,(function(t){switch(t.label){case 0:if(!this._collectionName||!this._db)throw new Error("Aggregation pipeline cannot send request");return[4,this._request.send("database.aggregate",{collectionName:this._collectionName,stages:this._stages})];case 1:return e=t.sent(),e&&e.data&&e.data.list?[2,{requestId:e.requestId,data:JSON.parse(e.data.list).map(ji["a"].parse)}]:[2,e]}}))}))},e.prototype.unwrap=function(){return this._stages},e.prototype.done=function(){return this._stages.map((function(e){var t,n=e.stageKey,r=e.stageValue;return t={},t[n]=JSON.parse(r),t}))},e.prototype._pipe=function(e,t){return this._stages.push({stageKey:"$"+e,stageValue:JSON.stringify(t)}),this},e.prototype.addFields=function(e){return this._pipe("addFields",e)},e.prototype.bucket=function(e){return this._pipe("bucket",e)},e.prototype.bucketAuto=function(e){return this._pipe("bucketAuto",e)},e.prototype.count=function(e){return this._pipe("count",e)},e.prototype.geoNear=function(e){return this._pipe("geoNear",e)},e.prototype.group=function(e){return this._pipe("group",e)},e.prototype.limit=function(e){return this._pipe("limit",e)},e.prototype.match=function(e){return this._pipe("match",Ci.encode(e))},e.prototype.project=function(e){return this._pipe("project",e)},e.prototype.lookup=function(e){return this._pipe("lookup",e)},e.prototype.replaceRoot=function(e){return this._pipe("replaceRoot",e)},e.prototype.sample=function(e){return this._pipe("sample",e)},e.prototype.skip=function(e){return this._pipe("skip",e)},e.prototype.sort=function(e){return this._pipe("sort",e)},e.prototype.sortByCount=function(e){return this._pipe("sortByCount",e)},e.prototype.unwind=function(e){return this._pipe("unwind",e)},e}(),Wi=Bi,Fi=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$i=function(e){function t(t,n){return e.call(this,t,n)||this}return Fi(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(e){if("string"!==typeof e&&"number"!==typeof e)throw new Error("docId必须为字符串或数字");return new Li(this._db,this._coll,e)},t.prototype.add=function(e,t){var n=new Li(this._db,this._coll,void 0);return n.create(e,t)},t.prototype.aggregate=function(){return new Wi(this._db,this._coll)},t}(Di),Hi={eq:function(e){return new ci(ai.EQ,[e])},neq:function(e){return new ci(ai.NEQ,[e])},lt:function(e){return new ci(ai.LT,[e])},lte:function(e){return new ci(ai.LTE,[e])},gt:function(e){return new ci(ai.GT,[e])},gte:function(e){return new ci(ai.GTE,[e])},in:function(e){return new ci(ai.IN,e)},nin:function(e){return new ci(ai.NIN,e)},all:function(e){return new ci(ai.ALL,e)},elemMatch:function(e){return new ci(ai.ELEM_MATCH,[e])},exists:function(e){return new ci(ai.EXISTS,[e])},size:function(e){return new ci(ai.SIZE,[e])},mod:function(e){return new ci(ai.MOD,[e])},geoNear:function(e){return new ci(ai.GEO_NEAR,[e])},geoWithin:function(e){return new ci(ai.GEO_WITHIN,[e])},geoIntersects:function(e){return new ci(ai.GEO_INTERSECTS,[e])},and:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ko(arguments[0])?arguments[0]:Array.from(arguments);return new ii(oi.AND,n)},nor:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ko(arguments[0])?arguments[0]:Array.from(arguments);return new ii(oi.NOR,n)},or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ko(arguments[0])?arguments[0]:Array.from(arguments);return new ii(oi.OR,n)},not:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ko(arguments[0])?arguments[0]:Array.from(arguments);return new ii(oi.NOT,n)},set:function(e){return new ni(zo.SET,[e])},remove:function(){return new ni(zo.REMOVE,[])},inc:function(e){return new ni(zo.INC,[e])},mul:function(e){return new ni(zo.MUL,[e])},push:function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(xo(t[0])&&t[0].hasOwnProperty("each")){var r=t[0];e={$each:r.each,$position:r.position,$sort:r.sort,$slice:r.slice}}else e=ko(t[0])?t[0]:Array.from(t);return new ni(zo.PUSH,e)},pull:function(e){return new ni(zo.PULL,e)},pullAll:function(e){return new ni(zo.PULL_ALL,e)},pop:function(){return new ni(zo.POP,[])},shift:function(){return new ni(zo.SHIFT,[])},unshift:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ko(arguments[0])?arguments[0]:Array.from(arguments);return new ni(zo.UNSHIFT,n)},addToSet:function(e){return new ni(zo.ADD_TO_SET,e)},rename:function(e){return new ni(zo.RENAME,[e])},bit:function(e){return new ni(zo.BIT,[e])},max:function(e){return new ni(zo.MAX,[e])},min:function(e){return new ni(zo.MIN,[e])},expr:function(e){return{$expr:e}},jsonSchema:function(e){return{$jsonSchema:e}},text:function(e){return Lo(e)?{$search:e.search}:{$search:e.search,$language:e.language,$caseSensitive:e.caseSensitive,$diacriticSensitive:e.diacriticSensitive}},aggregate:{pipeline:function(){return new Wi},abs:function(e){return new Gi("abs",e)},add:function(e){return new Gi("add",e)},ceil:function(e){return new Gi("ceil",e)},divide:function(e){return new Gi("divide",e)},exp:function(e){return new Gi("exp",e)},floor:function(e){return new Gi("floor",e)},ln:function(e){return new Gi("ln",e)},log:function(e){return new Gi("log",e)},log10:function(e){return new Gi("log10",e)},mod:function(e){return new Gi("mod",e)},multiply:function(e){return new Gi("multiply",e)},pow:function(e){return new Gi("pow",e)},sqrt:function(e){return new Gi("sqrt",e)},subtract:function(e){return new Gi("subtract",e)},trunc:function(e){return new Gi("trunc",e)},arrayElemAt:function(e){return new Gi("arrayElemAt",e)},arrayToObject:function(e){return new Gi("arrayToObject",e)},concatArrays:function(e){return new Gi("concatArrays",e)},filter:function(e){return new Gi("filter",e)},in:function(e){return new Gi("in",e)},indexOfArray:function(e){return new Gi("indexOfArray",e)},isArray:function(e){return new Gi("isArray",e)},map:function(e){return new Gi("map",e)},range:function(e){return new Gi("range",e)},reduce:function(e){return new Gi("reduce",e)},reverseArray:function(e){return new Gi("reverseArray",e)},size:function(e){return new Gi("size",e)},slice:function(e){return new Gi("slice",e)},zip:function(e){return new Gi("zip",e)},and:function(e){return new Gi("and",e)},not:function(e){return new Gi("not",e)},or:function(e){return new Gi("or",e)},cmp:function(e){return new Gi("cmp",e)},eq:function(e){return new Gi("eq",e)},gt:function(e){return new Gi("gt",e)},gte:function(e){return new Gi("gte",e)},lt:function(e){return new Gi("lt",e)},lte:function(e){return new Gi("lte",e)},neq:function(e){return new Gi("ne",e)},cond:function(e){return new Gi("cond",e)},ifNull:function(e){return new Gi("ifNull",e)},switch:function(e){return new Gi("switch",e)},dateFromParts:function(e){return new Gi("dateFromParts",e)},dateFromString:function(e){return new Gi("dateFromString",e)},dayOfMonth:function(e){return new Gi("dayOfMonth",e)},dayOfWeek:function(e){return new Gi("dayOfWeek",e)},dayOfYear:function(e){return new Gi("dayOfYear",e)},isoDayOfWeek:function(e){return new Gi("isoDayOfWeek",e)},isoWeek:function(e){return new Gi("isoWeek",e)},isoWeekYear:function(e){return new Gi("isoWeekYear",e)},millisecond:function(e){return new Gi("millisecond",e)},minute:function(e){return new Gi("minute",e)},month:function(e){return new Gi("month",e)},second:function(e){return new Gi("second",e)},hour:function(e){return new Gi("hour",e)},week:function(e){return new Gi("week",e)},year:function(e){return new Gi("year",e)},literal:function(e){return new Gi("literal",e)},mergeObjects:function(e){return new Gi("mergeObjects",e)},objectToArray:function(e){return new Gi("objectToArray",e)},allElementsTrue:function(e){return new Gi("allElementsTrue",e)},anyElementTrue:function(e){return new Gi("anyElementTrue",e)},setDifference:function(e){return new Gi("setDifference",e)},setEquals:function(e){return new Gi("setEquals",e)},setIntersection:function(e){return new Gi("setIntersection",e)},setIsSubset:function(e){return new Gi("setIsSubset",e)},setUnion:function(e){return new Gi("setUnion",e)},concat:function(e){return new Gi("concat",e)},dateToString:function(e){return new Gi("dateToString",e)},indexOfBytes:function(e){return new Gi("indexOfBytes",e)},indexOfCP:function(e){return new Gi("indexOfCP",e)},split:function(e){return new Gi("split",e)},strLenBytes:function(e){return new Gi("strLenBytes",e)},strLenCP:function(e){return new Gi("strLenCP",e)},strcasecmp:function(e){return new Gi("strcasecmp",e)},substr:function(e){return new Gi("substr",e)},substrBytes:function(e){return new Gi("substrBytes",e)},substrCP:function(e){return new Gi("substrCP",e)},toLower:function(e){return new Gi("toLower",e)},toUpper:function(e){return new Gi("toUpper",e)},meta:function(e){return new Gi("meta",e)},addToSet:function(e){return new Gi("addToSet",e)},avg:function(e){return new Gi("avg",e)},first:function(e){return new Gi("first",e)},last:function(e){return new Gi("last",e)},max:function(e){return new Gi("max",e)},min:function(e){return new Gi("min",e)},push:function(e){return new Gi("push",e)},stdDevPop:function(e){return new Gi("stdDevPop",e)},stdDevSamp:function(e){return new Gi("stdDevSamp",e)},sum:function(e){return new Gi("sum",e)},let:function(e){return new Gi("let",e)}},project:{slice:function(e){return new Vi("slice",e)},elemMatch:function(e){return new Vi("elemMatch",e)}}},Gi=function(){function e(e,t){this["$"+e]=t}return e}(),Vi=function(){function e(e,t){this["$"+e]=t}return e}(),Ki=function(){function e(e){var t=e.regexp,n=e.options;if(!t)throw new TypeError("regexp must be a string");this.$regex=t,this.$options=n}return e.prototype.parse=function(){return{$regex:this.$regex,$options:this.$options}},Object.defineProperty(e.prototype,"_internalType",{get:function(){return Ro},enumerable:!0,configurable:!0}),e}();function Ji(e){return new Ki(e)}var Yi={CREATE_WATCH_NET_ERROR:{code:"CREATE_WATCH_NET_ERROR",message:"create watch network error"},CREATE_WACTH_EXCEED_ERROR:{code:"CREATE_WACTH_EXCEED_ERROR",message:"maximum connections exceed"},CREATE_WATCH_SERVER_ERROR:{code:"CREATE_WATCH_SERVER_ERROR",message:"create watch server error"},CONN_ERROR:{code:"CONN_ERROR",message:"connection error"},INVALID_PARAM:{code:"INVALID_PARAM",message:"Invalid request param"},INSERT_DOC_FAIL:{code:"INSERT_DOC_FAIL",message:"insert document failed"},DATABASE_TRANSACTION_CONFLICT:{code:"DATABASE_TRANSACTION_CONFLICT",message:"database transaction conflict"}},zi=function(){return zi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},zi.apply(this,arguments)},Xi=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},Zi=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},Qi="database.getInTransaction",es="database.updateDocInTransaction",ts="database.deleteDocInTransaction",ns="database.insertDocInTransaction",rs=function(){function e(e,t,n){this._coll=t,this.id=n,this._transaction=e,this._request=this._transaction.getRequestMethod(),this._transactionId=this._transaction.getTransactionId()}return e.prototype.create=function(e){return Xi(this,void 0,void 0,(function(){var t,n,r,o;return Zi(this,(function(i){switch(i.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,data:ji["a"].stringify(mi(e),{relaxed:!1})},this.id&&(t["_id"]=this.id),[4,this._request.send(ns,t)];case 1:if(n=i.sent(),n.code)throw n;if(r=ji["a"].parse(n.inserted),o=ji["a"].parse(n.ok),1==o&&1==r)return[2,zi(zi({},n),{ok:o,inserted:r})];throw new Error(Yi.INSERT_DOC_FAIL.message)}}))}))},e.prototype.get=function(){return Xi(this,void 0,void 0,(function(){var e,t;return Zi(this,(function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(Qi,e)];case 1:if(t=n.sent(),t.code)throw t;return[2,{data:"null"!==t.data?Zo.formatField(ji["a"].parse(t.data)):ji["a"].parse(t.data),requestId:t.requestId}]}}))}))},e.prototype.set=function(e){return Xi(this,void 0,void 0,(function(){var t,n;return Zi(this,(function(r){switch(r.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:ji["a"].stringify(mi(e),{relaxed:!1}),upsert:!0},[4,this._request.send(es,t)];case 1:if(n=r.sent(),n.code)throw n;return[2,zi(zi({},n),{updated:ji["a"].parse(n.updated),upserted:n.upserted?JSON.parse(n.upserted):null})]}}))}))},e.prototype.update=function(e){return Xi(this,void 0,void 0,(function(){var t,n;return Zi(this,(function(r){switch(r.label){case 0:return t={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}},data:ji["a"].stringify(Ni.encode(e),{relaxed:!1})},[4,this._request.send(es,t)];case 1:if(n=r.sent(),n.code)throw n;return[2,zi(zi({},n),{updated:ji["a"].parse(n.updated)})]}}))}))},e.prototype.delete=function(){return Xi(this,void 0,void 0,(function(){var e,t;return Zi(this,(function(n){switch(n.label){case 0:return e={collectionName:this._coll,transactionId:this._transactionId,query:{_id:{$eq:this.id}}},[4,this._request.send(ts,e)];case 1:if(t=n.sent(),t.code)throw t;return[2,zi(zi({},t),{deleted:ji["a"].parse(t.deleted)})]}}))}))},e}(),os=function(){function e(e,t){this._coll=t,this._transaction=e}return e}(),is=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ss=function(e){function t(t,n){return e.call(this,t,n)||this}return is(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._coll},enumerable:!0,configurable:!0}),t.prototype.doc=function(e){if("string"!==typeof e&&"number"!==typeof e)throw new Error("docId必须为字符串或数字");return new rs(this._transaction,this._coll,e)},t.prototype.add=function(e){var t;void 0!==e._id&&(t=e._id);var n=new rs(this._transaction,this._coll,t);return n.create(e)},t}(os),as=function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(xs){i(xs)}}function a(e){try{u(r["throw"](e))}catch(xs){i(xs)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},us=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(xs){i=[6,xs],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},cs="database.startTransaction",fs="database.commitTransaction",ls="database.abortTransaction",hs=function(){function e(e){this._db=e,this._request=new ys.reqClass(this._db.config),this.aborted=!1,this.commited=!1,this.inited=!1}return e.prototype.init=function(){return as(this,void 0,void 0,(function(){var e;return us(this,(function(t){switch(t.label){case 0:return[4,this._request.send(cs)];case 1:if(e=t.sent(),e.code)throw e;return this.inited=!0,this._id=e.transactionId,[2]}}))}))},e.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new ss(this,e)},e.prototype.getTransactionId=function(){return this._id},e.prototype.getRequestMethod=function(){return this._request},e.prototype.commit=function(){return as(this,void 0,void 0,(function(){var e,t;return us(this,(function(n){switch(n.label){case 0:return e={transactionId:this._id},[4,this._request.send(fs,e)];case 1:if(t=n.sent(),t.code)throw t;return this.commited=!0,[2,t]}}))}))},e.prototype.rollback=function(e){return as(this,void 0,void 0,(function(){var t,n;return us(this,(function(r){switch(r.label){case 0:return t={transactionId:this._id},[4,this._request.send(ls,t)];case 1:if(n=r.sent(),n.code)throw n;return this.aborted=!0,this.abortReason=e,[2,n]}}))}))},e}();function ps(){return as(this,void 0,void 0,(function(){var e;return us(this,(function(t){switch(t.label){case 0:return e=new hs(this),[4,e.init()];case 1:return t.sent(),[2,e]}}))}))}function ds(e,t){return void 0===t&&(t=3),as(this,void 0,void 0,(function(){var n,r,o,i,s=this;return us(this,(function(a){switch(a.label){case 0:return a.trys.push([0,4,,10]),n=new hs(this),[4,n.init()];case 1:return a.sent(),[4,e(n)];case 2:if(r=a.sent(),!0===n.aborted)throw n.abortReason;return[4,n.commit()];case 3:return a.sent(),[2,r];case 4:if(o=a.sent(),!1===n.inited)throw o;return i=function(e){return as(s,void 0,void 0,(function(){return us(this,(function(t){switch(t.label){case 0:if(n.aborted||n.commited)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,n.rollback()];case 2:return t.sent(),[3,4];case 3:return t.sent(),[3,4];case 4:throw e;case 5:if(!0===n.aborted)throw n.abortReason;throw e}}))}))},t<=0?[4,i(o)]:[3,6];case 5:a.sent(),a.label=6;case 6:return o&&o.code===Yi.DATABASE_TRANSACTION_CONFLICT.code?[4,ds.bind(this)(e,--t)]:[3,8];case 7:return[2,a.sent()];case 8:return[4,i(o)];case 9:return a.sent(),[3,10];case 10:return[2]}}))}))}var ys=function(){function e(e){this.config=e,this.Geo=r,this.serverDate=Yo,this.command=Hi,this.RegExp=Ji,this.startTransaction=ps,this.runTransaction=ds,this.logicCommand=ii,this.updateCommand=ni,this.queryCommand=ci}return e.prototype.collection=function(e){if(!e)throw new Error("Collection name is required");return new $i(this,e)},e.prototype.createCollection=function(t){var n=new e.reqClass(this.config),r={collectionName:t};return n.send("database.addCollection",r)},e}(),gs=function(){return gs=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},gs.apply(this,arguments)},vs="database";function ms(e){var t=this.platform,n=t.adapter,r=t.runtime;return ys.reqClass=this.request.constructor,ys.getAccessToken=this.authInstance?this.authInstance.getAccessToken.bind(this.authInstance):function(){return""},ys.runtime=r,this.wsClientClass&&(ys.wsClass=n.wsClass,ys.wsClientClass=this.wsClientClass),ys.ws||(ys.ws=null),new ys(gs(gs({},this.config),e))}var _s={name:vs,entity:{database:ms}};try{cloudbase.registerComponent(_s)}catch(xs){}function bs(e){try{e.registerComponent(_s)}catch(xs){console.warn(xs)}}var ws=n("2d02"),Es=ws.version;we.registerVersion(Es);try{fn(we),In(we),Wn(we),bs(we),$r(we),io(we)}catch(xs){}try{window.cloudbase=we}catch(xs){}var Ss=we;const Is=Ss.init({env:"hello-cloudbase-9g3pfrfm2651f00e"}),Os=Is.database();function As(){const e=Os.collection("user").get();return console.log(e),e}function Ts(e){let t=Os.collection("infoList");return console.log(e),t.add(e),e}function Ns(e){let t=Os.collection("infoList");return console.log("更新用户:"+e),t.doc(e.name).update(e),t}function Rs(){let e=Os.collection("infoList").get();return console.log(e),e}function Ps(e){let t=Os.collection("user");return t.doc(e.id).remove(),Ts}},"21bf":function(e,t,n){(function(t,n){e.exports=n()})(0,(function(){var e=e||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},o=r.lib={},i=o.Base=function(){return{extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=o.WordArray=i.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=s<<24-(r+i)%4*8}else for(i=0;i<o;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],o=function(t){t=t;var n=987654321,r=4294967295;return function(){n=36969*(65535&n)+(n>>16)&r,t=18e3*(65535&t)+(t>>16)&r;var o=(n<<16)+t&r;return o/=4294967296,o+=.5,o*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var a=o(4294967296*(n||e.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,t)}}),a=r.enc={},u=a.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},c=a.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(n,t)}},f=a.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},l=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=4*i,u=o/a;u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var c=u*i,f=e.min(4*c,o);if(c){for(var l=0;l<c;l+=i)this._doProcessBlock(r,l);var h=r.splice(0,c);n.sigBytes-=f}return new s.init(h,f)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(o.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math);return e}))},"2d02":function(e){e.exports=JSON.parse('{"name":"@cloudbase/js-sdk","version":"1.7.2","description":"cloudbase javascript sdk","main":"dist/index.cjs.js","module":"dist/index.esm.js","miniprogram":"miniprogram_dist","typings":"./index.d.ts","scripts":{"lint":"eslint --fix \\"./src/**/*.ts\\" \\"./database/**/*.ts\\"","build":"rm -rf dist/ && gulp build","build:cdn":"gulp cdn","build:miniapp":"gulp miniapp","build:e2e":"rm -rf dist/ && NODE_ENV=e2e gulp e2e"},"publishConfig":{"access":"public"},"repository":{"type":"git","url":"https://github.com/TencentCloudBase/cloudbase-js-sdk"},"keywords":["tcb","cloudbase","Cloudbase","serverless","Serverless","javascript","JavaScript"],"files":["miniprogram_dist","**/dist/","/index.d.ts","**/package.json"],"components":["app","auth","database","functions","storage"],"author":"","license":"ISC","dependencies":{"@cloudbase/analytics":"^1.1.1-alpha.0","@cloudbase/app":"^1.4.1","@cloudbase/auth":"^1.6.1","@cloudbase/database":"0.9.18-next","@cloudbase/functions":"^1.3.4","@cloudbase/realtime":"^1.1.4-alpha.0","@cloudbase/storage":"^1.3.4","@cloudbase/types":"^1.1.3-alpha.0","@cloudbase/utilities":"^1.3.4"},"devDependencies":{"@babel/core":"^7.9.0","@babel/plugin-proposal-class-properties":"^7.8.3","@babel/plugin-transform-runtime":"^7.9.0","@babel/preset-env":"^7.9.5","@babel/preset-typescript":"^7.9.0","@typescript-eslint/eslint-plugin":"^3.8.0","@typescript-eslint/parser":"^3.8.0","awesome-typescript-loader":"^5.2.1","babel-loader":"^8.1.0","eslint":"^7.6.0","eslint-config-alloy":"^3.7.4","gulp":"^4.0.2","gulp-clean":"^0.4.0","gulp-rename":"^2.0.0","gulp-sourcemaps":"^2.6.5","gulp-typescript":"^6.0.0-alpha.1","json-loader":"^0.5.7","merge-stream":"^2.0.0","package-json-cleanup-loader":"^1.0.3","typescript":"^3.8.3","webpack":"4.41.3","webpack-cli":"^3.3.11","webpack-node-externals":"^1.7.2","webpack-stream":"^5.2.1","webpack-visualizer-plugin":"^0.1.11"},"browserslist":["last 2 version","> 1%","not dead","chrome 53"],"gitHead":"29ca0bf24318daa1fbb230910edf0b1545e17e7f"}')},"2f38":function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.useDefaultAdapter=t.useAdapters=t.RUNTIME=void 0;var s,a=i(n("c8ff")),u=n("8a32");function c(e){for(var t=u.isArray(e)?e:[e],n=0,r=t;n<r.length;n++){var o=r[n],i=o.isMatch,s=o.genAdapter,a=o.runtime;if(i())return{adapter:s(),runtime:a}}}function f(){return{adapter:a.genAdapter(),runtime:s.WEB}}(function(e){e["WEB"]="web",e["WX_MP"]="wx_mp"})(s=t.RUNTIME||(t.RUNTIME={})),t.useAdapters=c,t.useDefaultAdapter=f},"364b":function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.helpers=t.utils=t.events=t.cache=t.adapters=t.constants=void 0;var s=i(n("56b0"));t.constants=s;var a=i(n("2f38"));t.adapters=a;var u=i(n("0bda"));t.cache=u;var c=i(n("b038"));t.events=c;var f=i(n("8a32"));t.utils=f;var l=i(n("adad"));t.helpers=l},"56b0":function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n("17b0"),t),o(n("f5e5"),t)},5980:function(e,t,n){(function(t,r){e.exports=r(n("21bf"))})(0,(function(e){(function(){var t=e,n=t.lib,r=n.Base,o=t.enc,i=o.Utf8,s=t.algo;s.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),s=this._iKey=t.clone(),a=o.words,u=s.words,c=0;c<n;c++)a[c]^=1549556828,u[c]^=909522486;o.sigBytes=s.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var r=t.finalize(this._oKey.clone().concat(n));return r}})})()}))},"62e4":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"8a32":function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.transformPhone=t.sleep=t.printGroupLog=t.throwError=t.printInfo=t.printError=t.printWarn=t.execCallback=t.createPromiseCallback=t.removeParam=t.getHash=t.getQuery=t.toQueryString=t.createSign=t.formatUrl=t.genSeqId=t.isFormData=t.isInstanceOf=t.isNull=t.isPalinObject=t.isUndefined=t.isString=t.isArray=void 0;var o=r(n("ed53")),i=r(n("1132")),s=r(n("f8d5")),a=n("56b0");function u(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e){return"string"===typeof e}function f(e){return"undefined"===typeof e}function l(e){return"[object Object]"===Object.prototype.toString.call(e)}function h(e){return"[object Null]"===Object.prototype.toString.call(e)}function p(e,t){return e instanceof t}function d(e){return"[object FormData]"===Object.prototype.toString.call(e)}function y(){return Math.random().toString(16).slice(2)}function g(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),o="";for(var i in n)""===o?!r&&(t+="?"):o+="&",o+=i+"="+encodeURIComponent(n[i]);return t+=o,/^http(s)?\:\/\//.test(t)?t:""+e+t}function v(e){var t=i.default.stringify(e);return t=t.replace(/=+$/,""),t=t.replace(/\+/g,"-"),t=t.replace(/\//g,"_"),t}function m(e,t){var n={alg:"HS256",typ:"JWT"},r=v(s.default.parse(JSON.stringify(n))),i=v(s.default.parse(JSON.stringify(e))),a=r+"."+i,u=v(o.default(a,t));return a+"."+u}function _(e){void 0===e&&(e={});var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function b(e,t){if("undefined"===typeof window)return!1;var n=t||window.location.search,r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=n.substr(n.indexOf("?")+1).match(r);return null!=o?o[2]:""}function w(e,t){var n,r=t.split("?")[0],o=[],i=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==i){o=i.split("&");for(var s=o.length-1;s>=0;s-=1)n=o[s].split("=")[0],n===e&&o.splice(s,1);r=r+"?"+o.join("&")}return r}function E(){var e;if(!Promise){e=function(){},e.promise={};var t=function(){throw new Error('Your Node runtime does support ES6 Promises. Set "global.Promise" to your preferred implementation of promises.')};return Object.defineProperty(e.promise,"then",{get:t}),Object.defineProperty(e.promise,"catch",{get:t}),e}var n=new Promise((function(t,n){e=function(e,r){return e?n(e):t(r)}}));return e.promise=n,e}function S(e,t,n){if(void 0===n&&(n=null),e&&"function"===typeof e)return e(t,n);if(t)throw t;return n}function I(e,t){console.warn("["+a.getSdkName()+"]["+e+"]:"+t)}function O(e,t){console.error({code:e,msg:"["+a.getSdkName()+"]["+e+"]:"+t})}function A(e,t){console.log("["+a.getSdkName()+"]["+e+"]:"+t)}function T(e,t){throw new Error(JSON.stringify({code:e,msg:"["+a.getSdkName()+"]["+e+"]:"+t}))}function N(e){var t=e.title,n=e.subtitle,r=void 0===n?"":n,o=e.content,i=void 0===o?[]:o,s=e.printTrace,a=void 0!==s&&s,u=e.collapsed,c=void 0!==u&&u;c?console.groupCollapsed(t,r):console.group(t,r);for(var f=0,l=i;f<l.length;f++){var h=l[f],p=h.type,d=h.body;switch(p){case"info":console.log(d);break;case"warn":console.warn(d);break;case"error":console.error(d);break}}a&&console.trace("stack trace:"),console.groupEnd()}function R(e){return"+86"+e}t.isArray=u,t.isString=c,t.isUndefined=f,t.isPalinObject=l,t.isNull=h,t.isInstanceOf=p,t.isFormData=d,t.genSeqId=y,t.formatUrl=g,t.createSign=m,t.toQueryString=_,t.getQuery=b,t.getHash=function(e){if("undefined"===typeof window)return"";var t=window.location.hash.match(new RegExp("[#?&/]"+e+"=([^&#]*)"));return t?t[1]:""},t.removeParam=w,t.createPromiseCallback=E,t.execCallback=S,t.printWarn=I,t.printError=O,t.printInfo=A,t.throwError=T,t.printGroupLog=N,t.sleep=function(e){return void 0===e&&(e=0),new Promise((function(t){return setTimeout(t,e)}))},t.transformPhone=R},"94f8":function(e,t,n){(function(t,r){e.exports=r(n("21bf"))})(0,(function(e){return function(t){var n=e,r=n.lib,o=r.WordArray,i=r.Hasher,s=n.algo,a=[],u=[];(function(){function e(e){for(var n=t.sqrt(e),r=2;r<=n;r++)if(!(e%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}var r=2,o=0;while(o<64)e(r)&&(o<8&&(a[o]=n(t.pow(r,.5))),u[o]=n(t.pow(r,1/3)),o++),r++})();var c=[],f=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],f=n[5],l=n[6],h=n[7],p=0;p<64;p++){if(p<16)c[p]=0|e[t+p];else{var d=c[p-15],y=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,g=c[p-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;c[p]=y+c[p-7]+v+c[p-16]}var m=a&f^~a&l,_=r&o^r&i^o&i,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),E=h+w+m+u[p]+c[p],S=b+_;h=l,l=f,f=a,a=s+E|0,s=i,i=o,o=r,r=E+S|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+f|0,n[6]=n[6]+l|0,n[7]=n[7]+h|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=t.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=i._createHelper(f),n.HmacSHA256=i._createHmacHelper(f)}(Math),e.SHA256}))},"954c":function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.catchErrorsDecorator=void 0;var i=n("8a32"),s=n("56b0"),a=!1;"undefined"!==typeof navigator&&navigator.userAgent&&(a=-1!==navigator.userAgent.indexOf("Firefox"));var u=a?/(\.js\/)?__decorate(\$\d+)?<@.*\d$/:/(\/\w+\.js\.)?__decorate(\$\d+)?\s*\(.*\)$/,c=/https?\:\/\/.+\:\d*\/.*\.js\:\d+\:\d+/;function f(e){var t=e.mode,n=void 0===t?"async":t,a=e.customInfo,u=void 0===a?{}:a,c=e.title,f=e.messages,p=void 0===f?[]:f;return function(e,t,a){if(s.IS_DEBUG_MODE){var f=u.className||e.constructor.name,d=u.methodName||t,y=a.value,g=l(new Error);a.value="sync"===n?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=h({err:new Error,className:f,methodName:d,sourceLink:g});try{return y.apply(this,e)}catch(u){var r=u,o=u.message,s={title:c||f+"."+d+" failed",content:[{type:"error",body:u}]};if(o&&/^\{.*\}$/.test(o)){var a=JSON.parse(o);s.subtitle=o,a.code&&(n?(n.code=a.code,n.msg=a.msg):(u.code=a.code,u.message=a.msg),r=n||u,s.content=p.map((function(e){return{type:"info",body:e}})))}throw i.printGroupLog(s),r}}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t,n,r,s,a,u;return o(this,(function(o){switch(o.label){case 0:t=h({err:new Error,className:f,methodName:d,sourceLink:g}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,y.apply(this,e)];case 2:return[2,o.sent()];case 3:throw n=o.sent(),r=n,s=n.message,a={title:c||f+"."+d+" failed",content:[{type:"error",body:n}]},s&&/^\{.*\}$/.test(s)&&(u=JSON.parse(s),a.subtitle=u,u.code&&(t?(t.code=u.code,t.message=u.msg):(n.code=u.code,n.message=u.msg),r=t||n,a.content=p.map((function(e){return{type:"info",body:e}})))),i.printGroupLog(a),r;case 4:return[2]}}))}))}}}}function l(e){var t="",n=e.stack.split("\n"),r=n.findIndex((function(e){return u.test(e)}));if(-1!==r){var o=c.exec(n[r+1]||"");t=o?o[0]:""}return t}function h(e){var t=e.err,n=e.className,r=e.methodName,o=e.sourceLink;if(!o)return null;var i,s=t.stack.split("\n"),u=a?/^catchErrorsDecorator\/<\/descriptor.value@.*\d$/:new RegExp(n+"\\.descriptor.value\\s*\\[as\\s"+r+"\\]\\s*\\(.*\\)$"),f=a?/^catchErrorsDecorator\/<\/descriptor.value/:new RegExp(n+"\\.descriptor.value\\s*\\[as\\s"+r+"\\]"),l=s.findIndex((function(e){return u.test(e)}));if(-1!==l){var h=s.filter((function(e,t){return t>l}));h.unshift(s[l].replace(f,n+"."+r).replace(c,o)),i=new Error,i.stack=(a?"@debugger":"Error")+"\n"+h.join("\n")}return i}t.catchErrorsDecorator=f},"9e8e":function(e,t,n){"use strict";(function(e){function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}n.d(t,"a",(function(){return Qe}));for(var o=d,i=g,s=_,a=[],u=[],c="undefined"!==typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=0,h=f.length;l<h;++l)a[l]=f[l],u[f.charCodeAt(l)]=l;function p(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function d(e){var t=p(e),n=t[0],r=t[1];return 3*(n+r)/4-r}function y(e,t,n){return 3*(t+n)/4-n}function g(e){var t,n,r=p(e),o=r[0],i=r[1],s=new c(y(e,o,i)),a=0,f=i>0?o-4:o;for(n=0;n<f;n+=4)t=u[e.charCodeAt(n)]<<18|u[e.charCodeAt(n+1)]<<12|u[e.charCodeAt(n+2)]<<6|u[e.charCodeAt(n+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;return 2===i&&(t=u[e.charCodeAt(n)]<<2|u[e.charCodeAt(n+1)]>>4,s[a++]=255&t),1===i&&(t=u[e.charCodeAt(n)]<<10|u[e.charCodeAt(n+1)]<<4|u[e.charCodeAt(n+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t),s}function v(e){return a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[63&e]}function m(e,t,n){for(var r,o=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(v(r));return o.join("")}function _(e){for(var t,n=e.length,r=n%3,o=[],i=16383,s=0,u=n-r;s<u;s+=i)o.push(m(e,s,s+i>u?u:s+i));return 1===r?(t=e[n-1],o.push(a[t>>2]+a[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],o.push(a[t>>10]+a[t>>4&63]+a[t<<2&63]+"=")),o.join("")}u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63;var b={byteLength:o,toByteArray:i,fromByteArray:s},w=function(e,t,n,r,o){var i,s,a=8*o-r-1,u=(1<<a)-1,c=u>>1,f=-7,l=n?o-1:0,h=n?-1:1,p=e[t+l];for(l+=h,i=p&(1<<-f)-1,p>>=-f,f+=a;f>0;i=256*i+e[t+l],l+=h,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;f>0;s=256*s+e[t+l],l+=h,f-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),i-=c}return(p?-1:1)*s*Math.pow(2,i-r)},E=function(e,t,n,r,o,i){var s,a,u,c=8*i-o-1,f=(1<<c)-1,l=f>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+l>=1?h/u:h*Math.pow(2,1-l),t*u>=2&&(s++,u/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(t*u-1)*Math.pow(2,o),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;e[n+p]=255&a,p+=d,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[n+p]=255&s,p+=d,s/=256,c-=8);e[n+p-d]|=128*y},S={read:w,write:E},I=r((function(e,t){var n="function"===typeof Symbol&&"function"===typeof Symbol["for"]?Symbol["for"]("nodejs.util.inspect.custom"):null;t.Buffer=s,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50;var r=2147483647;function o(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(n){return!1}}function i(e){if(e>r)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return f(e)}return a(e,t,n)}function a(e,t,n){if("string"===typeof e)return l(e,t);if(ArrayBuffer.isView(e))return p(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers["typeof"](e));if(z(e,ArrayBuffer)||e&&z(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(z(e,SharedArrayBuffer)||e&&z(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return s.from(r,t,n);var o=y(e);if(o)return o;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers["typeof"](e))}function u(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function c(e,t,n){return u(e),e<=0?i(e):void 0!==t?"string"===typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}function f(e){return u(e),i(e<0?0:0|g(e))}function l(e,t){if("string"===typeof t&&""!==t||(t="utf8"),!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|m(e,t),r=i(n),o=r.write(e,t);return o!==n&&(r=r.slice(0,o)),r}function h(e){for(var t=e.length<0?0:0|g(e.length),n=i(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function p(e){if(z(e,Uint8Array)){var t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return h(e)}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,s.prototype),r}function y(e){if(s.isBuffer(e)){var t=0|g(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!==typeof e.length||X(e.length)?i(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}function g(e){if(e>=r)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r.toString(16)+" bytes");return 0|e}function v(e){return+e!=e&&(e=0),s.alloc(+e)}function m(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||z(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers["typeof"](e));var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return J(e).length;default:if(o)return r?-1:G(e).length;t=(""+t).toLowerCase(),o=!0}}function _(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";e||(e="utf8");while(1)switch(e){case"hex":return D(this,t,n);case"utf8":case"utf-8":return x(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return U(this,t,n);case"base64":return P(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function w(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function E(e,t,n,r,o){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,X(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"===typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:I(e,t,n,r,o);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):I(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function I(e,t,n,r,o){var i,s=1,a=e.length,u=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var f=-1;for(i=n;i<a;i++)if(c(e,i)===c(t,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===u)return f*s}else-1!==f&&(i-=i-f),f=-1}else for(n+u>a&&(n=a-u),i=n;i>=0;i--){for(var l=!0,h=0;h<u;h++)if(c(e,i+h)!==c(t,h)){l=!1;break}if(l)return i}return-1}function O(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r),r>o&&(r=o)):r=o;var i=t.length;r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(X(a))return s;e[n+s]=a}return s}function A(e,t,n,r){return Y(G(t,e.length-n),e,n,r)}function T(e,t,n,r){return Y(V(t),e,n,r)}function N(e,t,n,r){return Y(J(t),e,n,r)}function R(e,t,n,r){return Y(K(t,e.length-n),e,n,r)}function P(e,t,n){return 0===t&&n===e.length?b.fromByteArray(e):b.fromByteArray(e.slice(t,n))}function x(e,t,n){n=Math.min(e.length,n);var r=[],o=t;while(o<n){var i,s,a,u,c=e[o],f=null,l=c>239?4:c>223?3:c>191?2:1;if(o+l<=n)switch(l){case 1:c<128&&(f=c);break;case 2:i=e[o+1],128===(192&i)&&(u=(31&c)<<6|63&i,u>127&&(f=u));break;case 3:i=e[o+1],s=e[o+2],128===(192&i)&&128===(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s,u>2047&&(u<55296||u>57343)&&(f=u));break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128===(192&i)&&128===(192&s)&&128===(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a,u>65535&&u<1114112&&(f=u))}null===f?(f=65533,l=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),o+=l}return C(r)}t.kMaxLength=r,s.TYPED_ARRAY_SUPPORT=o(),s.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,n){return a(e,t,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,n){return c(e,t,n)},s.allocUnsafe=function(e){return f(e)},s.allocUnsafeSlow=function(e){return f(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(z(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),z(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var i=e[n];if(z(i,Uint8Array))o+i.length>r.length?s.from(i).copy(r,o):Uint8Array.prototype.set.call(r,i,o);else{if(!s.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o)}o+=i.length}return r},s.byteLength=m,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)w(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)w(this,t,t+3),w(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)w(this,t,t+7),w(this,t+1,t+6),w(this,t+2,t+5),w(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?x(this,0,e):_.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},n&&(s.prototype[n]=s.prototype.inspect),s.prototype.compare=function(e,t,n,r,o){if(z(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers["typeof"](e));if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,o>>>=0,this===e)return 0;for(var i=o-r,a=n-t,u=Math.min(i,a),c=this.slice(r,o),f=e.slice(t,n),l=0;l<u;++l)if(c[l]!==f[l]){i=c[l],a=f[l];break}return i<a?-1:a<i?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return E(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return E(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return O(this,e,t,n);case"utf8":case"utf-8":return A(this,e,t,n);case"ascii":case"latin1":case"binary":return T(this,e,t,n);case"base64":return N(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var L=4096;function C(e){var t=e.length;if(t<=L)return String.fromCharCode.apply(String,e);var n="",r=0;while(r<t)n+=String.fromCharCode.apply(String,e.slice(r,r+=L));return n}function k(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function U(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function D(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=Z[e[i]];return o}function j(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length-1;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function M(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function q(e,t,n,r,o,i){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function B(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function W(e,t,n,r,o){return t=+t,n>>>=0,o||B(e,t,n,4),S.write(e,t,n,r,23,4),n+4}function F(e,t,n,r,o){return t=+t,n>>>=0,o||B(e,t,n,8),S.write(e,t,n,r,52,8),n+8}s.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,s.prototype),r},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);var r=this[e],o=1,i=0;while(++i<t&&(o*=256))r+=this[e+i]*o;return r},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);var r=this[e+--t],o=1;while(t>0&&(o*=256))r+=this[e+--t]*o;return r},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);var r=this[e],o=1,i=0;while(++i<t&&(o*=256))r+=this[e+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);var r=t,o=1,i=this[e+--r];while(r>0&&(o*=256))i+=this[e+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*t)),i},s.prototype.readInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||M(e,4,this.length),S.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||M(e,4,this.length),S.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||M(e,8,this.length),S.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||M(e,8,this.length),S.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var o=Math.pow(2,8*n)-1;q(this,e,t,n,o,0)}var i=1,s=0;this[t]=255&e;while(++s<n&&(i*=256))this[t+s]=e/i&255;return t+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){var o=Math.pow(2,8*n)-1;q(this,e,t,n,o,0)}var i=n-1,s=1;this[t+i]=255&e;while(--i>=0&&(s*=256))this[t+i]=e/s&255;return t+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);q(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;this[t]=255&e;while(++i<n&&(s*=256))e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);q(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;this[t+i]=255&e;while(--i>=0&&(s*=256))e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||q(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,n){return W(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return W(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),o},s.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var o=e.charCodeAt(0);("utf8"===r&&o<128||"latin1"===r)&&(e=o)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(i=t;i<n;++i)this[i]=e;else{var a=s.isBuffer(e)?e:s.from(e,r),u=a.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%u]}return this};var $=/[^+/0-9A-Za-z-_]/g;function H(e){if(e=e.split("=")[0],e=e.trim().replace($,""),e.length<2)return"";while(e.length%4!==0)e+="=";return e}function G(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function V(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function K(e,t){for(var n,r,o,i=[],s=0;s<e.length;++s){if((t-=2)<0)break;n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r)}return i}function J(e){return b.toByteArray(H(e))}function Y(e,t,n,r){for(var o=0;o<r;++o){if(o+n>=t.length||o>=e.length)break;t[o+n]=e[o]}return o}function z(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!==e}var Z=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var r=16*n,o=0;o<16;++o)t[r+o]=e[n]+e[o];return t}()})),O=I.Buffer;
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */I.SlowBuffer,I.INSPECT_MAX_BYTES,I.kMaxLength;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var A=function(e,t){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},A(e,t)};function T(e,t){function n(){this.constructor=e}A(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var N=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return T(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),t}(Error),R=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return T(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),t}(TypeError);function P(e){return e&&e.Math==Math&&e}function x(){return P("object"===typeof globalThis&&globalThis)||P("object"===typeof window&&window)||P("object"===typeof self&&self)||P("object"===typeof e&&e)||Function("return this")()}function L(){var e=x();return"object"===typeof e.navigator&&"ReactNative"===e.navigator.product}var C=function(e){var t=L()?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(t);for(var n=O.alloc(e),r=0;r<e;++r)n[r]=Math.floor(256*Math.random());return n},k=function(){if("undefined"!==typeof window){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)return function(e){return t.getRandomValues(O.alloc(e))}}return"undefined"!==typeof e&&e.crypto&&e.crypto.getRandomValues?function(t){return e.crypto.getRandomValues(O.alloc(t))}:C},U=k();function D(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function j(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function M(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function q(e){return B(e)&&"[object Date]"===Object.prototype.toString.call(e)}function B(e){return"object"===typeof e&&null!==e}function W(e,t){var n=!1;function r(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return n||(console.warn(t),n=!0),e.apply(this,r)}return r}function F(e){if(ArrayBuffer.isView(e))return O.from(e.buffer,e.byteOffset,e.byteLength);if(D(e))return O.from(e);throw new R("Must use either Buffer or TypedArray")}var $=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,H=function(e){return"string"===typeof e&&$.test(e)},G=function(e){if(!H(e))throw new R('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var t=e.replace(/-/g,"");return O.from(t,"hex")},V=function(e,t){return void 0===t&&(t=!0),t?e.toString("hex",0,4)+"-"+e.toString("hex",4,6)+"-"+e.toString("hex",6,8)+"-"+e.toString("hex",8,10)+"-"+e.toString("hex",10,16):e.toString("hex")},K=16,J=Symbol("id"),Y=function(){function e(t){if("undefined"===typeof t)this.id=e.generate();else if(t instanceof e)this[J]=O.from(t.id),this.__id=t.__id;else if(ArrayBuffer.isView(t)&&t.byteLength===K)this.id=F(t);else{if("string"!==typeof t)throw new R("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");this.id=G(t)}}return Object.defineProperty(e.prototype,"id",{get:function(){return this[J]},set:function(t){this[J]=t,e.cacheHexString&&(this.__id=V(t))},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(t){if(void 0===t&&(t=!0),e.cacheHexString&&this.__id)return this.__id;var n=V(this.id,t);return e.cacheHexString&&(this.__id=n),n},e.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(!t)return!1;if(t instanceof e)return t.id.equals(this.id);try{return new e(t).id.equals(this.id)}catch(n){return!1}},e.prototype.toBinary=function(){return new z(this.id,z.SUBTYPE_UUID)},e.generate=function(){var e=U(K);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,O.from(e)},e.isValid=function(t){if(!t)return!1;if(t instanceof e)return!0;if("string"===typeof t)return H(t);if(j(t)){if(t.length!==K)return!1;try{return parseInt(t[6].toString(16)[0],10)===z.SUBTYPE_UUID}catch(n){return!1}}return!1},e.createFromHexString=function(t){var n=G(t);return new e(n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},e}();Object.defineProperty(Y.prototype,"_bsontype",{value:"UUID"});var z=function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(null!=t&&"string"!==typeof t&&!ArrayBuffer.isView(t)&&!(t instanceof ArrayBuffer)&&!Array.isArray(t))throw new R("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=null!==n&&void 0!==n?n:e.BSON_BINARY_SUBTYPE_DEFAULT,null==t?(this.buffer=O.alloc(e.BUFFER_SIZE),this.position=0):("string"===typeof t?this.buffer=O.from(t,"binary"):Array.isArray(t)?this.buffer=O.from(t):this.buffer=F(t),this.position=this.buffer.byteLength)}return e.prototype.put=function(t){if("string"===typeof t&&1!==t.length)throw new R("only accepts single character String");if("number"!==typeof t&&1!==t.length)throw new R("only accepts single character Uint8Array or Array");var n;if(n="string"===typeof t?t.charCodeAt(0):"number"===typeof t?t:t[0],n<0||n>255)throw new R("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=n;else{var r=O.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length),this.buffer=r,this.buffer[this.position++]=n}},e.prototype.write=function(e,t){if(t="number"===typeof t?t:this.position,this.buffer.length<t+e.length){var n=O.alloc(this.buffer.length+e.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n}ArrayBuffer.isView(e)?(this.buffer.set(F(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position):"string"===typeof e&&(this.buffer.write(e,t,e.length,"binary"),this.position=t+e.length>this.position?t+e.length:this.position)},e.prototype.read=function(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)},e.prototype.value=function(e){return e=!!e,e&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},e.prototype.length=function(){return this.position},e.prototype.toJSON=function(){return this.buffer.toString("base64")},e.prototype.toString=function(e){return this.buffer.toString(e)},e.prototype.toExtendedJSON=function(e){e=e||{};var t=this.buffer.toString("base64"),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===n.length?"0"+n:n}:{$binary:{base64:t,subType:1===n.length?"0"+n:n}}},e.prototype.toUUID=function(){if(this.sub_type===e.SUBTYPE_UUID)return new Y(this.buffer.slice(0,this.position));throw new N('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(e.SUBTYPE_UUID,'" is currently supported.'))},e.fromExtendedJSON=function(t,n){var r,o;if(n=n||{},"$binary"in t?n.legacy&&"string"===typeof t.$binary&&"$type"in t?(o=t.$type?parseInt(t.$type,16):0,r=O.from(t.$binary,"base64")):"string"!==typeof t.$binary&&(o=t.$binary.subType?parseInt(t.$binary.subType,16):0,r=O.from(t.$binary.base64,"base64")):"$uuid"in t&&(o=4,r=G(t.$uuid)),!r)throw new R("Unexpected Binary Extended JSON format ".concat(JSON.stringify(t)));return new e(r,o)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.value(!0);return'new Binary(Buffer.from("'.concat(e.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},e.BSON_BINARY_SUBTYPE_DEFAULT=0,e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_ENCRYPTED=6,e.SUBTYPE_COLUMN=7,e.SUBTYPE_USER_DEFINED=128,e}();Object.defineProperty(z.prototype,"_bsontype",{value:"Binary"});var X=function(){function e(t,n){if(!(this instanceof e))return new e(t,n);this.code=t,this.scope=n}return e.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},e.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},e.fromExtendedJSON=function(t){return new e(t.$code,t.$scope)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toJSON();return'new Code("'.concat(String(e.code),'"').concat(e.scope?", ".concat(JSON.stringify(e.scope)):"",")")},e}();function Z(e){return B(e)&&null!=e.$id&&"string"===typeof e.$ref&&(null==e.$db||"string"===typeof e.$db)}Object.defineProperty(X.prototype,"_bsontype",{value:"Code"});var Q=function(){function e(t,n,r,o){if(!(this instanceof e))return new e(t,n,r,o);var i=t.split(".");2===i.length&&(r=i.shift(),t=i.shift()),this.collection=t,this.oid=n,this.db=r,this.fields=o||{}}return Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e},e.prototype.toExtendedJSON=function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy||(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields)),t},e.fromExtendedJSON=function(t){var n=Object.assign({},t);return delete n.$ref,delete n.$id,delete n.$db,new e(t.$ref,t.$id,t.$db,n)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(e),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},e}();Object.defineProperty(Q.prototype,"_bsontype",{value:"DBRef"});var ee=void 0;try{ee=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(at){}var te=65536,ne=1<<24,re=te*te,oe=re*re,ie=oe/2,se={},ae={},ue=function(){function e(t,n,r){if(void 0===t&&(t=0),!(this instanceof e))return new e(t,n,r);"bigint"===typeof t?Object.assign(this,e.fromBigInt(t,!!n)):"string"===typeof t?Object.assign(this,e.fromString(t,!!n)):(this.low=0|t,this.high=0|n,this.unsigned=!!r),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return e.fromBits=function(t,n,r){return new e(t,n,r)},e.fromInt=function(t,n){var r,o,i;return n?(t>>>=0,(i=0<=t&&t<256)&&(o=ae[t],o)?o:(r=e.fromBits(t,(0|t)<0?-1:0,!0),i&&(ae[t]=r),r)):(t|=0,(i=-128<=t&&t<128)&&(o=se[t],o)?o:(r=e.fromBits(t,t<0?-1:0,!1),i&&(se[t]=r),r))},e.fromNumber=function(t,n){if(isNaN(t))return n?e.UZERO:e.ZERO;if(n){if(t<0)return e.UZERO;if(t>=oe)return e.MAX_UNSIGNED_VALUE}else{if(t<=-ie)return e.MIN_VALUE;if(t+1>=ie)return e.MAX_VALUE}return t<0?e.fromNumber(-t,n).neg():e.fromBits(t%re|0,t/re|0,n)},e.fromBigInt=function(t,n){return e.fromString(t.toString(),n)},e.fromString=function(t,n,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return e.ZERO;if("number"===typeof n?(r=n,n=!1):n=!!n,r=r||10,r<2||36<r)throw RangeError("radix");var o;if((o=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===o)return e.fromString(t.substring(1),n,r).neg();for(var i=e.fromNumber(Math.pow(r,8)),s=e.ZERO,a=0;a<t.length;a+=8){var u=Math.min(8,t.length-a),c=parseInt(t.substring(a,a+u),r);if(u<8){var f=e.fromNumber(Math.pow(r,u));s=s.mul(f).add(e.fromNumber(c))}else s=s.mul(i),s=s.add(e.fromNumber(c))}return s.unsigned=n,s},e.fromBytes=function(t,n,r){return r?e.fromBytesLE(t,n):e.fromBytesBE(t,n)},e.fromBytesLE=function(t,n){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)},e.fromBytesBE=function(t,n){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)},e.isLong=function(e){return B(e)&&!0===e["__isLong__"]},e.fromValue=function(t,n){return"number"===typeof t?e.fromNumber(t,n):"string"===typeof t?e.fromString(t,n):e.fromBits(t.low,t.high,"boolean"===typeof n?n:t.unsigned)},e.prototype.add=function(t){e.isLong(t)||(t=e.fromValue(t));var n=this.high>>>16,r=65535&this.high,o=this.low>>>16,i=65535&this.low,s=t.high>>>16,a=65535&t.high,u=t.low>>>16,c=65535&t.low,f=0,l=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=o+u,l+=h>>>16,h&=65535,l+=r+a,f+=l>>>16,l&=65535,f+=n+s,f&=65535,e.fromBits(h<<16|p,f<<16|l,this.unsigned)},e.prototype.and=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},e.prototype.compare=function(t){if(e.isLong(t)||(t=e.fromValue(t)),this.eq(t))return 0;var n=this.isNegative(),r=t.isNegative();return n&&!r?-1:!n&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},e.prototype.comp=function(e){return this.compare(e)},e.prototype.divide=function(t){if(e.isLong(t)||(t=e.fromValue(t)),t.isZero())throw Error("division by zero");if(ee){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;var n=(this.unsigned?ee.div_u:ee.div_s)(this.low,this.high,t.low,t.high);return e.fromBits(n,ee.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?e.UZERO:e.ZERO;var r,o,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return e.UZERO;if(t.gt(this.shru(1)))return e.UONE;i=e.UZERO}else{if(this.eq(e.MIN_VALUE)){if(t.eq(e.ONE)||t.eq(e.NEG_ONE))return e.MIN_VALUE;if(t.eq(e.MIN_VALUE))return e.ONE;var s=this.shr(1);return r=s.div(t).shl(1),r.eq(e.ZERO)?t.isNegative()?e.ONE:e.NEG_ONE:(o=this.sub(t.mul(r)),i=r.add(o.div(t)),i)}if(t.eq(e.MIN_VALUE))return this.unsigned?e.UZERO:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=e.ZERO}o=this;while(o.gte(t)){r=Math.max(1,Math.floor(o.toNumber()/t.toNumber()));var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:Math.pow(2,a-48),c=e.fromNumber(r),f=c.mul(t);while(f.isNegative()||f.gt(o))r-=u,c=e.fromNumber(r,this.unsigned),f=c.mul(t);c.isZero()&&(c=e.ONE),i=i.add(c),o=o.sub(f)}return i},e.prototype.div=function(e){return this.divide(e)},e.prototype.equals=function(t){return e.isLong(t)||(t=e.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!==1||t.high>>>31!==1)&&(this.high===t.high&&this.low===t.low)},e.prototype.eq=function(e){return this.equals(e)},e.prototype.getHighBits=function(){return this.high},e.prototype.getHighBitsUnsigned=function(){return this.high>>>0},e.prototype.getLowBits=function(){return this.low},e.prototype.getLowBitsUnsigned=function(){return this.low>>>0},e.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(e.MIN_VALUE)?64:this.neg().getNumBitsAbs();var t,n=0!==this.high?this.high:this.low;for(t=31;t>0;t--)if(0!==(n&1<<t))break;return 0!==this.high?t+33:t+1},e.prototype.greaterThan=function(e){return this.comp(e)>0},e.prototype.gt=function(e){return this.greaterThan(e)},e.prototype.greaterThanOrEqual=function(e){return this.comp(e)>=0},e.prototype.gte=function(e){return this.greaterThanOrEqual(e)},e.prototype.ge=function(e){return this.greaterThanOrEqual(e)},e.prototype.isEven=function(){return 0===(1&this.low)},e.prototype.isNegative=function(){return!this.unsigned&&this.high<0},e.prototype.isOdd=function(){return 1===(1&this.low)},e.prototype.isPositive=function(){return this.unsigned||this.high>=0},e.prototype.isZero=function(){return 0===this.high&&0===this.low},e.prototype.lessThan=function(e){return this.comp(e)<0},e.prototype.lt=function(e){return this.lessThan(e)},e.prototype.lessThanOrEqual=function(e){return this.comp(e)<=0},e.prototype.lte=function(e){return this.lessThanOrEqual(e)},e.prototype.modulo=function(t){if(e.isLong(t)||(t=e.fromValue(t)),ee){var n=(this.unsigned?ee.rem_u:ee.rem_s)(this.low,this.high,t.low,t.high);return e.fromBits(n,ee.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},e.prototype.mod=function(e){return this.modulo(e)},e.prototype.rem=function(e){return this.modulo(e)},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(e.isLong(t)||(t=e.fromValue(t)),ee){var n=ee.mul(this.low,this.high,t.low,t.high);return e.fromBits(n,ee.get_high(),this.unsigned)}if(t.isZero())return e.ZERO;if(this.eq(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.eq(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(e.TWO_PWR_24)&&t.lt(e.TWO_PWR_24))return e.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,o=65535&this.high,i=this.low>>>16,s=65535&this.low,a=t.high>>>16,u=65535&t.high,c=t.low>>>16,f=65535&t.low,l=0,h=0,p=0,d=0;return d+=s*f,p+=d>>>16,d&=65535,p+=i*f,h+=p>>>16,p&=65535,p+=s*c,h+=p>>>16,p&=65535,h+=o*f,l+=h>>>16,h&=65535,h+=i*c,l+=h>>>16,h&=65535,h+=s*u,l+=h>>>16,h&=65535,l+=r*f+o*c+i*u+s*a,l&=65535,e.fromBits(p<<16|d,l<<16|h,this.unsigned)},e.prototype.mul=function(e){return this.multiply(e)},e.prototype.negate=function(){return!this.unsigned&&this.eq(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.neg=function(){return this.negate()},e.prototype.not=function(){return e.fromBits(~this.low,~this.high,this.unsigned)},e.prototype.notEquals=function(e){return!this.equals(e)},e.prototype.neq=function(e){return this.notEquals(e)},e.prototype.ne=function(e){return this.notEquals(e)},e.prototype.or=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},e.prototype.shiftLeft=function(t){return e.isLong(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?e.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):e.fromBits(0,this.low<<t-32,this.unsigned)},e.prototype.shl=function(e){return this.shiftLeft(e)},e.prototype.shiftRight=function(t){return e.isLong(t)&&(t=t.toInt()),0===(t&=63)?this:t<32?e.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):e.fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},e.prototype.shr=function(e){return this.shiftRight(e)},e.prototype.shiftRightUnsigned=function(t){if(e.isLong(t)&&(t=t.toInt()),t&=63,0===t)return this;var n=this.high;if(t<32){var r=this.low;return e.fromBits(r>>>t|n<<32-t,n>>>t,this.unsigned)}return 32===t?e.fromBits(n,0,this.unsigned):e.fromBits(n>>>t-32,0,this.unsigned)},e.prototype.shr_u=function(e){return this.shiftRightUnsigned(e)},e.prototype.shru=function(e){return this.shiftRightUnsigned(e)},e.prototype.subtract=function(t){return e.isLong(t)||(t=e.fromValue(t)),this.add(t.neg())},e.prototype.sub=function(e){return this.subtract(e)},e.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},e.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*re+(this.low>>>0):this.high*re+(this.low>>>0)},e.prototype.toBigInt=function(){return BigInt(this.toString())},e.prototype.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},e.prototype.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},e.prototype.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.prototype.toSigned=function(){return this.unsigned?e.fromBits(this.low,this.high,!1):this},e.prototype.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(e.MIN_VALUE)){var n=e.fromNumber(t),r=this.div(n),o=r.mul(n).sub(this);return r.toString(t)+o.toInt().toString(t)}return"-"+this.neg().toString(t)}var i=e.fromNumber(Math.pow(t,6),this.unsigned),s=this,a="";while(1){var u=s.div(i),c=s.sub(u.mul(i)).toInt()>>>0,f=c.toString(t);if(s=u,s.isZero())return f+a;while(f.length<6)f="0"+f;a=""+f+a}},e.prototype.toUnsigned=function(){return this.unsigned?this:e.fromBits(this.low,this.high,!0)},e.prototype.xor=function(t){return e.isLong(t)||(t=e.fromValue(t)),e.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},e.prototype.eqz=function(){return this.isZero()},e.prototype.le=function(e){return this.lessThanOrEqual(e)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,n){var r=e.fromString(t.$numberLong);return n&&n.relaxed?r.toNumber():r},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},e.TWO_PWR_24=e.fromInt(ne),e.MAX_UNSIGNED_VALUE=e.fromBits(-1,-1,!0),e.ZERO=e.fromInt(0),e.UZERO=e.fromInt(0,!0),e.ONE=e.fromInt(1),e.UONE=e.fromInt(1,!0),e.NEG_ONE=e.fromInt(-1),e.MAX_VALUE=e.fromBits(-1,2147483647,!1),e.MIN_VALUE=e.fromBits(0,-2147483648,!1),e}();Object.defineProperty(ue.prototype,"__isLong__",{value:!0}),Object.defineProperty(ue.prototype,"_bsontype",{value:"Long"});var ce=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,fe=/^(\+|-)?(Infinity|inf)$/i,le=/^(\+|-)?NaN$/i,he=6111,pe=-6176,de=6176,ye=34,ge=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ve=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),me=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),_e=/^([-+])?(\d+)?$/,be=31,we=16383,Ee=30,Se=31;function Ie(e){return!isNaN(parseInt(e,10))}function Oe(e){var t=ue.fromNumber(1e9),n=ue.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:n};for(var r=0;r<=3;r++)n=n.shiftLeft(32),n=n.add(new ue(e.parts[r],0)),e.parts[r]=n.div(t).low,n=n.modulo(t);return{quotient:e,rem:n}}function Ae(e,t){if(!e&&!t)return{high:ue.fromNumber(0),low:ue.fromNumber(0)};var n=e.shiftRightUnsigned(32),r=new ue(e.getLowBits(),0),o=t.shiftRightUnsigned(32),i=new ue(t.getLowBits(),0),s=n.multiply(o),a=n.multiply(i),u=r.multiply(o),c=r.multiply(i);return s=s.add(a.shiftRightUnsigned(32)),a=new ue(a.getLowBits(),0).add(u).add(c.shiftRightUnsigned(32)),s=s.add(a.shiftRightUnsigned(32)),c=a.shiftLeft(32).add(new ue(c.getLowBits(),0)),{high:s,low:c}}function Te(e,t){var n=e.high>>>0,r=t.high>>>0;if(n<r)return!0;if(n===r){var o=e.low>>>0,i=t.low>>>0;if(o<i)return!0}return!1}function Ne(e,t){throw new R('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var Re=function(){function e(t){if(!(this instanceof e))return new e(t);if("string"===typeof t)this.bytes=e.fromString(t).bytes;else{if(!j(t))throw new R("Decimal128 must take a Buffer or string");if(16!==t.byteLength)throw new R("Decimal128 must take a Buffer of 16 bytes");this.bytes=t}}return e.fromString=function(t){var n=!1,r=!1,o=!1,i=0,s=0,a=0,u=0,c=0,f=[0],l=0,h=0,p=0,d=0,y=0,g=0,v=new ue(0,0),m=new ue(0,0),_=0,b=0;if(t.length>=7e3)throw new R(t+" not a valid Decimal128 string");var w=t.match(ce),E=t.match(fe),S=t.match(le);if(!w&&!E&&!S||0===t.length)throw new R(t+" not a valid Decimal128 string");if(w){var I=w[2],A=w[4],T=w[5],N=w[6];A&&void 0===N&&Ne(t,"missing exponent power"),A&&void 0===I&&Ne(t,"missing exponent base"),void 0===A&&(T||N)&&Ne(t,"missing e before exponent")}if("+"!==t[b]&&"-"!==t[b]||(n="-"===t[b++]),!Ie(t[b])&&"."!==t[b]){if("i"===t[b]||"I"===t[b])return new e(O.from(n?ve:me));if("N"===t[b])return new e(O.from(ge))}while(Ie(t[b])||"."===t[b])"."!==t[b]?(l<34&&("0"!==t[b]||o)&&(o||(c=s),o=!0,f[h++]=parseInt(t[b],10),l+=1),o&&(a+=1),r&&(u+=1),s+=1,b+=1):(r&&Ne(t,"contains multiple periods"),r=!0,b+=1);if(r&&!s)throw new R(t+" not a valid Decimal128 string");if("e"===t[b]||"E"===t[b]){var P=t.substr(++b).match(_e);if(!P||!P[2])return new e(O.from(ge));y=parseInt(P[0],10),b+=P[0].length}if(t[b])return new e(O.from(ge));if(p=0,l){if(d=l-1,i=a,1!==i)while(0===f[c+i-1])i-=1}else p=0,d=0,f[0]=0,a=1,l=1,i=0;y<=u&&u-y>16384?y=pe:y-=u;while(y>he){if(d+=1,d-p>ye){var x=f.join("");if(x.match(/^0+$/)){y=he;break}Ne(t,"overflow")}y-=1}while(y<pe||l<a){if(0===d&&i<l){y=pe,i=0;break}if(l<a?a-=1:d-=1,y<he)y+=1;else{x=f.join("");if(x.match(/^0+$/)){y=he;break}Ne(t,"overflow")}}if(d-p+1<i){var L=s;r&&(c+=1,L+=1),n&&(c+=1,L+=1);var C=parseInt(t[c+d+1],10),k=0;if(C>=5&&(k=1,5===C))for(k=f[d]%2===1?1:0,g=c+d+2;g<L;g++)if(parseInt(t[g],10)){k=1;break}if(k)for(var U=d;U>=0;U--)if(++f[U]>9&&(f[U]=0,0===U)){if(!(y<he))return new e(O.from(n?ve:me));y+=1,f[U]=1}}if(v=ue.fromNumber(0),m=ue.fromNumber(0),0===i)v=ue.fromNumber(0),m=ue.fromNumber(0);else if(d-p<17){U=p;for(m=ue.fromNumber(f[U++]),v=new ue(0,0);U<=d;U++)m=m.multiply(ue.fromNumber(10)),m=m.add(ue.fromNumber(f[U]))}else{U=p;for(v=ue.fromNumber(f[U++]);U<=d-17;U++)v=v.multiply(ue.fromNumber(10)),v=v.add(ue.fromNumber(f[U]));for(m=ue.fromNumber(f[U++]);U<=d;U++)m=m.multiply(ue.fromNumber(10)),m=m.add(ue.fromNumber(f[U]))}var D=Ae(v,ue.fromString("100000000000000000"));D.low=D.low.add(m),Te(D.low,m)&&(D.high=D.high.add(ue.fromNumber(1))),_=y+de;var j={low:ue.fromNumber(0),high:ue.fromNumber(0)};D.high.shiftRightUnsigned(49).and(ue.fromNumber(1)).equals(ue.fromNumber(1))?(j.high=j.high.or(ue.fromNumber(3).shiftLeft(61)),j.high=j.high.or(ue.fromNumber(_).and(ue.fromNumber(16383).shiftLeft(47))),j.high=j.high.or(D.high.and(ue.fromNumber(0x7fffffffffff)))):(j.high=j.high.or(ue.fromNumber(16383&_).shiftLeft(49)),j.high=j.high.or(D.high.and(ue.fromNumber(562949953421311)))),j.low=D.low,n&&(j.high=j.high.or(ue.fromString("9223372036854775808")));var M=O.alloc(16);return b=0,M[b++]=255&j.low.low,M[b++]=j.low.low>>8&255,M[b++]=j.low.low>>16&255,M[b++]=j.low.low>>24&255,M[b++]=255&j.low.high,M[b++]=j.low.high>>8&255,M[b++]=j.low.high>>16&255,M[b++]=j.low.high>>24&255,M[b++]=255&j.high.low,M[b++]=j.high.low>>8&255,M[b++]=j.high.low>>16&255,M[b++]=j.high.low>>24&255,M[b++]=255&j.high.high,M[b++]=j.high.high>>8&255,M[b++]=j.high.high>>16&255,M[b++]=j.high.high>>24&255,new e(M)},e.prototype.toString=function(){for(var e,t=0,n=new Array(36),r=0;r<n.length;r++)n[r]=0;var o,i,s,a=0,u=!1,c={parts:[0,0,0,0]},f=[];a=0;var l=this.bytes,h=l[a++]|l[a++]<<8|l[a++]<<16|l[a++]<<24,p=l[a++]|l[a++]<<8|l[a++]<<16|l[a++]<<24,d=l[a++]|l[a++]<<8|l[a++]<<16|l[a++]<<24,y=l[a++]|l[a++]<<8|l[a++]<<16|l[a++]<<24;a=0;var g={low:new ue(h,p),high:new ue(d,y)};g.high.lessThan(ue.ZERO)&&f.push("-");var v=y>>26&be;if(v>>3===3){if(v===Ee)return f.join("")+"Infinity";if(v===Se)return"NaN";e=y>>15&we,o=8+(y>>14&1)}else o=y>>14&7,e=y>>17&we;var m=e-de;if(c.parts[0]=(16383&y)+((15&o)<<14),c.parts[1]=d,c.parts[2]=p,c.parts[3]=h,0===c.parts[0]&&0===c.parts[1]&&0===c.parts[2]&&0===c.parts[3])u=!0;else for(s=3;s>=0;s--){var _=0,b=Oe(c);if(c=b.quotient,_=b.rem.low,_)for(i=8;i>=0;i--)n[9*s+i]=_%10,_=Math.floor(_/10)}if(u)t=1,n[a]=0;else{t=36;while(!n[a])t-=1,a+=1}var w=t-1+m;if(w>=34||w<=-7||m>0){if(t>34)return f.push("".concat(0)),m>0?f.push("E+".concat(m)):m<0&&f.push("E".concat(m)),f.join("");f.push("".concat(n[a++])),t-=1,t&&f.push(".");for(r=0;r<t;r++)f.push("".concat(n[a++]));f.push("E"),w>0?f.push("+".concat(w)):f.push("".concat(w))}else if(m>=0)for(r=0;r<t;r++)f.push("".concat(n[a++]));else{var E=t+m;if(E>0)for(r=0;r<E;r++)f.push("".concat(n[a++]));else f.push("0");f.push(".");while(E++<0)f.push("0");for(r=0;r<t-Math.max(E-1,0);r++)f.push("".concat(n[a++]))}return f.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},e}();Object.defineProperty(Re.prototype,"_bsontype",{value:"Decimal128"});var Pe=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.prototype.toString=function(e){return this.value.toString(e)},e.prototype.toExtendedJSON=function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:(Number.isInteger(this.value)?(t=this.value.toFixed(1),t.length>=13&&(t=this.value.toExponential(13).toUpperCase())):t=this.value.toString(),{$numberDouble:t});var t},e.fromExtendedJSON=function(t,n){var r=parseFloat(t.$numberDouble);return n&&n.relaxed?r:new e(r)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){var e=this.toExtendedJSON();return"new Double(".concat(e.$numberDouble,")")},e}();Object.defineProperty(Pe.prototype,"_bsontype",{value:"Double"});var xe=function(){function e(t){if(!(this instanceof e))return new e(t);t instanceof Number&&(t=t.valueOf()),this.value=0|+t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(e){return this.value.toString(e)},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}},e.fromExtendedJSON=function(t,n){return n&&n.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},e}();Object.defineProperty(xe.prototype,"_bsontype",{value:"Int32"});var Le=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$maxKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MaxKey()"},e}();Object.defineProperty(Le.prototype,"_bsontype",{value:"MaxKey"});var Ce=function(){function e(){if(!(this instanceof e))return new e}return e.prototype.toExtendedJSON=function(){return{$minKey:1}},e.fromExtendedJSON=function(){return new e},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new MinKey()"},e}();Object.defineProperty(Ce.prototype,"_bsontype",{value:"MinKey"});var ke=new RegExp("^[0-9a-fA-F]{24}$"),Ue=null,De=Symbol("id"),je=function(){function e(t){if(!(this instanceof e))return new e(t);var n;if("object"===typeof t&&t&&"id"in t){if("string"!==typeof t.id&&!ArrayBuffer.isView(t.id))throw new R("Argument passed in must have an id that is of type string or Buffer");n="toHexString"in t&&"function"===typeof t.toHexString?O.from(t.toHexString(),"hex"):t.id}else n=t;if(null==n||"number"===typeof n)this[De]=e.generate("number"===typeof n?n:void 0);else if(ArrayBuffer.isView(n)&&12===n.byteLength)this[De]=n instanceof O?n:F(n);else{if("string"!==typeof n)throw new R("Argument passed in does not match the accepted types");if(12===n.length){var r=O.from(n);if(12!==r.byteLength)throw new R("Argument passed in must be a string of 12 bytes");this[De]=r}else{if(24!==n.length||!ke.test(n))throw new R("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");this[De]=O.from(n,"hex")}}e.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(e.prototype,"id",{get:function(){return this[De]},set:function(t){this[De]=t,e.cacheHexString&&(this.__id=t.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(e){this.id.writeUInt32BE(e,0)},enumerable:!1,configurable:!0}),e.prototype.toHexString=function(){if(e.cacheHexString&&this.__id)return this.__id;var t=this.id.toString("hex");return e.cacheHexString&&!this.__id&&(this.__id=t),t},e.getInc=function(){return e.index=(e.index+1)%16777215},e.generate=function(t){"number"!==typeof t&&(t=Math.floor(Date.now()/1e3));var n=e.getInc(),r=O.alloc(12);return r.writeUInt32BE(t,0),null===Ue&&(Ue=U(5)),r[4]=Ue[0],r[5]=Ue[1],r[6]=Ue[2],r[7]=Ue[3],r[8]=Ue[4],r[11]=255&n,r[10]=n>>8&255,r[9]=n>>16&255,r},e.prototype.toString=function(e){return e?this.id.toString(e):this.toHexString()},e.prototype.toJSON=function(){return this.toHexString()},e.prototype.equals=function(t){if(void 0===t||null===t)return!1;if(t instanceof e)return this[De][11]===t[De][11]&&this[De].equals(t[De]);if("string"===typeof t&&e.isValid(t)&&12===t.length&&j(this.id))return t===O.prototype.toString.call(this.id,"latin1");if("string"===typeof t&&e.isValid(t)&&24===t.length)return t.toLowerCase()===this.toHexString();if("string"===typeof t&&e.isValid(t)&&12===t.length)return O.from(t).equals(this.id);if("object"===typeof t&&"toHexString"in t&&"function"===typeof t.toHexString){var n=t.toHexString(),r=this.toHexString().toLowerCase();return"string"===typeof n&&n.toLowerCase()===r}return!1},e.prototype.getTimestamp=function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e},e.createPk=function(){return new e},e.createFromTime=function(t){var n=O.from([0,0,0,0,0,0,0,0,0,0,0,0]);return n.writeUInt32BE(t,0),new e(n)},e.createFromHexString=function(t){if("undefined"===typeof t||null!=t&&24!==t.length)throw new R("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new e(O.from(t,"hex"))},e.isValid=function(t){if(null==t)return!1;try{return new e(t),!0}catch(at){return!1}},e.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},e.fromExtendedJSON=function(t){return new e(t.$oid)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},e.index=Math.floor(16777215*Math.random()),e}();function Me(e){return e.split("").sort().join("")}Object.defineProperty(je.prototype,"generate",{value:W((function(e){return je.generate(e)}),"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(je.prototype,"getInc",{value:W((function(){return je.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(je.prototype,"get_inc",{value:W((function(){return je.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(je,"get_inc",{value:W((function(){return je.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(je.prototype,"_bsontype",{value:"ObjectID"});var qe=function(){function e(t,n){if(!(this instanceof e))return new e(t,n);if(this.pattern=t,this.options=Me(null!==n&&void 0!==n?n:""),-1!==this.pattern.indexOf("\0"))throw new N("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(-1!==this.options.indexOf("\0"))throw new N("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var r=0;r<this.options.length;r++)if("i"!==this.options[r]&&"m"!==this.options[r]&&"x"!==this.options[r]&&"l"!==this.options[r]&&"s"!==this.options[r]&&"u"!==this.options[r])throw new N("The regular expression option [".concat(this.options[r],"] is not supported"))}return e.parseOptions=function(e){return e?e.split("").sort().join(""):""},e.prototype.toExtendedJSON=function(e){return e=e||{},e.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},e.fromExtendedJSON=function(t){if("$regex"in t){if("string"===typeof t.$regex)return new e(t.$regex,e.parseOptions(t.$options));if("BSONRegExp"===t.$regex._bsontype)return t}if("$regularExpression"in t)return new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options));throw new R("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(t)))},e}();Object.defineProperty(qe.prototype,"_bsontype",{value:"BSONRegExp"});var Be=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.valueOf=function(){return this.value},e.prototype.toString=function(){return this.value},e.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},e.prototype.toJSON=function(){return this.value},e.prototype.toExtendedJSON=function(){return{$symbol:this.value}},e.fromExtendedJSON=function(t){return new e(t.$symbol)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e}();Object.defineProperty(Be.prototype,"_bsontype",{value:"Symbol"});var We=ue,Fe=function(e){function t(n,r){var o=this;return o instanceof t?(o=ue.isLong(n)?e.call(this,n.low,n.high,!0)||this:B(n)&&"undefined"!==typeof n.t&&"undefined"!==typeof n.i?e.call(this,n.i,n.t,!0)||this:e.call(this,n,r,!0)||this,Object.defineProperty(o,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),o):new t(n,r)}return T(t,e),t.prototype.toJSON=function(){return{$timestamp:this.toString()}},t.fromInt=function(e){return new t(ue.fromInt(e,!0))},t.fromNumber=function(e){return new t(ue.fromNumber(e,!0))},t.fromBits=function(e,n){return new t(e,n)},t.fromString=function(e,n){return new t(ue.fromString(e,!0,n))},t.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},t.fromExtendedJSON=function(e){return new t(e.$timestamp)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},t.MAX_VALUE=ue.MAX_UNSIGNED_VALUE,t}(We);function $e(e){return B(e)&&Reflect.has(e,"_bsontype")&&"string"===typeof e._bsontype}var He=2147483647,Ge=-2147483648,Ve=0x8000000000000000,Ke=-0x8000000000000000,Je={$oid:je,$binary:z,$uuid:z,$symbol:Be,$numberInt:xe,$numberDecimal:Re,$numberDouble:Pe,$numberLong:ue,$minKey:Ce,$maxKey:Le,$regex:qe,$regularExpression:qe,$timestamp:Fe};function Ye(e,t){if(void 0===t&&(t={}),"number"===typeof e){if(t.relaxed||t.legacy)return e;if(Math.floor(e)===e){if(e>=Ge&&e<=He)return new xe(e);if(e>=Ke&&e<=Ve)return ue.fromNumber(e)}return new Pe(e)}if(null==e||"object"!==typeof e)return e;if(e.$undefined)return null;for(var n=Object.keys(e).filter((function(t){return t.startsWith("$")&&null!=e[t]})),r=0;r<n.length;r++){var o=Je[n[r]];if(o)return o.fromExtendedJSON(e,t)}if(null!=e.$date){var i=e.$date,s=new Date;return t.legacy?"number"===typeof i?s.setTime(i):"string"===typeof i&&s.setTime(Date.parse(i)):"string"===typeof i?s.setTime(Date.parse(i)):ue.isLong(i)?s.setTime(i.toNumber()):"number"===typeof i&&t.relaxed&&s.setTime(i),s}if(null!=e.$code){var a=Object.assign({},e);return e.$scope&&(a.$scope=Ye(e.$scope)),X.fromExtendedJSON(e)}if(Z(e)||e.$dbPointer){var u=e.$ref?e:e.$dbPointer;if(u instanceof Q)return u;var c=Object.keys(u).filter((function(e){return e.startsWith("$")})),f=!0;if(c.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(f=!1)})),f)return Q.fromExtendedJSON(u)}return e}function ze(e,t){return e.map((function(e,n){t.seenObjects.push({propertyName:"index ".concat(n),obj:null});try{return Ze(e,t)}finally{t.seenObjects.pop()}}))}function Xe(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function Ze(e,t){if(("object"===typeof e||"function"===typeof e)&&null!==e){var n=t.seenObjects.findIndex((function(t){return t.obj===e}));if(-1!==n){var r=t.seenObjects.map((function(e){return e.propertyName})),o=r.slice(0,n).map((function(e){return"".concat(e," -> ")})).join(""),i=r[n],s=" -> "+r.slice(n+1,r.length-1).map((function(e){return"".concat(e," -> ")})).join(""),a=r[r.length-1],u=" ".repeat(o.length+i.length/2),c="-".repeat(s.length+(i.length+a.length)/2-1);throw new R("Converting circular structure to EJSON:\n"+"    ".concat(o).concat(i).concat(s).concat(a,"\n")+"    ".concat(u,"\\").concat(c,"/"))}t.seenObjects[t.seenObjects.length-1].obj=e}if(Array.isArray(e))return ze(e,t);if(void 0===e)return null;if(e instanceof Date||q(e)){var f=e.getTime(),l=f>-1&&f<2534023188e5;return t.legacy?t.relaxed&&l?{$date:e.getTime()}:{$date:Xe(e)}:t.relaxed&&l?{$date:Xe(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"===typeof e&&(!t.relaxed||!isFinite(e))){if(Math.floor(e)===e){var h=e>=Ge&&e<=He,p=e>=Ke&&e<=Ve;if(h)return{$numberInt:e.toString()};if(p)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp||M(e)){var d=e.flags;if(void 0===d){var y=e.toString().match(/[gimuy]*$/);y&&(d=y[0])}var g=new qe(e.source,d);return g.toExtendedJSON(t)}return null!=e&&"object"===typeof e?tt(e,t):e}var Qe,et={Binary:function(e){return new z(e.value(),e.sub_type)},Code:function(e){return new X(e.code,e.scope)},DBRef:function(e){return new Q(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new Re(e.bytes)},Double:function(e){return new Pe(e.value)},Int32:function(e){return new xe(e.value)},Long:function(e){return ue.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new Le},MinKey:function(){return new Ce},ObjectID:function(e){return new je(e)},ObjectId:function(e){return new je(e)},BSONRegExp:function(e){return new qe(e.pattern,e.options)},Symbol:function(e){return new Be(e.value)},Timestamp:function(e){return Fe.fromBits(e.low,e.high)}};function tt(e,t){if(null==e||"object"!==typeof e)throw new N("not an object instance");var n=e._bsontype;if("undefined"===typeof n){var r={};for(var o in e){t.seenObjects.push({propertyName:o,obj:null});try{var i=Ze(e[o],t);"__proto__"===o?Object.defineProperty(r,o,{value:i,writable:!0,enumerable:!0,configurable:!0}):r[o]=i}finally{t.seenObjects.pop()}}return r}if($e(e)){var s=e;if("function"!==typeof s.toExtendedJSON){var a=et[e._bsontype];if(!a)throw new R("Unrecognized or invalid _bsontype: "+e._bsontype);s=a(s)}return"Code"===n&&s.scope?s=new X(s.code,Ze(s.scope,t)):"DBRef"===n&&s.oid&&(s=new Q(Ze(s.collection,t),Ze(s.oid,t),Ze(s.db,t),Ze(s.fields,t))),s.toExtendedJSON(t)}throw new N("_bsontype must be a string, but was: "+typeof n)}(function(e){function t(e,t){var n=Object.assign({},{relaxed:!0,legacy:!1},t);return"boolean"===typeof n.relaxed&&(n.strict=!n.relaxed),"boolean"===typeof n.strict&&(n.relaxed=!n.strict),JSON.parse(e,(function(e,t){if(-1!==e.indexOf("\0"))throw new N("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(e)));return Ye(t,n)}))}function n(e,t,n,r){null!=n&&"object"===typeof n&&(r=n,n=0),null==t||"object"!==typeof t||Array.isArray(t)||(r=t,t=void 0,n=0);var o=Object.assign({relaxed:!0,legacy:!1},r,{seenObjects:[{propertyName:"(root)",obj:null}]}),i=Ze(e,o);return JSON.stringify(i,t,n)}function r(e,t){return t=t||{},JSON.parse(n(e,t))}function o(e,n){return n=n||{},t(JSON.stringify(e),n)}e.parse=t,e.stringify=n,e.serialize=r,e.deserialize=o})(Qe||(Qe={}));var nt=x();nt.Map?nt.Map:function(){function e(e){void 0===e&&(e=[]),this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],r=n[0],o=n[1];this._keys.push(r),this._values[r]={v:o,i:this._keys.length-1}}}e.prototype.clear=function(){this._keys=[],this._values={}},e.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},e.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},e.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var r=this._keys[n];e.call(t,this._values[r].v,r,t)}},e.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},e.prototype.has=function(e){return null!=this._values[e]},e.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},e.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},e.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0})}();Math.pow(2,63),Math.pow(2,63);var rt=Math.pow(2,53),ot=-Math.pow(2,53);ue.fromNumber(rt),ue.fromNumber(ot);new Set(["$db","$ref","$id","$clusterTime"]);var it=new Uint8Array(8);new DataView(it.buffer,it.byteOffset,it.byteLength);var st=17825792;O.alloc(st)}).call(this,n("c8ba"))},abc7:function(e,t,n){(function(t){var n="Expected a function",r="__lodash_hash_undefined__",o=1/0,i="[object Function]",s="[object GeneratorFunction]",a="[object Symbol]",u=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/,f=/^\./,l=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,h=/[\\^$.*+?()[\]{}|]/g,p=/\\(\\)?/g,d=/^\[object .+?Constructor\]$/,y="object"==typeof t&&t&&t.Object===Object&&t,g="object"==typeof self&&self&&self.Object===Object&&self,v=y||g||Function("return this")();function m(e,t){return null==e?void 0:e[t]}function _(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}var b=Array.prototype,w=Function.prototype,E=Object.prototype,S=v["__core-js_shared__"],I=function(){var e=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),O=w.toString,A=E.hasOwnProperty,T=E.toString,N=RegExp("^"+O.call(A).replace(h,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),R=v.Symbol,P=b.splice,x=ae(v,"Map"),L=ae(Object,"create"),C=R?R.prototype:void 0,k=C?C.toString:void 0;function U(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function D(){this.__data__=L?L(null):{}}function j(e){return this.has(e)&&delete this.__data__[e]}function M(e){var t=this.__data__;if(L){var n=t[e];return n===r?void 0:n}return A.call(t,e)?t[e]:void 0}function q(e){var t=this.__data__;return L?void 0!==t[e]:A.call(t,e)}function B(e,t){var n=this.__data__;return n[e]=L&&void 0===t?r:t,this}function W(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function F(){this.__data__=[]}function $(e){var t=this.__data__,n=Q(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():P.call(t,n,1),!0}function H(e){var t=this.__data__,n=Q(t,e);return n<0?void 0:t[n][1]}function G(e){return Q(this.__data__,e)>-1}function V(e,t){var n=this.__data__,r=Q(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}function K(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function J(){this.__data__={hash:new U,map:new(x||W),string:new U}}function Y(e){return se(this,e)["delete"](e)}function z(e){return se(this,e).get(e)}function X(e){return se(this,e).has(e)}function Z(e,t){return se(this,e).set(e,t),this}function Q(e,t){var n=e.length;while(n--)if(ve(e[n][0],t))return n;return-1}function ee(e,t){t=ue(t,e)?[t]:ie(t);var n=0,r=t.length;while(null!=e&&n<r)e=e[pe(t[n++])];return n&&n==r?e:void 0}function te(e){if(!be(e)||fe(e))return!1;var t=_e(e)||_(e)?N:d;return t.test(de(e))}function ne(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;var i=Array(o);while(++r<o)i[r]=e[r+t];return i}function re(e){if("string"==typeof e)return e;if(Ee(e))return k?k.call(e):"";var t=e+"";return"0"==t&&1/e==-o?"-0":t}function oe(e,t){t=ue(t,e)?[t]:ie(t),e=le(e,t);var n=pe(ye(t));return!(null!=e&&A.call(e,n))||delete e[n]}function ie(e){return me(e)?e:he(e)}function se(e,t){var n=e.__data__;return ce(t)?n["string"==typeof t?"string":"hash"]:n.map}function ae(e,t){var n=m(e,t);return te(n)?n:void 0}function ue(e,t){if(me(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ee(e))||(c.test(e)||!u.test(e)||null!=t&&e in Object(t))}function ce(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function fe(e){return!!I&&I in e}function le(e,t){return 1==t.length?e:ee(e,ne(t,0,-1))}U.prototype.clear=D,U.prototype["delete"]=j,U.prototype.get=M,U.prototype.has=q,U.prototype.set=B,W.prototype.clear=F,W.prototype["delete"]=$,W.prototype.get=H,W.prototype.has=G,W.prototype.set=V,K.prototype.clear=J,K.prototype["delete"]=Y,K.prototype.get=z,K.prototype.has=X,K.prototype.set=Z;var he=ge((function(e){e=Se(e);var t=[];return f.test(e)&&t.push(""),e.replace(l,(function(e,n,r,o){t.push(r?o.replace(p,"$1"):n||e)})),t}));function pe(e){if("string"==typeof e||Ee(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}function de(e){if(null!=e){try{return O.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function ye(e){var t=e?e.length:0;return t?e[t-1]:void 0}function ge(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(n);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=e.apply(this,n);return r.cache=i.set(o,s),s};return r.cache=new(ge.Cache||K),r}function ve(e,t){return e===t||e!==e&&t!==t}ge.Cache=K;var me=Array.isArray;function _e(e){var t=be(e)?T.call(e):"";return t==i||t==s}function be(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function we(e){return!!e&&"object"==typeof e}function Ee(e){return"symbol"==typeof e||we(e)&&T.call(e)==a}function Se(e){return null==e?"":re(e)}function Ie(e,t){return null==e||oe(e,t)}e.exports=Ie}).call(this,n("c8ba"))},adad:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n("954c"),t)},b038:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.removeEventListener=t.activateEvent=t.addEventListener=t.CloudbaseEventEmitter=t.IErrorEvent=t.CloudbaseEvent=void 0;var i=n("8a32");function s(e,t,n){n[e]=n[e]||[],n[e].push(t)}function a(e,t,n){if(null===n||void 0===n?void 0:n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}var u=function(){function e(e,t){this.data=t||null,this.name=e}return e}();t.CloudbaseEvent=u;var c=function(e){function t(t,n){var r=e.call(this,"error",{error:t,data:n})||this;return r.error=t,r}return r(t,e),t}(u);t.IErrorEvent=c;var f=function(){function e(){this._listeners={}}return e.prototype.on=function(e,t){return s(e,t,this._listeners),this},e.prototype.off=function(e,t){return a(e,t,this._listeners),this},e.prototype.fire=function(e,t){if(i.isInstanceOf(e,c))return console.error(e.error),this;var n=i.isString(e)?new u(e,t||{}):e,r=n.name;if(this._listens(r)){n.target=this;for(var s=this._listeners[r]?o(this._listeners[r]):[],a=0,f=s;a<f.length;a++){var l=f[a];l.call(this,n)}}return this},e.prototype._listens=function(e){return this._listeners[e]&&this._listeners[e].length>0},e}();t.CloudbaseEventEmitter=f;var l=new f;function h(e,t){l.on(e,t)}function p(e,t){void 0===t&&(t={}),l.fire(e,t)}function d(e,t){l.off(e,t)}t.addEventListener=h,t.activateEvent=p,t.removeEventListener=d},c8ff:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function s(e){try{u(r.next(e))}catch(t){i(t)}}function a(e){try{u(r["throw"](e))}catch(t){i(t)}}function u(e){e.done?n(e.value):o(e.value).then(s,a)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return u([e,t])}}function u(i){if(n)throw new TypeError("Generator is already executing.");while(s)try{if(n=1,r&&(o=2&i[0]?r["return"]:i[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebRequest=t.genAdapter=void 0;var a=n("f10f"),u=n("8a32"),c=n("17b0"),f=function(e){function t(t){var n=e.call(this)||this,r=t.timeout,o=t.timeoutMsg,i=t.restrictedMethods;return n._timeout=r||0,n._timeoutMsg=o||"请求超时",n._restrictedMethods=i||["get","post","upload","download"],n}return r(t,e),t.prototype.get=function(e){return this._request(o(o({},e),{method:"get"}),this._restrictedMethods.includes("get"))},t.prototype.post=function(e){return this._request(o(o({},e),{method:"post"}),this._restrictedMethods.includes("post"))},t.prototype.put=function(e){return this._request(o(o({},e),{method:"put"}))},t.prototype.upload=function(e){var t=e.data,n=e.file,r=e.name,i=new FormData;for(var s in t)i.append(s,t[s]);return i.append("key",r),i.append("file",n),this._request(o(o({},e),{data:i,method:"post"}),this._restrictedMethods.includes("upload"))},t.prototype.download=function(e){return i(this,void 0,void 0,(function(){var t,n,r,i;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this.get(o(o({},e),{headers:{},responseType:"blob"}))];case 1:return t=s.sent().data,n=window.URL.createObjectURL(new Blob([t])),r=decodeURIComponent(new URL(e.url).pathname.split("/").pop()||""),i=document.createElement("a"),i.href=n,i.setAttribute("download",r),i.style.display="none",document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(n),document.body.removeChild(i),[3,3];case 2:return s.sent(),[3,3];case 3:return[2,new Promise((function(t){t({statusCode:200,tempFilePath:e.url})}))]}}))}))},t.prototype._request=function(e,t){var n=this;void 0===t&&(t=!1);var r=String(e.method).toLowerCase()||"get";return new Promise((function(o){var i,s,a=e.url,f=e.headers,l=void 0===f?{}:f,h=e.data,p=e.responseType,d=e.withCredentials,y=e.body,g=e.onUploadProgress,v=u.formatUrl(c.getProtocol(),a,"get"===r?h:{}),m=new XMLHttpRequest;for(var _ in m.open(r,v),p&&(m.responseType=p),l)m.setRequestHeader(_,l[_]);g&&m.upload.addEventListener("progress",g),m.onreadystatechange=function(){var e={};if(4===m.readyState){var t=m.getAllResponseHeaders(),n=t.trim().split(/[\r\n]+/),r={};n.forEach((function(e){var t=e.split(": "),n=t.shift().toLowerCase(),o=t.join(": ");r[n]=o})),e.header=r,e.statusCode=m.status;try{e.data="blob"===p?m.response:JSON.parse(m.responseText)}catch(s){e.data="blob"===p?m.response:m.responseText}clearTimeout(i),o(e)}},t&&n._timeout&&(i=setTimeout((function(){console.warn(n._timeoutMsg),m.abort()}),n._timeout)),s=u.isFormData(h)?h:"application/x-www-form-urlencoded"===l["content-type"]?u.toQueryString(h):y||(h?JSON.stringify(h):void 0),d&&(m.withCredentials=!0),m.send(s)}))},t}(a.AbstractSDKRequest);function l(){var e={root:window,reqClass:f,wsClass:WebSocket,localStorage:localStorage,sessionStorage:sessionStorage};return e}t.WebRequest=f,t.genAdapter=l},cd3f:function(e,t,n){(function(e,n){var r=200,o="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",a="[object Array]",u="[object Boolean]",c="[object Date]",f="[object Error]",l="[object Function]",h="[object GeneratorFunction]",p="[object Map]",d="[object Number]",y="[object Object]",g="[object Promise]",v="[object RegExp]",m="[object Set]",_="[object String]",b="[object Symbol]",w="[object WeakMap]",E="[object ArrayBuffer]",S="[object DataView]",I="[object Float32Array]",O="[object Float64Array]",A="[object Int8Array]",T="[object Int16Array]",N="[object Int32Array]",R="[object Uint8Array]",P="[object Uint8ClampedArray]",x="[object Uint16Array]",L="[object Uint32Array]",C=/[\\^$.*+?()[\]{}|]/g,k=/\w*$/,U=/^\[object .+?Constructor\]$/,D=/^(?:0|[1-9]\d*)$/,j={};j[s]=j[a]=j[E]=j[S]=j[u]=j[c]=j[I]=j[O]=j[A]=j[T]=j[N]=j[p]=j[d]=j[y]=j[v]=j[m]=j[_]=j[b]=j[R]=j[P]=j[x]=j[L]=!0,j[f]=j[l]=j[w]=!1;var M="object"==typeof e&&e&&e.Object===Object&&e,q="object"==typeof self&&self&&self.Object===Object&&self,B=M||q||Function("return this")(),W=t&&!t.nodeType&&t,F=W&&"object"==typeof n&&n&&!n.nodeType&&n,$=F&&F.exports===W;function H(e,t){return e.set(t[0],t[1]),e}function G(e,t){return e.add(t),e}function V(e,t){var n=-1,r=e?e.length:0;while(++n<r)if(!1===t(e[n],n,e))break;return e}function K(e,t){var n=-1,r=t.length,o=e.length;while(++n<r)e[o+n]=t[n];return e}function J(e,t,n,r){var o=-1,i=e?e.length:0;r&&i&&(n=e[++o]);while(++o<i)n=t(n,e[o],o,e);return n}function Y(e,t){var n=-1,r=Array(e);while(++n<e)r[n]=t(n);return r}function z(e,t){return null==e?void 0:e[t]}function X(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}function Z(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Q(e,t){return function(n){return e(t(n))}}function ee(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var te=Array.prototype,ne=Function.prototype,re=Object.prototype,oe=B["__core-js_shared__"],ie=function(){var e=/[^.]+$/.exec(oe&&oe.keys&&oe.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),se=ne.toString,ae=re.hasOwnProperty,ue=re.toString,ce=RegExp("^"+se.call(ae).replace(C,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),fe=$?B.Buffer:void 0,le=B.Symbol,he=B.Uint8Array,pe=Q(Object.getPrototypeOf,Object),de=Object.create,ye=re.propertyIsEnumerable,ge=te.splice,ve=Object.getOwnPropertySymbols,me=fe?fe.isBuffer:void 0,_e=Q(Object.keys,Object),be=At(B,"DataView"),we=At(B,"Map"),Ee=At(B,"Promise"),Se=At(B,"Set"),Ie=At(B,"WeakMap"),Oe=At(Object,"create"),Ae=Dt(be),Te=Dt(we),Ne=Dt(Ee),Re=Dt(Se),Pe=Dt(Ie),xe=le?le.prototype:void 0,Le=xe?xe.valueOf:void 0;function Ce(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function ke(){this.__data__=Oe?Oe(null):{}}function Ue(e){return this.has(e)&&delete this.__data__[e]}function De(e){var t=this.__data__;if(Oe){var n=t[e];return n===o?void 0:n}return ae.call(t,e)?t[e]:void 0}function je(e){var t=this.__data__;return Oe?void 0!==t[e]:ae.call(t,e)}function Me(e,t){var n=this.__data__;return n[e]=Oe&&void 0===t?o:t,this}function qe(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function Be(){this.__data__=[]}function We(e){var t=this.__data__,n=it(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():ge.call(t,n,1),!0}function Fe(e){var t=this.__data__,n=it(t,e);return n<0?void 0:t[n][1]}function $e(e){return it(this.__data__,e)>-1}function He(e,t){var n=this.__data__,r=it(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}function Ge(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function Ve(){this.__data__={hash:new Ce,map:new(we||qe),string:new Ce}}function Ke(e){return Ot(this,e)["delete"](e)}function Je(e){return Ot(this,e).get(e)}function Ye(e){return Ot(this,e).has(e)}function ze(e,t){return Ot(this,e).set(e,t),this}function Xe(e){this.__data__=new qe(e)}function Ze(){this.__data__=new qe}function Qe(e){return this.__data__["delete"](e)}function et(e){return this.__data__.get(e)}function tt(e){return this.__data__.has(e)}function nt(e,t){var n=this.__data__;if(n instanceof qe){var o=n.__data__;if(!we||o.length<r-1)return o.push([e,t]),this;n=this.__data__=new Ge(o)}return n.set(e,t),this}function rt(e,t){var n=Bt(e)||qt(e)?Y(e.length,String):[],r=n.length,o=!!r;for(var i in e)!t&&!ae.call(e,i)||o&&("length"==i||Lt(i,r))||n.push(i);return n}function ot(e,t,n){var r=e[t];ae.call(e,t)&&Mt(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function it(e,t){var n=e.length;while(n--)if(Mt(e[n][0],t))return n;return-1}function st(e,t){return e&&Et(t,Jt(t),e)}function at(e,t,n,r,o,i,a){var u;if(r&&(u=i?r(e,o,i,a):r(e)),void 0!==u)return u;if(!Vt(e))return e;var c=Bt(e);if(c){if(u=Rt(e),!t)return wt(e,u)}else{var f=Nt(e),p=f==l||f==h;if($t(e))return pt(e,t);if(f==y||f==s||p&&!i){if(X(e))return i?e:{};if(u=Pt(p?{}:e),!t)return St(e,st(u,e))}else{if(!j[f])return i?e:{};u=xt(e,f,at,t)}}a||(a=new Xe);var d=a.get(e);if(d)return d;if(a.set(e,u),!c)var g=n?It(e):Jt(e);return V(g||e,(function(o,i){g&&(i=o,o=e[i]),ot(u,i,at(o,t,n,r,i,e,a))})),u}function ut(e){return Vt(e)?de(e):{}}function ct(e,t,n){var r=t(e);return Bt(e)?r:K(r,n(e))}function ft(e){return ue.call(e)}function lt(e){if(!Vt(e)||kt(e))return!1;var t=Ht(e)||X(e)?ce:U;return t.test(Dt(e))}function ht(e){if(!Ut(e))return _e(e);var t=[];for(var n in Object(e))ae.call(e,n)&&"constructor"!=n&&t.push(n);return t}function pt(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}function dt(e){var t=new e.constructor(e.byteLength);return new he(t).set(new he(e)),t}function yt(e,t){var n=t?dt(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function gt(e,t,n){var r=t?n(Z(e),!0):Z(e);return J(r,H,new e.constructor)}function vt(e){var t=new e.constructor(e.source,k.exec(e));return t.lastIndex=e.lastIndex,t}function mt(e,t,n){var r=t?n(ee(e),!0):ee(e);return J(r,G,new e.constructor)}function _t(e){return Le?Object(Le.call(e)):{}}function bt(e,t){var n=t?dt(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function wt(e,t){var n=-1,r=e.length;t||(t=Array(r));while(++n<r)t[n]=e[n];return t}function Et(e,t,n,r){n||(n={});var o=-1,i=t.length;while(++o<i){var s=t[o],a=r?r(n[s],e[s],s,n,e):void 0;ot(n,s,void 0===a?e[s]:a)}return n}function St(e,t){return Et(e,Tt(e),t)}function It(e){return ct(e,Jt,Tt)}function Ot(e,t){var n=e.__data__;return Ct(t)?n["string"==typeof t?"string":"hash"]:n.map}function At(e,t){var n=z(e,t);return lt(n)?n:void 0}Ce.prototype.clear=ke,Ce.prototype["delete"]=Ue,Ce.prototype.get=De,Ce.prototype.has=je,Ce.prototype.set=Me,qe.prototype.clear=Be,qe.prototype["delete"]=We,qe.prototype.get=Fe,qe.prototype.has=$e,qe.prototype.set=He,Ge.prototype.clear=Ve,Ge.prototype["delete"]=Ke,Ge.prototype.get=Je,Ge.prototype.has=Ye,Ge.prototype.set=ze,Xe.prototype.clear=Ze,Xe.prototype["delete"]=Qe,Xe.prototype.get=et,Xe.prototype.has=tt,Xe.prototype.set=nt;var Tt=ve?Q(ve,Object):Yt,Nt=ft;function Rt(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&ae.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Pt(e){return"function"!=typeof e.constructor||Ut(e)?{}:ut(pe(e))}function xt(e,t,n,r){var o=e.constructor;switch(t){case E:return dt(e);case u:case c:return new o(+e);case S:return yt(e,r);case I:case O:case A:case T:case N:case R:case P:case x:case L:return bt(e,r);case p:return gt(e,r,n);case d:case _:return new o(e);case v:return vt(e);case m:return mt(e,r,n);case b:return _t(e)}}function Lt(e,t){return t=null==t?i:t,!!t&&("number"==typeof e||D.test(e))&&e>-1&&e%1==0&&e<t}function Ct(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function kt(e){return!!ie&&ie in e}function Ut(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||re;return e===n}function Dt(e){if(null!=e){try{return se.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function jt(e){return at(e,!0,!0)}function Mt(e,t){return e===t||e!==e&&t!==t}function qt(e){return Ft(e)&&ae.call(e,"callee")&&(!ye.call(e,"callee")||ue.call(e)==s)}(be&&Nt(new be(new ArrayBuffer(1)))!=S||we&&Nt(new we)!=p||Ee&&Nt(Ee.resolve())!=g||Se&&Nt(new Se)!=m||Ie&&Nt(new Ie)!=w)&&(Nt=function(e){var t=ue.call(e),n=t==y?e.constructor:void 0,r=n?Dt(n):void 0;if(r)switch(r){case Ae:return S;case Te:return p;case Ne:return g;case Re:return m;case Pe:return w}return t});var Bt=Array.isArray;function Wt(e){return null!=e&&Gt(e.length)&&!Ht(e)}function Ft(e){return Kt(e)&&Wt(e)}var $t=me||zt;function Ht(e){var t=Vt(e)?ue.call(e):"";return t==l||t==h}function Gt(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=i}function Vt(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Kt(e){return!!e&&"object"==typeof e}function Jt(e){return Wt(e)?rt(e):ht(e)}function Yt(){return[]}function zt(){return!1}n.exports=jt}).call(this,n("c8ba"),n("62e4")(e))},ed53:function(e,t,n){(function(t,r,o){e.exports=r(n("21bf"),n("94f8"),n("5980"))})(0,(function(e){return e.HmacSHA256}))},f10f:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"StorageType",(function(){return r})),n.d(t,"AbstractSDKRequest",(function(){return o})),n.d(t,"AbstractStorage",(function(){return i})),n.d(t,"formatUrl",(function(){return s})),function(e){e["local"]="local",e["none"]="none",e["session"]="session"}(r||(r={}));var o=function(){function e(){}return e}(),i=function(){function e(){}return e}();function s(e,t,n){void 0===n&&(n={});var r=/\?/.test(t),o="";for(var i in n)""===o?!r&&(t+="?"):o+="&",o+=i+"="+encodeURIComponent(n[i]);return t+=o,/^http(s)?\:\/\//.test(t)?t:""+e+t}},f12e:function(e,t,n){"use strict";(function(e){n.d(t,"i",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"h",(function(){return f})),n.d(t,"d",(function(){return l})),n.d(t,"a",(function(){return p})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return v})),n.d(t,"c",(function(){return m})),n.d(t,"b",(function(){return h}));var r=n("364b"),o=r["constants"].setSdkName,i=r["constants"].setProtocol,s="",a="@cloudbase/js-sdk";function u(e){s=e}function c(){return s}function f(e){a=e,o(e)}function l(){return a}var h,p="2020-01-10",d="undefined"!==typeof location&&"http:"===location.protocol?"http:":"https:",y="//tcb-api.tencentcloudapi.com/web";function g(e,t){y=e,t&&(d=t,i(t))}function v(e,t,n){var r=t?"//"+e+"."+t+".tcb-api.tencentcloudapi.com/web":"//"+e+".ap-shanghai.tcb-api.tencentcloudapi.com/web";g(r,n)}function m(){return{BASE_URL:y,PROTOCOL:d}}(function(e){e["ANONYMOUS"]="ANONYMOUS",e["WECHAT"]="WECHAT",e["CUSTOM"]="CUSTOM",e["NULL"]="NULL"})(h||(h={}))}).call(this,n("4362"))},f4c4:function(e,t,n){(function(t){var n="Expected a function",r="__lodash_hash_undefined__",o=1/0,i=9007199254740991,s="[object Function]",a="[object GeneratorFunction]",u="[object Symbol]",c=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,f=/^\w*$/,l=/^\./,h=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,p=/[\\^$.*+?()[\]{}|]/g,d=/\\(\\)?/g,y=/^\[object .+?Constructor\]$/,g=/^(?:0|[1-9]\d*)$/,v="object"==typeof t&&t&&t.Object===Object&&t,m="object"==typeof self&&self&&self.Object===Object&&self,_=v||m||Function("return this")();function b(e,t){return null==e?void 0:e[t]}function w(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}var E=Array.prototype,S=Function.prototype,I=Object.prototype,O=_["__core-js_shared__"],A=function(){var e=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),T=S.toString,N=I.hasOwnProperty,R=I.toString,P=RegExp("^"+T.call(N).replace(p,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),x=_.Symbol,L=E.splice,C=ue(_,"Map"),k=ue(Object,"create"),U=x?x.prototype:void 0,D=U?U.toString:void 0;function j(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function M(){this.__data__=k?k(null):{}}function q(e){return this.has(e)&&delete this.__data__[e]}function B(e){var t=this.__data__;if(k){var n=t[e];return n===r?void 0:n}return N.call(t,e)?t[e]:void 0}function W(e){var t=this.__data__;return k?void 0!==t[e]:N.call(t,e)}function F(e,t){var n=this.__data__;return n[e]=k&&void 0===t?r:t,this}function $(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function H(){this.__data__=[]}function G(e){var t=this.__data__,n=ne(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():L.call(t,n,1),!0}function V(e){var t=this.__data__,n=ne(t,e);return n<0?void 0:t[n][1]}function K(e){return ne(this.__data__,e)>-1}function J(e,t){var n=this.__data__,r=ne(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}function Y(e){var t=-1,n=e?e.length:0;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function z(){this.__data__={hash:new j,map:new(C||$),string:new j}}function X(e){return ae(this,e)["delete"](e)}function Z(e){return ae(this,e).get(e)}function Q(e){return ae(this,e).has(e)}function ee(e,t){return ae(this,e).set(e,t),this}function te(e,t,n){var r=e[t];N.call(e,t)&&ve(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function ne(e,t){var n=e.length;while(n--)if(ve(e[n][0],t))return n;return-1}function re(e){if(!be(e)||he(e))return!1;var t=_e(e)||w(e)?P:y;return t.test(ye(e))}function oe(e,t,n,r){if(!be(e))return e;t=fe(t,e)?[t]:se(t);var o=-1,i=t.length,s=i-1,a=e;while(null!=a&&++o<i){var u=de(t[o]),c=n;if(o!=s){var f=a[u];c=r?r(f,u,a):void 0,void 0===c&&(c=be(f)?f:ce(t[o+1])?[]:{})}te(a,u,c),a=a[u]}return e}function ie(e){if("string"==typeof e)return e;if(Ee(e))return D?D.call(e):"";var t=e+"";return"0"==t&&1/e==-o?"-0":t}function se(e){return me(e)?e:pe(e)}function ae(e,t){var n=e.__data__;return le(t)?n["string"==typeof t?"string":"hash"]:n.map}function ue(e,t){var n=b(e,t);return re(n)?n:void 0}function ce(e,t){return t=null==t?i:t,!!t&&("number"==typeof e||g.test(e))&&e>-1&&e%1==0&&e<t}function fe(e,t){if(me(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ee(e))||(f.test(e)||!c.test(e)||null!=t&&e in Object(t))}function le(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function he(e){return!!A&&A in e}j.prototype.clear=M,j.prototype["delete"]=q,j.prototype.get=B,j.prototype.has=W,j.prototype.set=F,$.prototype.clear=H,$.prototype["delete"]=G,$.prototype.get=V,$.prototype.has=K,$.prototype.set=J,Y.prototype.clear=z,Y.prototype["delete"]=X,Y.prototype.get=Z,Y.prototype.has=Q,Y.prototype.set=ee;var pe=ge((function(e){e=Se(e);var t=[];return l.test(e)&&t.push(""),e.replace(h,(function(e,n,r,o){t.push(r?o.replace(d,"$1"):n||e)})),t}));function de(e){if("string"==typeof e||Ee(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}function ye(e){if(null!=e){try{return T.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function ge(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(n);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var s=e.apply(this,n);return r.cache=i.set(o,s),s};return r.cache=new(ge.Cache||Y),r}function ve(e,t){return e===t||e!==e&&t!==t}ge.Cache=Y;var me=Array.isArray;function _e(e){var t=be(e)?R.call(e):"";return t==s||t==a}function be(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function we(e){return!!e&&"object"==typeof e}function Ee(e){return"symbol"==typeof e||we(e)&&R.call(e)==u}function Se(e){return null==e?"":ie(e)}function Ie(e,t,n){return null==e?e:oe(e,t,n)}e.exports=Ie}).call(this,n("c8ba"))},f5e5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERRORS=void 0,t.ERRORS={INVALID_PARAMS:"INVALID_PARAMS",INVALID_SYNTAX:"INVALID_SYNTAX",INVALID_OPERATION:"INVALID_OPERATION",OPERATION_FAIL:"OPERATION_FAIL",NETWORK_ERROR:"NETWORK_ERROR",UNKOWN_ERROR:"UNKOWN_ERROR"}},f8d5:function(e,t,n){(function(t,r){e.exports=r(n("21bf"))})(0,(function(e){return e.enc.Utf8}))}}]);
//# sourceMappingURL=chunk-9c7809bc.138fcd16.js.map